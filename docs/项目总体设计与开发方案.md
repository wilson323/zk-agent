# 项目总体设计与开发方案

---

## 1. 项目定位与目标

### 详细设计方案
- **目标**：实现多智能体协同、极致用户体验、灵活可扩展的架构和严格的开发规范。
- **规范**：
  - 所有功能模块必须支持高并发和低延迟。
  - 用户界面必须符合现代UI/UX设计标准。
- **注意事项**：
  - 避免模块间的高耦合，确保模块独立性。
  - 所有API必须遵循RESTful规范。
- **关联**：与后端API、数据库设计、UI/UX设计紧密关联。

本项目为"AI多智能体宇宙平台"，集成对话智能体（FastGPT）、CAD分析专家、AI海报设计师三大核心AI能力，面向企业级生产环境，提供统一入口、现代UI、响应式体验和高可靠性后端支撑。

---

## 2. 系统架构与技术选型

### 详细设计方案
- **前端**：
  - **规范**：使用Next.js 15 + React 18 + TypeScript，确保代码类型安全。
  - **注意事项**：避免直接操作DOM，优先使用React Hooks。
  - **关联**：与后端API交互需通过统一的API网关。
- **后端**：
  - **规范**：使用Prisma ORM + PostgreSQL，确保数据库操作高效。
  - **注意事项**：所有数据库操作必须支持事务。
  - **关联**：与前端UI、AI服务、缓存系统紧密关联。

- **AI集成**：FastGPT、阿里云千问、硅基流动等多AI服务
- **状态管理**：React Context + Hooks
- **认证与安全**：JWT + Session + RBAC
- **CI/CD与部署**：支持生产级自动化部署

### 系统分层
- WebUI/管理端 → API网关 → 认证/限流 → 业务服务（对话、CAD、海报、管理）→ AI集成 → 数据/缓存/文件存储

---

## 3. 目录结构规范与说明

### 详细设计方案
- **规范**：
  - `app/`目录用于存放Next.js页面和API路由。
  - `lib/`目录用于存放业务逻辑和工具函数。
- **注意事项**：
  - 避免在`app/`目录下直接存放业务逻辑代码。
  - 所有共享组件必须放在`components/`目录下。
- **关联**：与前端开发规范、后端API设计紧密关联。

```
project-root/
├── app/                # Next.js App Router，页面与API
│   ├── (public)/       # 用户端页面（chat/cad-analyzer/poster-generator等）
│   ├── admin/          # 管理端页面（dashboard/ai-models/analytics等）
│   └── api/            # API路由（ag-ui/admin/ai-models/metrics等）
├── components/         # 复用UI组件（按业务/功能分子目录）
├── lib/                # 业务逻辑与工具库（agents/ai-models/auth等）
├── config/             # 配置文件（数据库/AI服务/常量等）
├── contexts/           # 全局状态与上下文
├── hooks/              # 自定义Hooks
├── types/              # 类型定义（分业务/核心/接口等）
├── prisma/             # 数据库schema与迁移
├── public/             # 静态资源
├── styles/             # 全局样式
├── docs/               # 项目文档
└── scripts/            # 工具脚本
```
- 目录分层清晰，API、页面、组件、业务逻辑、类型、配置等职责单一，便于维护和扩展。
- 严格区分用户端与管理端，AI模型管理等敏感功能仅限管理端。

---

## 4. 各核心模块设计方案

### 详细设计方案
- **智能体广场模块**：
  - **规范**：支持多智能体协同，确保UI响应速度。
  - **注意事项**：避免频繁请求AI服务，使用缓存优化性能。
  - **关联**：与AI服务、用户认证模块紧密关联。
- **CAD分析模块**：
  - **规范**：支持高精度CAD文件解析。
  - **注意事项**：文件上传需支持断点续传。
  - **关联**：与文件存储、AI服务紧密关联。

### 4.1 对话智能体（/chat）
- 基于FastGPT，支持多轮对话、上下文管理、工具调用、事件流处理。
- 组件化UI，支持主题切换、动画、响应式。

### 4.2 CAD分析专家（/cad-analyzer）
- 支持CAD文件上传、解析、3D渲染与安防布局分析。
- 前后端分离，后端负责文件处理与AI分析。

### 4.3 海报设计师（/poster-generator）
- AI驱动的创意海报生成，支持模板、风格、配色、尺寸等多维度配置。
- 任务队列、生成历史、导出PDF等功能。

### 4.4 管理端（/admin）
- 智能体、AI模型、数据分析、系统配置等管理功能。
- 严格RBAC权限控制，敏感操作需管理员认证。

### 4.5 API设计
- RESTful风格，分用户端（ag-ui）与管理端（admin）API。
- 统一错误处理、日志、限流、认证。

---

## 5. 数据库与类型设计

### 详细设计方案
- **规范**：
  - 使用Prisma Schema定义数据库模型。
  - 所有表必须包含`createdAt`和`updatedAt`字段。
- **注意事项**：
  - 避免使用过多的JOIN操作，优先使用索引优化查询。
  - 所有敏感数据必须加密存储。
- **关联**：与后端API、业务逻辑紧密关联。

- 采用Prisma + PostgreSQL，模型涵盖用户、会话、消息、海报、AI模型、配置、日志等。
- 类型定义分层（core/agents/chat/cad/api/admin等），TS类型与数据库模型强一致。
- 典型模型：User、ChatSession、PosterTask、AgentConfig、UsageStats、ErrorLog等。

---

## 6. UI/UX设计理念

### 详细设计方案
- **规范**：
  - 使用Tailwind CSS + Radix UI，确保UI一致性。
  - 所有交互必须支持无障碍访问。
- **注意事项**：
  - 避免过度动画，确保页面加载速度。
  - 所有按钮必须提供明确的反馈。
- **关联**：与前端开发规范、用户认证模块紧密关联。

- 现代化、专业化、一致性（主色调#6cb33f，明暗主题，响应式断点）
- 动效丰富（Framer Motion），卡片、侧边栏、粒子、角色动画等
- 组件库分层（基础UI/业务组件/管理端专属）
- 逐步集成AG-UI，事件流、状态同步、工具调用等能力

---

## 7. 开发规范与最佳实践

### 详细设计方案
- **规范**：
  - 所有代码必须通过ESLint和Prettier检查。
  - 提交代码前必须运行单元测试。
- **注意事项**：
  - 避免在代码中使用魔法数字。
  - 所有函数必须有清晰的注释。
- **关联**：与CI/CD流程、代码审查紧密关联。

- 严格遵守《PROJECT-DEVELOPMENT-STANDARDS.md》
- 目录结构、命名、类型、接口、权限、异常、日志、测试等全局一致
- 生产级代码质量（类型安全、单元/集成测试、CI、代码审查）
- 用户端与管理端功能边界清晰，敏感功能仅限管理端
- 配置与密钥安全管理，环境变量分离

---

## 8. 生产级交付要求

### 详细设计方案
- **规范**：
  - 所有部署必须通过CI/CD流程。
  - 生产环境必须启用监控和告警。
- **注意事项**：
  - 避免在生产环境直接修改数据库。
  - 所有配置必须通过环境变量管理。
- **关联**：与系统架构、开发规范紧密关联。

- 高可用、可扩展、易维护
- 完善的异常处理与日志
- 严格权限与安全控制
- 自动化测试与CI/CD
- 完善文档与开发手册
- UI/UX与交互体验达到行业高端水准

---

> 本文档为本项目设计与开发的权威蓝图，所有开发、架构、测试、运维等环节均须严格遵循。 