e8bcb1b115ea035aeb95b8098eb986be
"use strict";
// @ts-nocheck
/**
 * 错误重试管理器测试
 * 确保智能对话的错误处理和重试机制100%可靠
 */
Object.defineProperty(exports, "__esModule", { value: true });
const error_retry_manager_1 = require("@/lib/chat/error-retry-manager");
describe('ErrorRetryManager - 智能对话错误重试管理', () => {
    let errorRetryManager;
    beforeEach(() => {
        errorRetryManager = new error_retry_manager_1.ErrorRetryManager();
    });
    afterEach(() => {
        jest.clearAllMocks();
    });
    describe('基础功能测试', () => {
        test('应该正确初始化错误重试管理器', () => {
            expect(errorRetryManager).toBeDefined();
            expect(errorRetryManager).toBeInstanceOf(error_retry_manager_1.ErrorRetryManager);
        });
        test('应该正确设置默认配置', () => {
            const config = errorRetryManager.getConfig();
            expect(config).toMatchObject({
                maxRetries: expect.any(Number),
                baseDelay: expect.any(Number),
                maxDelay: expect.any(Number),
                backoffMultiplier: expect.any(Number)
            });
        });
    });
    describe('错误分类测试', () => {
        test('应该正确识别网络错误', () => {
            const networkError = new Error('Network request failed');
            networkError.name = 'NetworkError';
            const isRetryable = errorRetryManager.isRetryableError(networkError);
            expect(isRetryable).toBe(true);
        });
        test('应该正确识别超时错误', () => {
            const timeoutError = new Error('Request timeout');
            timeoutError.name = 'TimeoutError';
            const isRetryable = errorRetryManager.isRetryableError(timeoutError);
            expect(isRetryable).toBe(true);
        });
        test('应该正确识别服务器错误', () => {
            const serverError = new Error('Internal server error');
            serverError.name = 'ServerError';
            const isRetryable = errorRetryManager.isRetryableError(serverError);
            expect(isRetryable).toBe(true);
        });
        test('应该正确识别不可重试错误', () => {
            const authError = new Error('Unauthorized');
            authError.name = 'AuthError';
            const isRetryable = errorRetryManager.isRetryableError(authError);
            expect(isRetryable).toBe(false);
        });
    });
    describe('重试延迟计算测试', () => {
        test('应该正确计算指数退避延迟', () => {
            const delay1 = errorRetryManager.calculateDelay(1);
            const delay2 = errorRetryManager.calculateDelay(2);
            const delay3 = errorRetryManager.calculateDelay(3);
            expect(delay1).toBeGreaterThan(0);
            expect(delay2).toBeGreaterThan(delay1);
            expect(delay3).toBeGreaterThan(delay2);
        });
        test('应该限制最大延迟时间', () => {
            const maxDelay = errorRetryManager.getConfig().maxDelay;
            const delay = errorRetryManager.calculateDelay(10);
            expect(delay).toBeLessThanOrEqual(maxDelay);
        });
        test('应该添加随机抖动', () => {
            const delay1 = errorRetryManager.calculateDelay(1);
            const delay2 = errorRetryManager.calculateDelay(1);
            // 由于随机抖动，两次计算的延迟可能不同
            expect(delay1).toBeGreaterThan(0);
            expect(delay2).toBeGreaterThan(0);
        });
    });
    describe('重试执行测试', () => {
        test('应该在成功时立即返回结果', async () => {
            const successFn = jest.fn().mockResolvedValue('success');
            const result = await errorRetryManager.executeWithRetry(successFn);
            expect(result).toBe('success');
            expect(successFn).toHaveBeenCalledTimes(1);
        });
        test('应该在可重试错误时进行重试', async () => {
            const retryableFn = jest.fn()
                .mockRejectedValueOnce(new Error('Network error'))
                .mockRejectedValueOnce(new Error('Timeout error'))
                .mockResolvedValue('success');
            const result = await errorRetryManager.executeWithRetry(retryableFn);
            expect(result).toBe('success');
            expect(retryableFn).toHaveBeenCalledTimes(3);
        });
        test('应该在达到最大重试次数后抛出错误', async () => {
            const failingFn = jest.fn().mockRejectedValue(new Error('Persistent error'));
            await expect(errorRetryManager.executeWithRetry(failingFn))
                .rejects.toThrow('Persistent error');
            const maxRetries = errorRetryManager.getConfig().maxRetries;
            expect(failingFn).toHaveBeenCalledTimes(maxRetries + 1);
        });
        test('应该在不可重试错误时立即抛出', async () => {
            const authError = new Error('Unauthorized');
            authError.name = 'AuthError';
            const nonRetryableFn = jest.fn().mockRejectedValue(authError);
            await expect(errorRetryManager.executeWithRetry(nonRetryableFn))
                .rejects.toThrow('Unauthorized');
            expect(nonRetryableFn).toHaveBeenCalledTimes(1);
        });
    });
    describe('错误统计测试', () => {
        test('应该正确记录错误统计', async () => {
            const failingFn = jest.fn().mockRejectedValue(new Error('Test error'));
            try {
                await errorRetryManager.executeWithRetry(failingFn);
            }
            catch (error) {
                // 预期的错误
            }
            const stats = errorRetryManager.getErrorStats();
            expect(stats.totalErrors).toBeGreaterThan(0);
            expect(stats.retryAttempts).toBeGreaterThan(0);
        });
        test('应该正确分类错误类型统计', async () => {
            const networkError = new Error('Network error');
            networkError.name = 'NetworkError';
            const networkFn = jest.fn().mockRejectedValue(networkError);
            try {
                await errorRetryManager.executeWithRetry(networkFn);
            }
            catch (error) {
                // 预期的错误
            }
            const stats = errorRetryManager.getErrorStats();
            expect(stats.errorTypes['NetworkError']).toBeGreaterThan(0);
        });
    });
    describe('配置更新测试', () => {
        test('应该允许更新重试配置', () => {
            const newConfig = {
                maxRetries: 5,
                baseDelay: 2000,
                maxDelay: 30000,
                backoffMultiplier: 3
            };
            errorRetryManager.updateConfig(newConfig);
            const updatedConfig = errorRetryManager.getConfig();
            expect(updatedConfig).toMatchObject(newConfig);
        });
        test('应该验证配置参数的有效性', () => {
            const invalidConfig = {
                maxRetries: -1,
                baseDelay: 0,
                maxDelay: -1000,
                backoffMultiplier: 0
            };
            expect(() => errorRetryManager.updateConfig(invalidConfig))
                .toThrow('Invalid configuration');
        });
    });
    describe('并发处理测试', () => {
        test('应该正确处理并发重试请求', async () => {
            const concurrentFns = Array.from({ length: 5 }, (_, i) => jest.fn()
                .mockRejectedValueOnce(new Error(`Error ${i}`))
                .mockResolvedValue(`Success ${i}`));
            const promises = concurrentFns.map(fn => errorRetryManager.executeWithRetry(fn));
            const results = await Promise.all(promises);
            expect(results).toEqual([
                'Success 0',
                'Success 1',
                'Success 2',
                'Success 3',
                'Success 4'
            ]);
        });
    });
    describe('内存管理测试', () => {
        test('应该正确清理过期的错误记录', () => {
            // 模拟大量错误记录
            for (let i = 0; i < 1000; i++) {
                errorRetryManager.recordError(new Error(`Error ${i}`));
            }
            const statsBefore = errorRetryManager.getErrorStats();
            expect(statsBefore.totalErrors).toBe(1000);
            // 清理过期记录
            errorRetryManager.cleanup();
            const statsAfter = errorRetryManager.getErrorStats();
            expect(statsAfter.totalErrors).toBeLessThan(1000);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRTpcXHprLWFnZW50XFxfX3Rlc3RzX19cXGxpYlxcY2hhdFxcZXJyb3ItcmV0cnktbWFuYWdlci50ZXN0LnRzIiwibWFwcGluZ3MiOiI7QUFBQSxjQUFjO0FBQ2Q7OztHQUdHOztBQUVILHdFQUFrRTtBQUVsRSxRQUFRLENBQUMsZ0NBQWdDLEVBQUUsR0FBRyxFQUFFO0lBQzlDLElBQUksaUJBQW9DLENBQUE7SUFFeEMsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNkLGlCQUFpQixHQUFHLElBQUksdUNBQWlCLEVBQUUsQ0FBQTtJQUM3QyxDQUFDLENBQUMsQ0FBQTtJQUVGLFNBQVMsQ0FBQyxHQUFHLEVBQUU7UUFDYixJQUFJLENBQUMsYUFBYSxFQUFFLENBQUE7SUFDdEIsQ0FBQyxDQUFDLENBQUE7SUFFRixRQUFRLENBQUMsUUFBUSxFQUFFLEdBQUcsRUFBRTtRQUN0QixJQUFJLENBQUMsZ0JBQWdCLEVBQUUsR0FBRyxFQUFFO1lBQzFCLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFBO1lBQ3ZDLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLGNBQWMsQ0FBQyx1Q0FBaUIsQ0FBQyxDQUFBO1FBQzdELENBQUMsQ0FBQyxDQUFBO1FBRUYsSUFBSSxDQUFDLFlBQVksRUFBRSxHQUFHLEVBQUU7WUFDdEIsTUFBTSxNQUFNLEdBQUcsaUJBQWlCLENBQUMsU0FBUyxFQUFFLENBQUE7WUFDNUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLGFBQWEsQ0FBQztnQkFDM0IsVUFBVSxFQUFFLE1BQU0sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDO2dCQUM5QixTQUFTLEVBQUUsTUFBTSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUM7Z0JBQzdCLFFBQVEsRUFBRSxNQUFNLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQztnQkFDNUIsaUJBQWlCLEVBQUUsTUFBTSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUM7YUFDdEMsQ0FBQyxDQUFBO1FBQ0osQ0FBQyxDQUFDLENBQUE7SUFD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aUIsQ0FBQyxPQUFPLEVBQUUsQ0FBQTtZQUUzQixNQUFNLFVBQVUsR0FBRyxpQkFBaUIsQ0FBQyxhQUFhLEVBQUUsQ0FBQTtZQUNwRCxNQUFNLENBQUMsVUFBVSxDQUFDLFdBQVcsQ0FBQyxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQTtRQUNuRCxDQUFDLENBQUMsQ0FBQTtJQUNKLENBQUMsQ0FBQyxDQUFBO0FBQ0osQ0FBQyxDQUFDLENBQUEiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiRTpcXHprLWFnZW50XFxfX3Rlc3RzX19cXGxpYlxcY2hhdFxcZXJyb3ItcmV0cnktbWFuYWdlci50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIEB0cy1ub2NoZWNrXG4vKipcclxuICog6ZSZ6K+v6YeN6K+V566h55CG5Zmo5rWL6K+VXHJcbiAqIOehruS/neaZuuiDveWvueivneeahOmUmeivr+WkhOeQhuWSjOmHjeivleacuuWItjEwMCXlj6/pnaBcclxuICovXHJcblxyXG5pbXBvcnQgeyBFcnJvclJldHJ5TWFuYWdlciB9IGZyb20gJ0AvbGliL2NoYXQvZXJyb3ItcmV0cnktbWFuYWdlcidcclxuXHJcbmRlc2NyaWJlKCdFcnJvclJldHJ5TWFuYWdlciAtIOaZuuiDveWvueivnemUmeivr+mHjeivleeuoeeQhicsICgpID0+IHtcclxuICBsZXQgZXJyb3JSZXRyeU1hbmFnZXI6IEVycm9yUmV0cnlNYW5hZ2VyXHJcbiAgXHJcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICBlcnJvclJldHJ5TWFuYWdlciA9IG5ldyBFcnJvclJldHJ5TWFuYWdlcigpXHJcbiAgfSlcclxuICBcclxuICBhZnRlckVhY2goKCkgPT4ge1xyXG4gICAgamVzdC5jbGVhckFsbE1vY2tzKClcclxuICB9KVxyXG5cclxuICBkZXNjcmliZSgn5Z+656GA5Yqf6IO95rWL6K+VJywgKCkgPT4ge1xyXG4gICAgdGVzdCgn5bqU6K+l5q2j56Gu5Yid5aeL5YyW6ZSZ6K+v6YeN6K+V566h55CG5ZmoJywgKCkgPT4ge1xyXG4gICAgICBleHBlY3QoZXJyb3JSZXRyeU1hbmFnZXIpLnRvQmVEZWZpbmVkKClcclxuICAgICAgZXhwZWN0KGVycm9yUmV0cnlNYW5hZ2VyKS50b0JlSW5zdGFuY2VPZihFcnJvclJldHJ5TWFuYWdlcilcclxuICAgIH0pXHJcblxyXG4gICAgdGVzdCgn5bqU6K+l5q2j56Gu6K6+572u6buY6K6k6YWN572uJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBjb25maWcgPSBlcnJvclJldHJ5TWFuYWdlci5nZXRDb25maWcoKVxyXG4gICAgICBleHBlY3QoY29uZmlnKS50b01hdGNoT2JqZWN0KHtcclxuICAgICAgICBtYXhSZXRyaWVzOiBleHBlY3QuYW55KE51bWJlciksXHJcbiAgICAgICAgYmFzZURlbGF5OiBleHBlY3QuYW55KE51bWJlciksXHJcbiAgICAgICAgbWF4RGVsYXk6IGV4cGVjdC5hbnkoTnVtYmVyKSxcclxuICAgICAgICBiYWNrb2ZmTXVsdGlwbGllcjogZXhwZWN0LmFueShOdW1iZXIpXHJcbiAgICAgIH0pXHJcbiAgICB9KVxyXG4gIH0pXHJcblxyXG4gIGRlc2NyaWJlKCfplJnor6/liIbnsbvmtYvor5UnLCAoKSA9PiB7XHJcbiAgICB0ZXN0KCflupTor6XmraPnoa7or4bliKvnvZHnu5zplJnor68nLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IG5ldHdvcmtFcnJvciA9IG5ldyBFcnJvcignTmV0d29yayByZXF1ZXN0IGZhaWxlZCcpXHJcbiAgICAgIG5ldHdvcmtFcnJvci5uYW1lID0gJ05ldHdvcmtFcnJvcidcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IGlzUmV0cnlhYmxlID0gZXJyb3JSZXRyeU1hbmFnZXIuaXNSZXRyeWFibGVFcnJvcihuZXR3b3JrRXJyb3IpXHJcbiAgICAgIGV4cGVjdChpc1JldHJ5YWJsZSkudG9CZSh0cnVlKVxyXG4gICAgfSlcclxuXHJcbiAgICB0ZXN0KCflupTor6XmraPnoa7or4bliKvotoXml7bplJnor68nLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHRpbWVvdXRFcnJvciA9IG5ldyBFcnJvcignUmVxdWVzdCB0aW1lb3V0JylcclxuICAgICAgdGltZW91dEVycm9yLm5hbWUgPSAnVGltZW91dEVycm9yJ1xyXG4gICAgICBcclxuICAgICAgY29uc3QgaXNSZXRyeWFibGUgPSBlcnJvclJldHJ5TWFuYWdlci5pc1JldHJ5YWJsZUVycm9yKHRpbWVvdXRFcnJvcilcclxuICAgICAgZXhwZWN0KGlzUmV0cnlhYmxlKS50b0JlKHRydWUpXHJcbiAgICB9KVxyXG5cclxuICAgIHRlc3QoJ+W6lOivpeato+ehruivhuWIq+acjeWKoeWZqOmUmeivrycsICgpID0+IHtcclxuICAgICAgY29uc3Qgc2VydmVyRXJyb3IgPSBuZXcgRXJyb3IoJ0ludGVybmFsIHNlcnZlciBlcnJvcicpXHJcbiAgICAgIHNlcnZlckVycm9yLm5hbWUgPSAnU2VydmVyRXJyb3InXHJcbiAgICAgIFxyXG4gICAgICBjb25zdCBpc1JldHJ5YWJsZSA9IGVycm9yUmV0cnlNYW5hZ2VyLmlzUmV0cnlhYmxlRXJyb3Ioc2VydmVyRXJyb3IpXHJcbiAgICAgIGV4cGVjdChpc1JldHJ5YWJsZSkudG9CZSh0cnVlKVxyXG4gICAgfSlcclxuXHJcbiAgICB0ZXN0KCflupTor6XmraPnoa7or4bliKvkuI3lj6/ph43or5XplJnor68nLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGF1dGhFcnJvciA9IG5ldyBFcnJvcignVW5hdXRob3JpemVkJylcclxuICAgICAgYXV0aEVycm9yLm5hbWUgPSAnQXV0aEVycm9yJ1xyXG4gICAgICBcclxuICAgICAgY29uc3QgaXNSZXRyeWFibGUgPSBlcnJvclJldHJ5TWFuYWdlci5pc1JldHJ5YWJsZUVycm9yKGF1dGhFcnJvcilcclxuICAgICAgZXhwZWN0KGlzUmV0cnlhYmxlKS50b0JlKGZhbHNlKVxyXG4gICAgfSlcclxuICB9KVxyXG5cclxuICBkZXNjcmliZSgn6YeN6K+V5bu26L+f6K6h566X5rWL6K+VJywgKCkgPT4ge1xyXG4gICAgdGVzdCgn5bqU6K+l5q2j56Gu6K6h566X5oyH5pWw6YCA6YG/5bu26L+fJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBkZWxheTEgPSBlcnJvclJldHJ5TWFuYWdlci5jYWxjdWxhdGVEZWxheSgxKVxyXG4gICAgICBjb25zdCBkZWxheTIgPSBlcnJvclJldHJ5TWFuYWdlci5jYWxjdWxhdGVEZWxheSgyKVxyXG4gICAgICBjb25zdCBkZWxheTMgPSBlcnJvclJldHJ5TWFuYWdlci5jYWxjdWxhdGVEZWxheSgzKVxyXG4gICAgICBcclxuICAgICAgZXhwZWN0KGRlbGF5MSkudG9CZUdyZWF0ZXJUaGFuKDApXHJcbiAgICAgIGV4cGVjdChkZWxheTIpLnRvQmVHcmVhdGVyVGhhbihkZWxheTEpXHJcbiAgICAgIGV4cGVjdChkZWxheTMpLnRvQmVHcmVhdGVyVGhhbihkZWxheTIpXHJcbiAgICB9KVxyXG5cclxuICAgIHRlc3QoJ+W6lOivpemZkOWItuacgOWkp+W7tui/n+aXtumXtCcsICgpID0+IHtcclxuICAgICAgY29uc3QgbWF4RGVsYXkgPSBlcnJvclJldHJ5TWFuYWdlci5nZXRDb25maWcoKS5tYXhEZWxheVxyXG4gICAgICBjb25zdCBkZWxheSA9IGVycm9yUmV0cnlNYW5hZ2VyLmNhbGN1bGF0ZURlbGF5KDEwKVxyXG4gICAgICBcclxuICAgICAgZXhwZWN0KGRlbGF5KS50b0JlTGVzc1RoYW5PckVxdWFsKG1heERlbGF5KVxyXG4gICAgfSlcclxuXHJcbiAgICB0ZXN0KCflupTor6Xmt7vliqDpmo/mnLrmipbliqgnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGRlbGF5MSA9IGVycm9yUmV0cnlNYW5hZ2VyLmNhbGN1bGF0ZURlbGF5KDEpXHJcbiAgICAgIGNvbnN0IGRlbGF5MiA9IGVycm9yUmV0cnlNYW5hZ2VyLmNhbGN1bGF0ZURlbGF5KDEpXHJcbiAgICAgIFxyXG4gICAgICAvLyDnlLHkuo7pmo/mnLrmipbliqjvvIzkuKTmrKHorqHnrpfnmoTlu7bov5/lj6/og73kuI3lkIxcclxuICAgICAgZXhwZWN0KGRlbGF5MSkudG9CZUdyZWF0ZXJUaGFuKDApXHJcbiAgICAgIGV4cGVjdChkZWxheTIpLnRvQmVHcmVhdGVyVGhhbigwKVxyXG4gICAgfSlcclxuICB9KVxyXG5cclxuICBkZXNjcmliZSgn6YeN6K+V5omn6KGM5rWL6K+VJywgKCkgPT4ge1xyXG4gICAgdGVzdCgn5bqU6K+l5Zyo5oiQ5Yqf5pe256uL5Y2z6L+U5Zue57uT5p6cJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBzdWNjZXNzRm4gPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoJ3N1Y2Nlc3MnKVxyXG4gICAgICBcclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZXJyb3JSZXRyeU1hbmFnZXIuZXhlY3V0ZVdpdGhSZXRyeShzdWNjZXNzRm4pXHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKCdzdWNjZXNzJylcclxuICAgICAgZXhwZWN0KHN1Y2Nlc3NGbikudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDEpXHJcbiAgICB9KVxyXG5cclxuICAgIHRlc3QoJ+W6lOivpeWcqOWPr+mHjeivlemUmeivr+aXtui/m+ihjOmHjeivlScsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgcmV0cnlhYmxlRm4gPSBqZXN0LmZuKClcclxuICAgICAgICAubW9ja1JlamVjdGVkVmFsdWVPbmNlKG5ldyBFcnJvcignTmV0d29yayBlcnJvcicpKVxyXG4gICAgICAgIC5tb2NrUmVqZWN0ZWRWYWx1ZU9uY2UobmV3IEVycm9yKCdUaW1lb3V0IGVycm9yJykpXHJcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlKCdzdWNjZXNzJylcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGVycm9yUmV0cnlNYW5hZ2VyLmV4ZWN1dGVXaXRoUmV0cnkocmV0cnlhYmxlRm4pXHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKCdzdWNjZXNzJylcclxuICAgICAgZXhwZWN0KHJldHJ5YWJsZUZuKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMylcclxuICAgIH0pXHJcblxyXG4gICAgdGVzdCgn5bqU6K+l5Zyo6L6+5Yiw5pyA5aSn6YeN6K+V5qyh5pWw5ZCO5oqb5Ye66ZSZ6K+vJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBmYWlsaW5nRm4gPSBqZXN0LmZuKCkubW9ja1JlamVjdGVkVmFsdWUobmV3IEVycm9yKCdQZXJzaXN0ZW50IGVycm9yJykpXHJcbiAgICAgIFxyXG4gICAgICBhd2FpdCBleHBlY3QoZXJyb3JSZXRyeU1hbmFnZXIuZXhlY3V0ZVdpdGhSZXRyeShmYWlsaW5nRm4pKVxyXG4gICAgICAgIC5yZWplY3RzLnRvVGhyb3coJ1BlcnNpc3RlbnQgZXJyb3InKVxyXG4gICAgICBcclxuICAgICAgY29uc3QgbWF4UmV0cmllcyA9IGVycm9yUmV0cnlNYW5hZ2VyLmdldENvbmZpZygpLm1heFJldHJpZXNcclxuICAgICAgZXhwZWN0KGZhaWxpbmdGbikudG9IYXZlQmVlbkNhbGxlZFRpbWVzKG1heFJldHJpZXMgKyAxKVxyXG4gICAgfSlcclxuXHJcbiAgICB0ZXN0KCflupTor6XlnKjkuI3lj6/ph43or5XplJnor6/ml7bnq4vljbPmipvlh7onLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGF1dGhFcnJvciA9IG5ldyBFcnJvcignVW5hdXRob3JpemVkJylcclxuICAgICAgYXV0aEVycm9yLm5hbWUgPSAnQXV0aEVycm9yJ1xyXG4gICAgICBjb25zdCBub25SZXRyeWFibGVGbiA9IGplc3QuZm4oKS5tb2NrUmVqZWN0ZWRWYWx1ZShhdXRoRXJyb3IpXHJcbiAgICAgIFxyXG4gICAgICBhd2FpdCBleHBlY3QoZXJyb3JSZXRyeU1hbmFnZXIuZXhlY3V0ZVdpdGhSZXRyeShub25SZXRyeWFibGVGbikpXHJcbiAgICAgICAgLnJlamVjdHMudG9UaHJvdygnVW5hdXRob3JpemVkJylcclxuICAgICAgXHJcbiAgICAgIGV4cGVjdChub25SZXRyeWFibGVGbikudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDEpXHJcbiAgICB9KVxyXG4gIH0pXHJcblxyXG4gIGRlc2NyaWJlKCfplJnor6/nu5/orqHmtYvor5UnLCAoKSA9PiB7XHJcbiAgICB0ZXN0KCflupTor6XmraPnoa7orrDlvZXplJnor6/nu5/orqEnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGZhaWxpbmdGbiA9IGplc3QuZm4oKS5tb2NrUmVqZWN0ZWRWYWx1ZShuZXcgRXJyb3IoJ1Rlc3QgZXJyb3InKSlcclxuICAgICAgXHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgYXdhaXQgZXJyb3JSZXRyeU1hbmFnZXIuZXhlY3V0ZVdpdGhSZXRyeShmYWlsaW5nRm4pXHJcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgLy8g6aKE5pyf55qE6ZSZ6K+vXHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIGNvbnN0IHN0YXRzID0gZXJyb3JSZXRyeU1hbmFnZXIuZ2V0RXJyb3JTdGF0cygpXHJcbiAgICAgIGV4cGVjdChzdGF0cy50b3RhbEVycm9ycykudG9CZUdyZWF0ZXJUaGFuKDApXHJcbiAgICAgIGV4cGVjdChzdGF0cy5yZXRyeUF0dGVtcHRzKS50b0JlR3JlYXRlclRoYW4oMClcclxuICAgIH0pXHJcblxyXG4gICAgdGVzdCgn5bqU6K+l5q2j56Gu5YiG57G76ZSZ6K+v57G75Z6L57uf6K6hJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBuZXR3b3JrRXJyb3IgPSBuZXcgRXJyb3IoJ05ldHdvcmsgZXJyb3InKVxyXG4gICAgICBuZXR3b3JrRXJyb3IubmFtZSA9ICdOZXR3b3JrRXJyb3InXHJcbiAgICAgIGNvbnN0IG5ldHdvcmtGbiA9IGplc3QuZm4oKS5tb2NrUmVqZWN0ZWRWYWx1ZShuZXR3b3JrRXJyb3IpXHJcbiAgICAgIFxyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGF3YWl0IGVycm9yUmV0cnlNYW5hZ2VyLmV4ZWN1dGVXaXRoUmV0cnkobmV0d29ya0ZuKVxyXG4gICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIC8vIOmihOacn+eahOmUmeivr1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCBzdGF0cyA9IGVycm9yUmV0cnlNYW5hZ2VyLmdldEVycm9yU3RhdHMoKVxyXG4gICAgICBleHBlY3Qoc3RhdHMuZXJyb3JUeXBlc1snTmV0d29ya0Vycm9yJ10pLnRvQmVHcmVhdGVyVGhhbigwKVxyXG4gICAgfSlcclxuICB9KVxyXG5cclxuICBkZXNjcmliZSgn6YWN572u5pu05paw5rWL6K+VJywgKCkgPT4ge1xyXG4gICAgdGVzdCgn5bqU6K+l5YWB6K645pu05paw6YeN6K+V6YWN572uJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBuZXdDb25maWcgPSB7XHJcbiAgICAgICAgbWF4UmV0cmllczogNSxcclxuICAgICAgICBiYXNlRGVsYXk6IDIwMDAsXHJcbiAgICAgICAgbWF4RGVsYXk6IDMwMDAwLFxyXG4gICAgICAgIGJhY2tvZmZNdWx0aXBsaWVyOiAzXHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIGVycm9yUmV0cnlNYW5hZ2VyLnVwZGF0ZUNvbmZpZyhuZXdDb25maWcpXHJcbiAgICAgIGNvbnN0IHVwZGF0ZWRDb25maWcgPSBlcnJvclJldHJ5TWFuYWdlci5nZXRDb25maWcoKVxyXG4gICAgICBcclxuICAgICAgZXhwZWN0KHVwZGF0ZWRDb25maWcpLnRvTWF0Y2hPYmplY3QobmV3Q29uZmlnKVxyXG4gICAgfSlcclxuXHJcbiAgICB0ZXN0KCflupTor6Xpqozor4HphY3nva7lj4LmlbDnmoTmnInmlYjmgKcnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGludmFsaWRDb25maWcgPSB7XHJcbiAgICAgICAgbWF4UmV0cmllczogLTEsXHJcbiAgICAgICAgYmFzZURlbGF5OiAwLFxyXG4gICAgICAgIG1heERlbGF5OiAtMTAwMCxcclxuICAgICAgICBiYWNrb2ZmTXVsdGlwbGllcjogMFxyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QoKCkgPT4gZXJyb3JSZXRyeU1hbmFnZXIudXBkYXRlQ29uZmlnKGludmFsaWRDb25maWcpKVxyXG4gICAgICAgIC50b1Rocm93KCdJbnZhbGlkIGNvbmZpZ3VyYXRpb24nKVxyXG4gICAgfSlcclxuICB9KVxyXG5cclxuICBkZXNjcmliZSgn5bm25Y+R5aSE55CG5rWL6K+VJywgKCkgPT4ge1xyXG4gICAgdGVzdCgn5bqU6K+l5q2j56Gu5aSE55CG5bm25Y+R6YeN6K+V6K+35rGCJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBjb25jdXJyZW50Rm5zID0gQXJyYXkuZnJvbSh7IGxlbmd0aDogNSB9LCAoXywgaSkgPT4gXHJcbiAgICAgICAgamVzdC5mbigpXHJcbiAgICAgICAgICAubW9ja1JlamVjdGVkVmFsdWVPbmNlKG5ldyBFcnJvcihgRXJyb3IgJHtpfWApKVxyXG4gICAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlKGBTdWNjZXNzICR7aX1gKVxyXG4gICAgICApXHJcbiAgICAgIFxyXG4gICAgICBjb25zdCBwcm9taXNlcyA9IGNvbmN1cnJlbnRGbnMubWFwKGZuID0+IFxyXG4gICAgICAgIGVycm9yUmV0cnlNYW5hZ2VyLmV4ZWN1dGVXaXRoUmV0cnkoZm4pXHJcbiAgICAgIClcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IHJlc3VsdHMgPSBhd2FpdCBQcm9taXNlLmFsbChwcm9taXNlcylcclxuICAgICAgXHJcbiAgICAgIGV4cGVjdChyZXN1bHRzKS50b0VxdWFsKFtcclxuICAgICAgICAnU3VjY2VzcyAwJyxcclxuICAgICAgICAnU3VjY2VzcyAxJywgXHJcbiAgICAgICAgJ1N1Y2Nlc3MgMicsXHJcbiAgICAgICAgJ1N1Y2Nlc3MgMycsXHJcbiAgICAgICAgJ1N1Y2Nlc3MgNCdcclxuICAgICAgXSlcclxuICAgIH0pXHJcbiAgfSlcclxuXHJcbiAgZGVzY3JpYmUoJ+WGheWtmOeuoeeQhua1i+ivlScsICgpID0+IHtcclxuICAgIHRlc3QoJ+W6lOivpeato+ehrua4heeQhui/h+acn+eahOmUmeivr+iusOW9lScsICgpID0+IHtcclxuICAgICAgLy8g5qih5ouf5aSn6YeP6ZSZ6K+v6K6w5b2VXHJcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTAwMDsgaSsrKSB7XHJcbiAgICAgICAgZXJyb3JSZXRyeU1hbmFnZXIucmVjb3JkRXJyb3IobmV3IEVycm9yKGBFcnJvciAke2l9YCkpXHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIGNvbnN0IHN0YXRzQmVmb3JlID0gZXJyb3JSZXRyeU1hbmFnZXIuZ2V0RXJyb3JTdGF0cygpXHJcbiAgICAgIGV4cGVjdChzdGF0c0JlZm9yZS50b3RhbEVycm9ycykudG9CZSgxMDAwKVxyXG4gICAgICBcclxuICAgICAgLy8g5riF55CG6L+H5pyf6K6w5b2VXHJcbiAgICAgIGVycm9yUmV0cnlNYW5hZ2VyLmNsZWFudXAoKVxyXG4gICAgICBcclxuICAgICAgY29uc3Qgc3RhdHNBZnRlciA9IGVycm9yUmV0cnlNYW5hZ2VyLmdldEVycm9yU3RhdHMoKVxyXG4gICAgICBleHBlY3Qoc3RhdHNBZnRlci50b3RhbEVycm9ycykudG9CZUxlc3NUaGFuKDEwMDApXHJcbiAgICB9KVxyXG4gIH0pXHJcbn0pICJdLCJ2ZXJzaW9uIjozfQ==