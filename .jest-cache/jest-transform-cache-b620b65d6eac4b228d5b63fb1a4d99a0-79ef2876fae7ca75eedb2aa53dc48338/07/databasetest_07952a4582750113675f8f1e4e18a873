90c40bfaed5c4545669b851df2ba33d4
/**
 * @file database.test.js
 * @description 数据库配置测试
 * @author ZK-Agent Team
 * @date 2025-05-25
 */

const {
  getCurrentConfig,
  validateDatabaseConfig
} = require('../../lib/database/database.config');
describe('数据库配置测试', () => {
  test('应该能够获取测试数据库配置', () => {
    process.env.NODE_ENV = 'test';
    const config = getDatabaseConfig();
    expect(config).toBeDefined();
    expect(config.database).toBe('zkagent2');
    expect(config.port).toBe(5432);
    expect(config.password).toBe('123456');
  });
  test('应该能够获取生产数据库配置', () => {
    process.env.NODE_ENV = 'production';
    const config = getDatabaseConfig();
    expect(config).toBeDefined();
    expect(config.database).toBe('zkagent1');
    expect(config.port).toBe(5432);
    expect(config.password).toBe('123456');
  });
  test('应该能够验证数据库配置', () => {
    expect(validateDatabaseConfig('test')).toBe(true);
    expect(validateDatabaseConfig('production')).toBe(true);
    expect(validateDatabaseConfig('invalid')).toBe(false);
  });
  test('数据库连接字符串格式正确', () => {
    process.env.NODE_ENV = 'test';
    const config = getDatabaseConfig();
    expect(config.connectionString).toMatch(/^postgresql:\/\/postgres:123456@localhost:5432\/zkagent2$/);
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJnZXRDdXJyZW50Q29uZmlnIiwidmFsaWRhdGVEYXRhYmFzZUNvbmZpZyIsInJlcXVpcmUiLCJkZXNjcmliZSIsInRlc3QiLCJwcm9jZXNzIiwiZW52IiwiTk9ERV9FTlYiLCJjb25maWciLCJnZXREYXRhYmFzZUNvbmZpZyIsImV4cGVjdCIsInRvQmVEZWZpbmVkIiwiZGF0YWJhc2UiLCJ0b0JlIiwicG9ydCIsInBhc3N3b3JkIiwiY29ubmVjdGlvblN0cmluZyIsInRvTWF0Y2giXSwic291cmNlcyI6WyJkYXRhYmFzZS50ZXN0LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGZpbGUgZGF0YWJhc2UudGVzdC5qc1xuICogQGRlc2NyaXB0aW9uIOaVsOaNruW6k+mFjee9rua1i+ivlVxuICogQGF1dGhvciBaSy1BZ2VudCBUZWFtXG4gKiBAZGF0ZSAyMDI1LTA1LTI1XG4gKi9cblxuY29uc3QgeyBnZXRDdXJyZW50Q29uZmlnLCB2YWxpZGF0ZURhdGFiYXNlQ29uZmlnIH0gPSByZXF1aXJlKCcuLi8uLi9saWIvZGF0YWJhc2UvZGF0YWJhc2UuY29uZmlnJyk7XG5cbmRlc2NyaWJlKCfmlbDmja7lupPphY3nva7mtYvor5UnLCAoKSA9PiB7XG4gIHRlc3QoJ+W6lOivpeiDveWkn+iOt+WPlua1i+ivleaVsOaNruW6k+mFjee9ricsICgpID0+IHtcbiAgICBwcm9jZXNzLmVudi5OT0RFX0VOViA9ICd0ZXN0JztcbiAgICBjb25zdCBjb25maWcgPSBnZXREYXRhYmFzZUNvbmZpZygpO1xuICAgIFxuICAgIGV4cGVjdChjb25maWcpLnRvQmVEZWZpbmVkKCk7XG4gICAgZXhwZWN0KGNvbmZpZy5kYXRhYmFzZSkudG9CZSgnemthZ2VudDInKTtcbiAgICBleHBlY3QoY29uZmlnLnBvcnQpLnRvQmUoNTQzMik7XG4gICAgZXhwZWN0KGNvbmZpZy5wYXNzd29yZCkudG9CZSgnMTIzNDU2Jyk7XG4gIH0pO1xuXG4gIHRlc3QoJ+W6lOivpeiDveWkn+iOt+WPlueUn+S6p+aVsOaNruW6k+mFjee9ricsICgpID0+IHtcbiAgICBwcm9jZXNzLmVudi5OT0RFX0VOViA9ICdwcm9kdWN0aW9uJztcbiAgICBjb25zdCBjb25maWcgPSBnZXREYXRhYmFzZUNvbmZpZygpO1xuICAgIFxuICAgIGV4cGVjdChjb25maWcpLnRvQmVEZWZpbmVkKCk7XG4gICAgZXhwZWN0KGNvbmZpZy5kYXRhYmFzZSkudG9CZSgnemthZ2VudDEnKTtcbiAgICBleHBlY3QoY29uZmlnLnBvcnQpLnRvQmUoNTQzMik7XG4gICAgZXhwZWN0KGNvbmZpZy5wYXNzd29yZCkudG9CZSgnMTIzNDU2Jyk7XG4gIH0pO1xuXG4gIHRlc3QoJ+W6lOivpeiDveWkn+mqjOivgeaVsOaNruW6k+mFjee9ricsICgpID0+IHtcbiAgICBleHBlY3QodmFsaWRhdGVEYXRhYmFzZUNvbmZpZygndGVzdCcpKS50b0JlKHRydWUpO1xuICAgIGV4cGVjdCh2YWxpZGF0ZURhdGFiYXNlQ29uZmlnKCdwcm9kdWN0aW9uJykpLnRvQmUodHJ1ZSk7XG4gICAgZXhwZWN0KHZhbGlkYXRlRGF0YWJhc2VDb25maWcoJ2ludmFsaWQnKSkudG9CZShmYWxzZSk7XG4gIH0pO1xuXG4gIHRlc3QoJ+aVsOaNruW6k+i/nuaOpeWtl+espuS4suagvOW8j+ato+ehricsICgpID0+IHtcbiAgICBwcm9jZXNzLmVudi5OT0RFX0VOViA9ICd0ZXN0JztcbiAgICBjb25zdCBjb25maWcgPSBnZXREYXRhYmFzZUNvbmZpZygpO1xuICAgIFxuICAgIGV4cGVjdChjb25maWcuY29ubmVjdGlvblN0cmluZykudG9NYXRjaCgvXnBvc3RncmVzcWw6XFwvXFwvcG9zdGdyZXM6MTIzNDU2QGxvY2FsaG9zdDo1NDMyXFwvemthZ2VudDIkLyk7XG4gIH0pO1xufSk7ICJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE1BQU07RUFBRUEsZ0JBQWdCO0VBQUVDO0FBQXVCLENBQUMsR0FBR0MsT0FBTyxDQUFDLG9DQUFvQyxDQUFDO0FBRWxHQyxRQUFRLENBQUMsU0FBUyxFQUFFLE1BQU07RUFDeEJDLElBQUksQ0FBQyxlQUFlLEVBQUUsTUFBTTtJQUMxQkMsT0FBTyxDQUFDQyxHQUFHLENBQUNDLFFBQVEsR0FBRyxNQUFNO0lBQzdCLE1BQU1DLE1BQU0sR0FBR0MsaUJBQWlCLENBQUMsQ0FBQztJQUVsQ0MsTUFBTSxDQUFDRixNQUFNLENBQUMsQ0FBQ0csV0FBVyxDQUFDLENBQUM7SUFDNUJELE1BQU0sQ0FBQ0YsTUFBTSxDQUFDSSxRQUFRLENBQUMsQ0FBQ0MsSUFBSSxDQUFDLFVBQVUsQ0FBQztJQUN4Q0gsTUFBTSxDQUFDRixNQUFNLENBQUNNLElBQUksQ0FBQyxDQUFDRCxJQUFJLENBQUMsSUFBSSxDQUFDO0lBQzlCSCxNQUFNLENBQUNGLE1BQU0sQ0FBQ08sUUFBUSxDQUFDLENBQUNGLElBQUksQ0FBQyxRQUFRLENBQUM7RUFDeEMsQ0FBQyxDQUFDO0VBRUZULElBQUksQ0FBQyxlQUFlLEVBQUUsTUFBTTtJQUMxQkMsT0FBTyxDQUFDQyxHQUFHLENBQUNDLFFBQVEsR0FBRyxZQUFZO0lBQ25DLE1BQU1DLE1BQU0sR0FBR0MsaUJBQWlCLENBQUMsQ0FBQztJQUVsQ0MsTUFBTSxDQUFDRixNQUFNLENBQUMsQ0FBQ0csV0FBVyxDQUFDLENBQUM7SUFDNUJELE1BQU0sQ0FBQ0YsTUFBTSxDQUFDSSxRQUFRLENBQUMsQ0FBQ0MsSUFBSSxDQUFDLFVBQVUsQ0FBQztJQUN4Q0gsTUFBTSxDQUFDRixNQUFNLENBQUNNLElBQUksQ0FBQyxDQUFDRCxJQUFJLENBQUMsSUFBSSxDQUFDO0lBQzlCSCxNQUFNLENBQUNGLE1BQU0sQ0FBQ08sUUFBUSxDQUFDLENBQUNGLElBQUksQ0FBQyxRQUFRLENBQUM7RUFDeEMsQ0FBQyxDQUFDO0VBRUZULElBQUksQ0FBQyxhQUFhLEVBQUUsTUFBTTtJQUN4Qk0sTUFBTSxDQUFDVCxzQkFBc0IsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDWSxJQUFJLENBQUMsSUFBSSxDQUFDO0lBQ2pESCxNQUFNLENBQUNULHNCQUFzQixDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUNZLElBQUksQ0FBQyxJQUFJLENBQUM7SUFDdkRILE1BQU0sQ0FBQ1Qsc0JBQXNCLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQ1ksSUFBSSxDQUFDLEtBQUssQ0FBQztFQUN2RCxDQUFDLENBQUM7RUFFRlQsSUFBSSxDQUFDLGNBQWMsRUFBRSxNQUFNO0lBQ3pCQyxPQUFPLENBQUNDLEdBQUcsQ0FBQ0MsUUFBUSxHQUFHLE1BQU07SUFDN0IsTUFBTUMsTUFBTSxHQUFHQyxpQkFBaUIsQ0FBQyxDQUFDO0lBRWxDQyxNQUFNLENBQUNGLE1BQU0sQ0FBQ1EsZ0JBQWdCLENBQUMsQ0FBQ0MsT0FBTyxDQUFDLDJEQUEyRCxDQUFDO0VBQ3RHLENBQUMsQ0FBQztBQUNKLENBQUMsQ0FBQyIsImlnbm9yZUxpc3QiOltdfQ==