{"version":3,"names":["cov_2fwb4q0jru","path","hash","global","Function","gcv","coverageData","statementMap","start","line","column","end","fnMap","name","decl","loc","branchMap","type","locations","undefined","s","f","b","inputSourceMap","file","mappings","names","sources","sourcesContent","version","_coverageSchema","coverage","actualCoverage","api_route_wrapper_1","require","api_helper_1","exports","POST","createApiRoute","RouteConfigs","protectedPost","req","params","validatedBody","validatedQuery","user","requestId","formData","get","threadId","runId","ApiResponseWrapper","error","allowedTypes","fileExtension","toLowerCase","split","pop","allowedExtensions","includes","analysisResult","summary","totalComponents","Math","floor","random","totalLayers","dimensions","width","height","depth","complexity","components","id","material","quantity","length","riskLevel","issues","recommendations","riskAssessment","overallRisk","criticalIssues","warnings","Promise","resolve","setTimeout","success","data","fileName","fileSize","size","fileType","analysis","processedAt","Date","toISOString"],"sources":["E:\\zk-agent\\app\\api\\ag-ui\\cad-analysis\\route.ts"],"sourcesContent":["/**\n * @file ag-ui\\cad-analysis\\route.ts\n * @description Migrated API route with global error handling\n * @author ZK-Agent Team\n * @date 2025-06-25\n */\n\nimport { NextRequest, NextResponse } from 'next/server';\nimport { createApiRoute, RouteConfigs, CommonValidations } from '@/lib/middleware/api-route-wrapper';\nimport { ApiResponseWrapper } from '@/lib/utils/api-helper';\n\n// CAD分析结果类型定义\ninterface CADAnalysisResult {\n  summary: {\n    totalComponents: number;\n    totalLayers: number;\n    dimensions: {\n      width: number;\n      height: number;\n      depth: number;\n    };\n  };\n}\n\nexport const POST = createApiRoute(\n  RouteConfigs.protectedPost(),\n  async (req: NextRequest, { params, validatedBody, validatedQuery, user, requestId }) => {\n    try {\n      const formData = await req.formData();\n      const file = formData.get(\"file\") as File;\n      const threadId = formData.get(\"threadId\") as string;\n      const runId = formData.get(\"runId\") as string;\n    \n      if (!file) {\n        return ApiResponseWrapper.error('文件不能为空', 400);\n      }\n    \n      // 验证文件类型\n      const allowedTypes = [\n        'application/octet-stream',\n        'application/x-autocad',\n        'application/dwg',\n        'application/dxf',\n        'model/step',\n        'model/iges'\n      ];\n    \n      const fileExtension = file.name.toLowerCase().split('.').pop();\n      const allowedExtensions = ['dwg', 'dxf', 'step', 'stp', 'iges', 'igs', 'obj', 'stl'];\n    \n      if (!allowedExtensions.includes(fileExtension || '')) {\n        return ApiResponseWrapper.error('不支持的文件类型', 400);\n      }\n    \n        // 模拟CAD分析过程\n        const analysisResult: CADAnalysisResult = {\n          summary: {\n            totalComponents: Math.floor(Math.random() * 50) + 10,\n            totalLayers: Math.floor(Math.random() * 10) + 1,\n            dimensions: {\n              width: Math.random() * 1000 + 100,\n              height: Math.random() * 1000 + 100,\n              depth: Math.random() * 1000 + 100\n            },\n            complexity: ['low', 'medium', 'high'][Math.floor(Math.random() * 3)] as 'low' | 'medium' | 'high'\n          },\n          components: [\n            {\n              id: 'comp-001',\n              name: '主体结构',\n              type: '结构件',\n              material: '铝合金',\n              quantity: 1,\n              dimensions: {\n                length: Math.random() * 500 + 50,\n                width: Math.random() * 300 + 30,\n                height: Math.random() * 200 + 20\n              },\n              riskLevel: 'low',\n              issues: []\n            },\n            {\n              id: 'comp-002',\n              name: '连接件',\n              type: '紧固件',\n              material: '不锈钢',\n              quantity: 4,\n              dimensions: {\n                length: Math.random() * 50 + 5,\n                width: Math.random() * 20 + 2,\n                height: Math.random() * 10 + 1\n              },\n              riskLevel: 'medium',\n              issues: ['尺寸可能过小']\n            }\n          ],\n          recommendations: [\n            '建议优化零件厚度以减少材料使用',\n            '考虑使用更轻量的材料',\n            '检查装配间隙是否合理',\n            '建议增加倒角以提高安全性'\n          ],\n          riskAssessment: {\n            overallRisk: 'low',\n            criticalIssues: [],\n            warnings: [\n              '部分零件尺寸可能过小',\n              '建议检查材料强度'\n            ]\n          }\n        }\n    \n        // 模拟处理延迟\n        await new Promise(resolve => setTimeout(resolve, 1000))\n    \n      return ApiResponseWrapper.success({\n        success: true,\n        data: {\n          threadId,\n          runId,\n          fileName: file.name,\n          fileSize: file.size,\n          fileType: file.type,\n          analysis: analysisResult,\n          processedAt: new Date().toISOString()\n        }\n      });\n    } catch (error) {\n      return ApiResponseWrapper.error('CAD分析失败', 500);\n    }\n  }\n);\n\n"],"mappings":"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","ignoreList":[]}