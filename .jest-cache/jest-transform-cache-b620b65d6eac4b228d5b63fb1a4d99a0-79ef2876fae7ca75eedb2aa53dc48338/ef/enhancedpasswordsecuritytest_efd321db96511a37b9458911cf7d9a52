ddfd615ef57c9212f3507e00a52bbad2
"use strict";
// @ts-nocheck
/**
 * @file __tests__/lib/auth/enhanced-password-security.test.ts
 * @description 增强密码安全模块测试套件
 * @author B团队测试工程师
 * @lastUpdate 2024-12-19
 * @coverage 100%测试覆盖率目标
 */
Object.defineProperty(exports, "__esModule", { value: true });
const enhanced_password_security_1 = require("@/lib/auth/enhanced-password-security");
describe('EnhancedPasswordSecurity', () => {
    let passwordSecurity;
    beforeEach(() => {
        passwordSecurity = enhanced_password_security_1.EnhancedPasswordSecurity.getInstance();
    });
    describe('密码验证', () => {
        it('应该验证强密码', () => {
            const result = (0, enhanced_password_security_1.validatePassword)('StrongP@ssw0rd123');
            expect(result.isValid).toBe(true);
            expect(result.strength).toBeGreaterThanOrEqual(enhanced_password_security_1.PasswordStrength.GOOD);
            expect(result.errors).toHaveLength(0);
        });
        it('应该拒绝弱密码', () => {
            const weakPasswords = [
                'short',
                'nouppercase123',
                'NOLOWERCASE123',
                'NoNumbers',
                'NoSpecial123',
            ];
            weakPasswords.forEach(password => {
                const result = (0, enhanced_password_security_1.validatePassword)(password);
                expect(result.isValid).toBe(false);
                expect(result.errors.length).toBeGreaterThan(0);
            });
        });
        it('应该检测常见密码', () => {
            const commonPasswords = ['password', '123456', 'admin', 'qwerty'];
            commonPasswords.forEach(password => {
                const result = (0, enhanced_password_security_1.validatePassword)(password);
                expect(result.isValid).toBe(false);
                expect(result.errors).toContain('不能使用常见密码');
            });
        });
        it('应该检测个人信息', () => {
            const userInfo = {
                email: 'john.doe@example.com',
                name: 'John Doe',
                username: 'johndoe',
            };
            const result = (0, enhanced_password_security_1.validatePassword)('JohnDoe123!', userInfo);
            expect(result.warnings).toContain('密码不应包含个人信息');
        });
    });
    describe('密码哈希和验证', () => {
        it('应该成功哈希密码', async () => {
            const password = 'TestPassword123!';
            const hash = await (0, enhanced_password_security_1.hashPassword)(password);
            expect(hash).toBeDefined();
            expect(hash).not.toBe(password);
            expect(hash.length).toBeGreaterThan(10);
        });
        it('应该验证正确的密码', async () => {
            const password = 'correct-password';
            const hash = await (0, enhanced_password_security_1.hashPassword)(password);
            const isValid = await (0, enhanced_password_security_1.verifyPassword)(password, hash);
            expect(isValid).toBe(true);
        });
        it('应该拒绝错误的密码', async () => {
            const password = 'TestPassword123!';
            const wrongPassword = 'WrongPassword123!';
            const hash = await (0, enhanced_password_security_1.hashPassword)(password);
            const isValid = await (0, enhanced_password_security_1.verifyPassword)(wrongPassword, hash);
            expect(isValid).toBe(false);
        });
    });
    describe('登录尝试跟踪', () => {
        const userId = 'test-user-123';
        const ip = '192.168.1.100';
        beforeEach(() => {
            // 清理之前的测试数据
            passwordSecurity.unlockAccount(userId, ip);
        });
        it('应该记录成功的登录尝试', () => {
            expect(() => {
                (0, enhanced_password_security_1.recordLoginAttempt)(userId, ip, true, 'test-user-agent');
            }).not.toThrow();
        });
        it('应该记录失败的登录尝试', () => {
            expect(() => {
                (0, enhanced_password_security_1.recordLoginAttempt)(userId, ip, false, 'test-user-agent');
            }).not.toThrow();
        });
        it('应该在多次失败后锁定账户', () => {
            // 记录5次失败尝试
            for (let i = 0; i < 5; i++) {
                (0, enhanced_password_security_1.recordLoginAttempt)(userId, ip, false);
            }
            expect((0, enhanced_password_security_1.isAccountLocked)(userId, ip)).toBe(true);
        });
    });
    describe('安全密码生成', () => {
        it('应该生成指定长度的密码', () => {
            const lengths = [8, 12, 16, 20];
            lengths.forEach(length => {
                const password = (0, enhanced_password_security_1.generateSecurePassword)(length);
                expect(password.length).toBe(length);
            });
        });
        it('应该生成包含所有字符类型的密码', () => {
            const password = (0, enhanced_password_security_1.generateSecurePassword)(16);
            expect(/[a-z]/.test(password)).toBe(true); // 小写字母
            expect(/[A-Z]/.test(password)).toBe(true); // 大写字母
            expect(/\d/.test(password)).toBe(true); // 数字
            expect(/[!@#$%^&*()_+\-=\[\]{}|;:,.<>?]/.test(password)).toBe(true); // 特殊字符
        });
        it('应该生成不同的密码', () => {
            const passwords = new Set();
            for (let i = 0; i < 100; i++) {
                passwords.add((0, enhanced_password_security_1.generateSecurePassword)(12));
            }
            // 应该生成至少95%不同的密码
            expect(passwords.size).toBeGreaterThanOrEqual(95);
        });
    });
    describe('安全统计', () => {
        it('应该返回安全统计信息', () => {
            const stats = passwordSecurity.getSecurityStats();
            expect(stats).toHaveProperty('totalAttempts');
            expect(stats).toHaveProperty('lockedAccounts');
            expect(stats).toHaveProperty('config');
            expect(typeof stats.totalAttempts).toBe('number');
            expect(typeof stats.lockedAccounts).toBe('number');
            expect(typeof stats.config).toBe('object');
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRTpcXHprLWFnZW50XFxfX3Rlc3RzX19cXGxpYlxcYXV0aFxcZW5oYW5jZWQtcGFzc3dvcmQtc2VjdXJpdHkudGVzdC50cyIsIm1hcHBpbmdzIjoiO0FBQUEsY0FBYztBQUNkOzs7Ozs7R0FNRzs7QUFFSCxzRkFTK0M7QUFFL0MsUUFBUSxDQUFDLDBCQUEwQixFQUFFLEdBQUcsRUFBRTtJQUN4QyxJQUFJLGdCQUEwQyxDQUFDO0lBRS9DLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDZCxnQkFBZ0IsR0FBRyxxREFBd0IsQ0FBQyxXQUFXLEVBQUUsQ0FBQztJQUM1RCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxNQUFNLEVBQUUsR0FBRyxFQUFFO1FBQ3BCLEVBQUUsQ0FBQyxTQUFTLEVBQUUsR0FBRyxFQUFFO1lBQ2pCLE1BQU0sTUFBTSxHQUFHLElBQUEsNkNBQWdCLEVBQUMsbUJBQW1CLENBQUMsQ0FBQztZQUVyRCxNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNsQyxNQUFNLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLHNCQUFzQixDQUFDLDZDQUFnQixDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ3RFLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3hDLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLFNBQVMsRUFBRSxHQUFHLEVBQUU7WUFDakIsTUFBTSxhQUFhLEdBQUc7Z0JBQ3BCLE9BQU87Z0JBQ1AsZ0JBQWdCO2dCQUNoQixnQkFBZ0I7Z0JBQ2hCLFdBQVc7Z0JBQ1gsY0FBYzthQUNmLENBQUM7WUFFRixhQUFhLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxFQUFFO2dCQUMvQixNQUFNLE1BQU0sR0FBRyxJQUFBLDZDQUFnQixFQUFDLFFBQVEsQ0FBQyxDQUFDO2dCQUMxQyxNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FB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aWJcXGF1dGhcXGVuaGFuY2VkLXBhc3N3b3JkLXNlY3VyaXR5LnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQHRzLW5vY2hlY2tcbi8qKlxyXG4gKiBAZmlsZSBfX3Rlc3RzX18vbGliL2F1dGgvZW5oYW5jZWQtcGFzc3dvcmQtc2VjdXJpdHkudGVzdC50c1xyXG4gKiBAZGVzY3JpcHRpb24g5aKe5by65a+G56CB5a6J5YWo5qih5Z2X5rWL6K+V5aWX5Lu2XHJcbiAqIEBhdXRob3IgQuWboumYn+a1i+ivleW3peeoi+W4iFxyXG4gKiBAbGFzdFVwZGF0ZSAyMDI0LTEyLTE5XHJcbiAqIEBjb3ZlcmFnZSAxMDAl5rWL6K+V6KaG55uW546H55uu5qCHXHJcbiAqL1xyXG5cclxuaW1wb3J0IHtcclxuICBFbmhhbmNlZFBhc3N3b3JkU2VjdXJpdHksXHJcbiAgUGFzc3dvcmRTdHJlbmd0aCxcclxuICB2YWxpZGF0ZVBhc3N3b3JkLFxyXG4gIGhhc2hQYXNzd29yZCxcclxuICB2ZXJpZnlQYXNzd29yZCxcclxuICBnZW5lcmF0ZVNlY3VyZVBhc3N3b3JkLFxyXG4gIHJlY29yZExvZ2luQXR0ZW1wdCxcclxuICBpc0FjY291bnRMb2NrZWQsXHJcbn0gZnJvbSAnQC9saWIvYXV0aC9lbmhhbmNlZC1wYXNzd29yZC1zZWN1cml0eSc7XHJcblxyXG5kZXNjcmliZSgnRW5oYW5jZWRQYXNzd29yZFNlY3VyaXR5JywgKCkgPT4ge1xyXG4gIGxldCBwYXNzd29yZFNlY3VyaXR5OiBFbmhhbmNlZFBhc3N3b3JkU2VjdXJpdHk7XHJcblxyXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgcGFzc3dvcmRTZWN1cml0eSA9IEVuaGFuY2VkUGFzc3dvcmRTZWN1cml0eS5nZXRJbnN0YW5jZSgpO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgn5a+G56CB6aqM6K+BJywgKCkgPT4ge1xyXG4gICAgaXQoJ+W6lOivpemqjOivgeW8uuWvhueggScsICgpID0+IHtcclxuICAgICAgY29uc3QgcmVzdWx0ID0gdmFsaWRhdGVQYXNzd29yZCgnU3Ryb25nUEBzc3cwcmQxMjMnKTtcclxuICAgICAgXHJcbiAgICAgIGV4cGVjdChyZXN1bHQuaXNWYWxpZCkudG9CZSh0cnVlKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5zdHJlbmd0aCkudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbChQYXNzd29yZFN0cmVuZ3RoLkdPT0QpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LmVycm9ycykudG9IYXZlTGVuZ3RoKDApO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ+W6lOivpeaLkue7neW8seWvhueggScsICgpID0+IHtcclxuICAgICAgY29uc3Qgd2Vha1Bhc3N3b3JkcyA9IFtcclxuICAgICAgICAnc2hvcnQnLFxyXG4gICAgICAgICdub3VwcGVyY2FzZTEyMycsXHJcbiAgICAgICAgJ05PTE9XRVJDQVNFMTIzJyxcclxuICAgICAgICAnTm9OdW1iZXJzJyxcclxuICAgICAgICAnTm9TcGVjaWFsMTIzJyxcclxuICAgICAgXTtcclxuXHJcbiAgICAgIHdlYWtQYXNzd29yZHMuZm9yRWFjaChwYXNzd29yZCA9PiB7XHJcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gdmFsaWRhdGVQYXNzd29yZChwYXNzd29yZCk7XHJcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5pc1ZhbGlkKS50b0JlKGZhbHNlKTtcclxuICAgICAgICBleHBlY3QocmVzdWx0LmVycm9ycy5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbigwKTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgn5bqU6K+l5qOA5rWL5bi46KeB5a+G56CBJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBjb21tb25QYXNzd29yZHMgPSBbJ3Bhc3N3b3JkJywgJzEyMzQ1NicsICdhZG1pbicsICdxd2VydHknXTtcclxuICAgICAgXHJcbiAgICAgIGNvbW1vblBhc3N3b3Jkcy5mb3JFYWNoKHBhc3N3b3JkID0+IHtcclxuICAgICAgICBjb25zdCByZXN1bHQgPSB2YWxpZGF0ZVBhc3N3b3JkKHBhc3N3b3JkKTtcclxuICAgICAgICBleHBlY3QocmVzdWx0LmlzVmFsaWQpLnRvQmUoZmFsc2UpO1xyXG4gICAgICAgIGV4cGVjdChyZXN1bHQuZXJyb3JzKS50b0NvbnRhaW4oJ+S4jeiDveS9v+eUqOW4uOingeWvhueggScpO1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCflupTor6Xmo4DmtYvkuKrkurrkv6Hmga8nLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHVzZXJJbmZvID0ge1xyXG4gICAgICAgIGVtYWlsOiAnam9obi5kb2VAZXhhbXBsZS5jb20nLFxyXG4gICAgICAgIG5hbWU6ICdKb2huIERvZScsXHJcbiAgICAgICAgdXNlcm5hbWU6ICdqb2huZG9lJyxcclxuICAgICAgfTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IHZhbGlkYXRlUGFzc3dvcmQoJ0pvaG5Eb2UxMjMhJywgdXNlckluZm8pO1xyXG4gICAgICBleHBlY3QocmVzdWx0Lndhcm5pbmdzKS50b0NvbnRhaW4oJ+WvhueggeS4jeW6lOWMheWQq+S4quS6uuS/oeaBrycpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCflr4bnoIHlk4jluIzlkozpqozor4EnLCAoKSA9PiB7XHJcbiAgICBpdCgn5bqU6K+l5oiQ5Yqf5ZOI5biM5a+G56CBJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBwYXNzd29yZCA9ICdUZXN0UGFzc3dvcmQxMjMhJztcclxuICAgICAgY29uc3QgaGFzaCA9IGF3YWl0IGhhc2hQYXNzd29yZChwYXNzd29yZCk7XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QoaGFzaCkudG9CZURlZmluZWQoKTtcclxuICAgICAgZXhwZWN0KGhhc2gpLm5vdC50b0JlKHBhc3N3b3JkKTtcclxuICAgICAgZXhwZWN0KGhhc2gubGVuZ3RoKS50b0JlR3JlYXRlclRoYW4oMTApO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ+W6lOivpemqjOivgeato+ehrueahOWvhueggScsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgcGFzc3dvcmQgPSAnY29ycmVjdC1wYXNzd29yZCc7XHJcbiAgICAgIGNvbnN0IGhhc2ggPSBhd2FpdCBoYXNoUGFzc3dvcmQocGFzc3dvcmQpO1xyXG4gICAgICBcclxuICAgICAgY29uc3QgaXNWYWxpZCA9IGF3YWl0IHZlcmlmeVBhc3N3b3JkKHBhc3N3b3JkLCBoYXNoKTtcclxuICAgICAgZXhwZWN0KGlzVmFsaWQpLnRvQmUodHJ1ZSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgn5bqU6K+l5ouS57ud6ZSZ6K+v55qE5a+G56CBJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBwYXNzd29yZCA9ICdUZXN0UGFzc3dvcmQxMjMhJztcclxuICAgICAgY29uc3Qgd3JvbmdQYXNzd29yZCA9ICdXcm9uZ1Bhc3N3b3JkMTIzISc7XHJcbiAgICAgIGNvbnN0IGhhc2ggPSBhd2FpdCBoYXNoUGFzc3dvcmQocGFzc3dvcmQpO1xyXG4gICAgICBcclxuICAgICAgY29uc3QgaXNWYWxpZCA9IGF3YWl0IHZlcmlmeVBhc3N3b3JkKHdyb25nUGFzc3dvcmQsIGhhc2gpO1xyXG4gICAgICBleHBlY3QoaXNWYWxpZCkudG9CZShmYWxzZSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ+eZu+W9leWwneivlei3n+i4qicsICgpID0+IHtcclxuICAgIGNvbnN0IHVzZXJJZCA9ICd0ZXN0LXVzZXItMTIzJztcclxuICAgIGNvbnN0IGlwID0gJzE5Mi4xNjguMS4xMDAnO1xyXG5cclxuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgICAvLyDmuIXnkIbkuYvliY3nmoTmtYvor5XmlbDmja5cclxuICAgICAgcGFzc3dvcmRTZWN1cml0eS51bmxvY2tBY2NvdW50KHVzZXJJZCwgaXApO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ+W6lOivpeiusOW9leaIkOWKn+eahOeZu+W9leWwneivlScsICgpID0+IHtcclxuICAgICAgZXhwZWN0KCgpID0+IHtcclxuICAgICAgICByZWNvcmRMb2dpbkF0dGVtcHQodXNlcklkLCBpcCwgdHJ1ZSwgJ3Rlc3QtdXNlci1hZ2VudCcpO1xyXG4gICAgICB9KS5ub3QudG9UaHJvdygpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ+W6lOivpeiusOW9leWksei0peeahOeZu+W9leWwneivlScsICgpID0+IHtcclxuICAgICAgZXhwZWN0KCgpID0+IHtcclxuICAgICAgICByZWNvcmRMb2dpbkF0dGVtcHQodXNlcklkLCBpcCwgZmFsc2UsICd0ZXN0LXVzZXItYWdlbnQnKTtcclxuICAgICAgfSkubm90LnRvVGhyb3coKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCflupTor6XlnKjlpJrmrKHlpLHotKXlkI7plIHlrprotKbmiLcnLCAoKSA9PiB7XHJcbiAgICAgIC8vIOiusOW9lTXmrKHlpLHotKXlsJ3or5VcclxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA1OyBpKyspIHtcclxuICAgICAgICByZWNvcmRMb2dpbkF0dGVtcHQodXNlcklkLCBpcCwgZmFsc2UpO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QoaXNBY2NvdW50TG9ja2VkKHVzZXJJZCwgaXApKS50b0JlKHRydWUpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCflronlhajlr4bnoIHnlJ/miJAnLCAoKSA9PiB7XHJcbiAgICBpdCgn5bqU6K+l55Sf5oiQ5oyH5a6a6ZW/5bqm55qE5a+G56CBJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBsZW5ndGhzID0gWzgsIDEyLCAxNiwgMjBdO1xyXG4gICAgICBcclxuICAgICAgbGVuZ3Rocy5mb3JFYWNoKGxlbmd0aCA9PiB7XHJcbiAgICAgICAgY29uc3QgcGFzc3dvcmQgPSBnZW5lcmF0ZVNlY3VyZVBhc3N3b3JkKGxlbmd0aCk7XHJcbiAgICAgICAgZXhwZWN0KHBhc3N3b3JkLmxlbmd0aCkudG9CZShsZW5ndGgpO1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCflupTor6XnlJ/miJDljIXlkKvmiYDmnInlrZfnrKbnsbvlnovnmoTlr4bnoIEnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHBhc3N3b3JkID0gZ2VuZXJhdGVTZWN1cmVQYXNzd29yZCgxNik7XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QoL1thLXpdLy50ZXN0KHBhc3N3b3JkKSkudG9CZSh0cnVlKTsgLy8g5bCP5YaZ5a2X5q+NXHJcbiAgICAgIGV4cGVjdCgvW0EtWl0vLnRlc3QocGFzc3dvcmQpKS50b0JlKHRydWUpOyAvLyDlpKflhpnlrZfmr41cclxuICAgICAgZXhwZWN0KC9cXGQvLnRlc3QocGFzc3dvcmQpKS50b0JlKHRydWUpOyAgICAvLyDmlbDlrZdcclxuICAgICAgZXhwZWN0KC9bIUAjJCVeJiooKV8rXFwtPVxcW1xcXXt9fDs6LC48Pj9dLy50ZXN0KHBhc3N3b3JkKSkudG9CZSh0cnVlKTsgLy8g54m55q6K5a2X56ymXHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgn5bqU6K+l55Sf5oiQ5LiN5ZCM55qE5a+G56CBJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBwYXNzd29yZHMgPSBuZXcgU2V0KCk7XHJcbiAgICAgIFxyXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwMDsgaSsrKSB7XHJcbiAgICAgICAgcGFzc3dvcmRzLmFkZChnZW5lcmF0ZVNlY3VyZVBhc3N3b3JkKDEyKSk7XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIC8vIOW6lOivpeeUn+aIkOiHs+WwkTk1JeS4jeWQjOeahOWvhueggVxyXG4gICAgICBleHBlY3QocGFzc3dvcmRzLnNpemUpLnRvQmVHcmVhdGVyVGhhbk9yRXF1YWwoOTUpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCflronlhajnu5/orqEnLCAoKSA9PiB7XHJcbiAgICBpdCgn5bqU6K+l6L+U5Zue5a6J5YWo57uf6K6h5L+h5oGvJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBzdGF0cyA9IHBhc3N3b3JkU2VjdXJpdHkuZ2V0U2VjdXJpdHlTdGF0cygpO1xyXG4gICAgICBcclxuICAgICAgZXhwZWN0KHN0YXRzKS50b0hhdmVQcm9wZXJ0eSgndG90YWxBdHRlbXB0cycpO1xyXG4gICAgICBleHBlY3Qoc3RhdHMpLnRvSGF2ZVByb3BlcnR5KCdsb2NrZWRBY2NvdW50cycpO1xyXG4gICAgICBleHBlY3Qoc3RhdHMpLnRvSGF2ZVByb3BlcnR5KCdjb25maWcnKTtcclxuICAgICAgZXhwZWN0KHR5cGVvZiBzdGF0cy50b3RhbEF0dGVtcHRzKS50b0JlKCdudW1iZXInKTtcclxuICAgICAgZXhwZWN0KHR5cGVvZiBzdGF0cy5sb2NrZWRBY2NvdW50cykudG9CZSgnbnVtYmVyJyk7XHJcbiAgICAgIGV4cGVjdCh0eXBlb2Ygc3RhdHMuY29uZmlnKS50b0JlKCdvYmplY3QnKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG59KTsgIl0sInZlcnNpb24iOjN9