28408a8eaf4f3fc3e54a63e69e2764c3
"use strict";
// @ts-nocheck
/**
 * 智能缓存管理器
 * 多层级、自适应的数据库缓存系统
 *
 * 功能:
 * - 多层级缓存架构(L1内存缓存、L2Redis缓存)
 * - 智能缓存策略和自动失效
 * - 缓存预热和预测性加载
 * - 缓存性能监控和优化
 * - 分布式缓存一致性保证
 *
 * @author ZK-Agent Team
 * @version 1.0.0
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.CacheStrategy = exports.CacheLevel = exports.intelligentCacheManager = exports.IntelligentCacheManager = void 0;
const events_1 = require("events");
const lru_cache_1 = require("lru-cache");
const monitoring_1 = require("./monitoring");
const query_performance_optimizer_1 = require("./query-performance-optimizer");
// 条件导入Redis，仅在服务器环境中使用
let Redis = null;
if (typeof window === 'undefined') {
    try {
        Redis = require('ioredis');
    }
    catch (error) {
        console.warn('Redis not available in this environment:', error);
    }
}
/**
 * 缓存层级枚举
 */
var CacheLevel;
(function (CacheLevel) {
    CacheLevel["L1"] = "L1";
    CacheLevel["L2"] = "L2";
    CacheLevel["L3"] = "L3"; // 数据库缓存
})(CacheLevel || (exports.CacheLevel = CacheLevel = {}));
/**
 * 缓存策略枚举
 */
var CacheStrategy;
(function (CacheStrategy) {
    CacheStrategy["LRU"] = "lru";
    CacheStrategy["LFU"] = "lfu";
    CacheStrategy["TTL"] = "ttl";
    CacheStrategy["ADAPTIVE"] = "adaptive"; // 自适应策略
})(CacheStrategy || (exports.CacheStrategy = CacheStrategy = {}));
/**
 * 智能缓存管理器类
 */
class IntelligentCacheManager extends events_1.EventEmitter {
    constructor(config = {}) {
        super();
        this.l2Cache = null;
        this.isActive = false;
        this.monitoringInterval = null;
        this.warmupInterval = null;
        this.accessPatterns = new Map();
        this.hotKeys = new Set();
        this.keyVersions = new Map();
        // 初始化配置
        this.config = this.mergeConfig(config);
        // 初始化L1缓存
        this.l1Cache = new lru_cache_1.LRUCache({
            max: this.config.l1.maxSize,
            ttl: this.config.l1.ttl,
            updateAgeOnGet: true,
            allowStale: false
        });
        // 初始化统计信息
        this.stats = this.initializeStats();
        // 初始化预测性加载配置
        this.predictiveConfig = {
            enabled: true,
            algorithm: 'hybrid',
            predictionWindow: 300000, // 5分钟
            confidenceThreshold: 0.7,
            maxPredictiveLoads: 50
        };
        this.setupEventListeners();
    }
    /**
     * 合并配置
     *
     * @param userConfig - 用户配置
     * @returns 合并后的配置
     */
    mergeConfig(userConfig) {
        const defaultConfig = {
            l1: {
                enabled: true,
                maxSize: 1000,
                ttl: 300000, // 5分钟
                strategy: CacheStrategy.LRU
            },
            l2: {
                enabled: true,
                redis: {
                    host: process.env.REDIS_HOST || 'localhost',
                    port: parseInt(process.env.REDIS_PORT || '6379'),
                    password: process.env.REDIS_PASSWORD,
                    db: parseInt(process.env.REDIS_DB || '0'),
                    keyPrefix: 'zk_cache:'
                },
                maxSize: 10000,
                ttl: 1800000, // 30分钟
                strategy: CacheStrategy.LRU
            },
            warmup: {
                enabled: true,
                queries: [],
                schedule: '0 */6 * * *' // 每6小时
            },
            monitoring: {
                enabled: true,
                metricsInterval: 60000, // 1分钟
                alertThresholds: {
                    hitRateMin: 0.8,
                    memoryUsageMax: 0.9,
                    latencyMax: 100
                }
            }
        };
        return this.deepMerge(defaultConfig, userConfig);
    }
    /**
     * 深度合并对象
     *
     * @param target - 目标对象
     * @param source - 源对象
     * @returns 合并后的对象
     */
    deepMerge(target, source) {
        const result = { ...target };
        for (const key in source) {
            if (source[key] && typeof source[key] === 'object' && !Array.isArray(source[key])) {
                result[key] = this.deepMerge(target[key] || {}, source[key]);
            }
            else {
                result[key] = source[key];
            }
        }
        return result;
    }
    /**
     * 初始化统计信息
     *
     * @returns 初始统计信息
     */
    initializeStats() {
        return {
            totalRequests: 0,
            hits: 0,
            misses: 0,
            hitRate: 0,
            levelStats: {
                [CacheLevel.L1]: {
                    requests: 0,
                    hits: 0,
                    misses: 0,
                    hitRate: 0,
                    size: 0,
                    memoryUsage: 0
                },
                [CacheLevel.L2]: {
                    requests: 0,
                    hits: 0,
                    misses: 0,
                    hitRate: 0,
                    size: 0,
                    memoryUsage: 0
                },
                [CacheLevel.L3]: {
                    requests: 0,
                    hits: 0,
                    misses: 0,
                    hitRate: 0,
                    size: 0,
                    memoryUsage: 0
                }
            },
            avgResponseTime: 0,
            errors: 0,
            evictions: 0
        };
    }
    /**
     * 设置事件监听器
     */
    setupEventListeners() {
        // 监听查询性能优化器事件
        query_performance_optimizer_1.queryPerformanceOptimizer.on('query-completed', (stats) => {
            this.handleQueryCompleted(stats);
        });
        // 监听数据库监控事件
        monitoring_1.databaseMonitor.on('metrics', (metrics) => {
            this.handleDatabaseMetrics(metrics);
        });
    }
    /**
     * 启动缓存管理器
     */
    async start() {
        if (this.isActive) {
            console.log('Intelligent cache manager is already active');
            return;
        }
        console.log('Starting intelligent cache manager');
        try {
            // 初始化L2缓存(Redis)
            if (this.config.l2.enabled) {
                await this.initializeL2Cache();
            }
            // 启动监控
            if (this.config.monitoring.enabled) {
                this.startMonitoring();
            }
            // 启动缓存预热
            if (this.config.warmup.enabled) {
                this.startWarmup();
            }
            this.isActive = true;
            this.emit('cache-manager-started');
            console.log('Intelligent cache manager started successfully');
        }
        catch (error) {
            console.error('Failed to start intelligent cache manager:', error);
            throw error;
        }
    }
    /**
     * 停止缓存管理器
     */
    async stop() {
        if (!this.isActive) {
            return;
        }
        console.log('Stopping intelligent cache manager');
        this.isActive = false;
        // 停止监控
        if (this.monitoringInterval) {
            clearInterval(this.monitoringInterval);
            this.monitoringInterval = null;
        }
        // 停止预热
        if (this.warmupInterval) {
            clearInterval(this.warmupInterval);
            this.warmupInterval = null;
        }
        // 关闭Redis连接
        if (this.l2Cache) {
            await this.l2Cache.quit();
            this.l2Cache = null;
        }
        // 清空L1缓存
        this.l1Cache.clear();
        this.emit('cache-manager-stopped');
    }
    /**
     * 初始化L2缓存
     */
    async initializeL2Cache() {
        // 检查Redis是否可用
        if (!Redis) {
            console.warn('Redis not available, L2 cache disabled');
            this.config.l2.enabled = false;
            return;
        }
        const redisConfig = this.config.l2.redis;
        try {
            this.l2Cache = new Redis({
                host: redisConfig.host,
                port: redisConfig.port,
                password: redisConfig.password,
                db: redisConfig.db,
                keyPrefix: redisConfig.keyPrefix,
                retryDelayOnFailover: 100,
                maxRetriesPerRequest: 3,
                lazyConnect: true
            });
            // 设置Redis事件监听
            this.l2Cache.on('connect', () => {
                console.log('Connected to Redis cache');
            });
            this.l2Cache.on('error', (error) => {
                console.error('Redis cache error:', error);
                this.stats.errors++;
            });
            // 测试连接
            await this.l2Cache.ping();
        }
        catch (error) {
            console.warn('Failed to initialize Redis cache, falling back to L1 only:', error);
            this.config.l2.enabled = false;
            this.l2Cache = null;
        }
    }
    /**
     * 启动监控
     */
    startMonitoring() {
        this.monitoringInterval = setInterval(() => {
            this.collectMetrics();
            this.checkAlerts();
            this.optimizeCache();
        }, this.config.monitoring.metricsInterval);
    }
    /**
     * 启动缓存预热
     */
    startWarmup() {
        // 立即执行一次预热
        this.performWarmup();
        // 定期预热(这里简化为每小时一次)
        this.warmupInterval = setInterval(() => {
            this.performWarmup();
        }, 3600000); // 1小时
    }
    /**
     * 获取缓存数据
     *
     * @param key - 缓存键
     * @param loader - 数据加载函数
     * @param options - 选项
     * @returns 缓存数据
     */
    async get(key, loader, options = {}) {
        const startTime = performance.now();
        try {
            this.stats.totalRequests++;
            this.recordAccess(key);
            // 尝试从L1缓存获取
            let result = await this.getFromL1(key);
            if (result !== null) {
                this.recordHit(CacheLevel.L1);
                this.emit('cache-event', {
                    type: 'hit',
                    key,
                    level: CacheLevel.L1,
                    timestamp: new Date()
                });
                return result.value;
            }
            // 尝试从L2缓存获取
            if (this.config.l2.enabled && this.l2Cache) {
                result = await this.getFromL2(key);
                if (result !== null) {
                    // 回写到L1缓存
                    await this.setToL1(key, result.value, options);
                    this.recordHit(CacheLevel.L2);
                    this.emit('cache-event', {
                        type: 'hit',
                        key,
                        level: CacheLevel.L2,
                        timestamp: new Date()
                    });
                    return result.value;
                }
            }
            // 缓存未命中，使用loader加载数据
            if (loader) {
                const data = await loader();
                if (data !== null && data !== undefined) {
                    await this.set(key, data, options);
                }
                this.recordMiss();
                return data;
            }
            this.recordMiss();
            return null;
        }
        catch (error) {
            console.error(`Cache get error for key ${key}:`, error);
            this.stats.errors++;
            // 如果有loader，尝试直接加载
            if (loader) {
                try {
                    return await loader();
                }
                catch (loaderError) {
                    console.error(`Loader error for key ${key}:`, loaderError);
                    return null;
                }
            }
            return null;
        }
        finally {
            const endTime = performance.now();
            this.updateResponseTime(endTime - startTime);
        }
    }
    /**
     * 设置缓存数据
     *
     * @param key - 缓存键
     * @param value - 缓存值
     * @param options - 选项
     */
    async set(key, value, options = {}) {
        try {
            const ttl = options.ttl || this.config.l1.ttl;
            const tags = options.tags || [];
            const priority = options.priority || 1;
            const targetLevel = options.level;
            // 更新版本号
            const version = this.incrementVersion(key);
            const cacheItem = {
                key,
                value,
                createdAt: new Date(),
                expiresAt: new Date(Date.now() + ttl),
                accessCount: 0,
                lastAccessedAt: new Date(),
                size: this.calculateSize(value),
                level: CacheLevel.L1,
                version,
                tags,
                priority,
                isHot: this.hotKeys.has(key)
            };
            // 设置到L1缓存
            if (!targetLevel || targetLevel === CacheLevel.L1) {
                await this.setToL1(key, value, options);
            }
            // 设置到L2缓存
            if (this.config.l2.enabled && this.l2Cache && (!targetLevel || targetLevel === CacheLevel.L2)) {
                await this.setToL2(key, cacheItem);
            }
            this.emit('cache-event', {
                type: 'set',
                key,
                level: targetLevel || CacheLevel.L1,
                timestamp: new Date(),
                metadata: { size: cacheItem.size, ttl }
            });
        }
        catch (error) {
            console.error(`Cache set error for key ${key}:`, error);
            this.stats.errors++;
        }
    }
    /**
     * 删除缓存数据
     *
     * @param key - 缓存键
     */
    async delete(key) {
        try {
            // 从L1缓存删除
            this.l1Cache.delete(key);
            // 从L2缓存删除
            if (this.config.l2.enabled && this.l2Cache) {
                await this.l2Cache.del(key);
            }
            // 清理相关数据
            this.accessPatterns.delete(key);
            this.hotKeys.delete(key);
            this.keyVersions.delete(key);
            this.emit('cache-event', {
                type: 'delete',
                key,
                level: CacheLevel.L1,
                timestamp: new Date()
            });
        }
        catch (error) {
            console.error(`Cache delete error for key ${key}:`, error);
            this.stats.errors++;
        }
    }
    /**
     * 批量删除缓存(按标签)
     *
     * @param tags - 标签数组
     */
    async deleteByTags(tags) {
        try {
            const keysToDelete = [];
            // 从L1缓存中查找匹配的键
            for (const [key, item] of this.l1Cache.entries()) {
                if (item && item.tags && item.tags.some((tag) => tags.includes(tag))) {
                    keysToDelete.push(key);
                }
            }
            // 从L2缓存中查找匹配的键(如果启用)
            if (this.config.l2.enabled && this.l2Cache) {
                // 这里需要实现Redis中按标签查找的逻辑
                // 可以使用Redis的SET数据结构来维护标签到键的映射
            }
            // 批量删除
            for (const key of keysToDelete) {
                await this.delete(key);
            }
            console.log(`Deleted ${keysToDelete.length} cache items by tags:`, tags);
        }
        catch (error) {
            console.error('Cache delete by tags error:', error);
            this.stats.errors++;
        }
    }
    /**
     * 从L1缓存获取数据
     *
     * @param key - 缓存键
     * @returns 缓存项
     */
    async getFromL1(key) {
        this.stats.levelStats[CacheLevel.L1].requests++;
        const item = this.l1Cache.get(key);
        if (item) {
            item.accessCount++;
            item.lastAccessedAt = new Date();
            return item;
        }
        return null;
    }
    /**
     * 从L2缓存获取数据
     *
     * @param key - 缓存键
     * @returns 缓存项
     */
    async getFromL2(key) {
        if (!this.l2Cache) {
            return null;
        }
        this.stats.levelStats[CacheLevel.L2].requests++;
        try {
            const data = await this.l2Cache.get(key);
            if (data) {
                const item = JSON.parse(data);
                // 检查是否过期
                if (new Date(item.expiresAt) > new Date()) {
                    item.accessCount++;
                    item.lastAccessedAt = new Date();
                    // 更新L2缓存中的访问信息
                    await this.l2Cache.set(key, JSON.stringify(item), 'PX', this.config.l2.ttl);
                    return item;
                }
                else {
                    // 过期数据，删除
                    await this.l2Cache.del(key);
                }
            }
        }
        catch (error) {
            console.error(`L2 cache get error for key ${key}:`, error);
        }
        return null;
    }
    /**
     * 设置数据到L1缓存
     *
     * @param key - 缓存键
     * @param value - 缓存值
     * @param options - 选项
     */
    async setToL1(key, value, options = {}) {
        const ttl = options.ttl || this.config.l1.ttl;
        const tags = options.tags || [];
        const priority = options.priority || 1;
        const version = this.getVersion(key);
        const cacheItem = {
            key,
            value,
            createdAt: new Date(),
            expiresAt: new Date(Date.now() + ttl),
            accessCount: 0,
            lastAccessedAt: new Date(),
            size: this.calculateSize(value),
            level: CacheLevel.L1,
            version,
            tags,
            priority,
            isHot: this.hotKeys.has(key)
        };
        this.l1Cache.set(key, cacheItem, { ttl });
    }
    /**
     * 设置数据到L2缓存
     *
     * @param key - 缓存键
     * @param item - 缓存项
     */
    async setToL2(key, item) {
        if (!this.l2Cache) {
            return;
        }
        try {
            const serializedItem = JSON.stringify(item);
            await this.l2Cache.set(key, serializedItem, 'PX', this.config.l2.ttl);
            // 维护标签索引
            if (item.tags && item.tags.length > 0) {
                for (const tag of item.tags) {
                    await this.l2Cache.sadd(`tag:${tag}`, key);
                    await this.l2Cache.expire(`tag:${tag}`, Math.ceil(this.config.l2.ttl / 1000));
                }
            }
        }
        catch (error) {
            console.error(`L2 cache set error for key ${key}:`, error);
        }
    }
    /**
     * 记录访问模式
     *
     * @param key - 缓存键
     */
    recordAccess(key) {
        const now = Date.now();
        const pattern = this.accessPatterns.get(key) || [];
        pattern.push(now);
        // 只保留最近的访问记录
        const cutoff = now - this.predictiveConfig.predictionWindow;
        const recentAccesses = pattern.filter(time => time > cutoff);
        this.accessPatterns.set(key, recentAccesses);
        // 判断是否为热点数据
        if (recentAccesses.length > 10) {
            this.hotKeys.add(key);
        }
        else if (recentAccesses.length < 3) {
            this.hotKeys.delete(key);
        }
    }
    /**
     * 记录命中
     *
     * @param level - 缓存层级
     */
    recordHit(level) {
        this.stats.hits++;
        this.stats.levelStats[level].hits++;
        this.updateHitRate();
    }
    /**
     * 记录未命中
     */
    recordMiss() {
        this.stats.misses++;
        this.updateHitRate();
    }
    /**
     * 更新命中率
     */
    updateHitRate() {
        this.stats.hitRate = this.stats.hits / Math.max(1, this.stats.totalRequests);
        for (const level of Object.values(CacheLevel)) {
            const levelStats = this.stats.levelStats[level];
            levelStats.hitRate = levelStats.hits / Math.max(1, levelStats.requests);
        }
    }
    /**
     * 更新响应时间
     *
     * @param responseTime - 响应时间
     */
    updateResponseTime(responseTime) {
        const totalTime = this.stats.avgResponseTime * (this.stats.totalRequests - 1) + responseTime;
        this.stats.avgResponseTime = totalTime / this.stats.totalRequests;
    }
    /**
     * 计算数据大小
     *
     * @param value - 数据值
     * @returns 数据大小(bytes)
     */
    calculateSize(value) {
        try {
            return JSON.stringify(value).length * 2; // 粗略估算(UTF-16)
        }
        catch {
            return 0;
        }
    }
    /**
     * 获取版本号
     *
     * @param key - 缓存键
     * @returns 版本号
     */
    getVersion(key) {
        return this.keyVersions.get(key) || 1;
    }
    /**
     * 递增版本号
     *
     * @param key - 缓存键
     * @returns 新版本号
     */
    incrementVersion(key) {
        const currentVersion = this.getVersion(key);
        const newVersion = currentVersion + 1;
        this.keyVersions.set(key, newVersion);
        return newVersion;
    }
    /**
     * 处理查询完成事件
     *
     * @param stats - 查询统计
     */
    handleQueryCompleted(stats) {
        // 基于查询统计进行预测性加载
        if (this.predictiveConfig.enabled && stats.success) {
            this.performPredictiveLoading(stats);
        }
    }
    /**
     * 处理数据库指标
     *
     * @param metrics - 数据库指标
     */
    handleDatabaseMetrics(metrics) {
        // 根据数据库负载调整缓存策略
        if (metrics.cpuUsage > 80) {
            // 高CPU使用率时，增加缓存TTL
            this.adjustCacheTTL(1.5);
        }
        else if (metrics.cpuUsage < 30) {
            // 低CPU使用率时，减少缓存TTL
            this.adjustCacheTTL(0.8);
        }
    }
    /**
     * 执行预测性加载
     *
     * @param stats - 查询统计
     */
    performPredictiveLoading(stats) {
        // 这里实现预测性加载逻辑
        // 基于访问模式预测可能需要的数据
        const relatedKeys = this.predictRelatedKeys(stats);
        relatedKeys.forEach(async (key) => {
            if (!this.l1Cache.has(key) && !await this.hasInL2(key)) {
                // 预加载数据
                this.emit('predictive-load-needed', { key, stats });
            }
        });
    }
    /**
     * 预测相关键
     *
     * @param stats - 查询统计
     * @returns 相关键数组
     */
    predictRelatedKeys(stats) {
        // 简单的预测逻辑，实际应用中可以使用更复杂的算法
        const relatedKeys = [];
        if (stats.tables) {
            stats.tables.forEach((table) => {
                // 预测同表的其他常用查询
                relatedKeys.push(`${table}:popular_queries`);
                relatedKeys.push(`${table}:recent_data`);
            });
        }
        return relatedKeys;
    }
    /**
     * 检查L2缓存中是否存在
     *
     * @param key - 缓存键
     * @returns 是否存在
     */
    async hasInL2(key) {
        if (!this.l2Cache) {
            return false;
        }
        try {
            const exists = await this.l2Cache.exists(key);
            return exists === 1;
        }
        catch (error) {
            return false;
        }
    }
    /**
     * 调整缓存TTL
     *
     * @param factor - 调整因子
     */
    adjustCacheTTL(factor) {
        // 动态调整缓存TTL
        const newL1TTL = Math.max(60000, this.config.l1.ttl * factor); // 最少1分钟
        const newL2TTL = Math.max(300000, this.config.l2.ttl * factor); // 最少5分钟
        this.config.l1.ttl = newL1TTL;
        this.config.l2.ttl = newL2TTL;
        console.log(`Adjusted cache TTL: L1=${newL1TTL}ms, L2=${newL2TTL}ms`);
    }
    /**
     * 收集指标
     */
    collectMetrics() {
        // 更新L1缓存统计
        this.stats.levelStats[CacheLevel.L1].size = this.l1Cache.size;
        this.stats.levelStats[CacheLevel.L1].memoryUsage = this.calculateL1MemoryUsage();
        // 发送指标事件
        this.emit('metrics-collected', this.stats);
    }
    /**
     * 计算L1缓存内存使用
     *
     * @returns 内存使用量(bytes)
     */
    calculateL1MemoryUsage() {
        let totalSize = 0;
        for (const item of this.l1Cache.values()) {
            if (item) {
                totalSize += item.size;
            }
        }
        return totalSize;
    }
    /**
     * 检查告警
     */
    checkAlerts() {
        const thresholds = this.config.monitoring.alertThresholds;
        // 检查命中率
        if (this.stats.hitRate < thresholds.hitRateMin) {
            this.emit('alert', {
                type: 'low-hit-rate',
                message: `Cache hit rate is below threshold: ${this.stats.hitRate.toFixed(2)} < ${thresholds.hitRateMin}`,
                severity: 'warning'
            });
        }
        // 检查内存使用
        const memoryUsage = this.calculateL1MemoryUsage();
        const maxMemory = this.config.l1.maxSize * 1024; // 假设每项平均1KB
        if (memoryUsage / maxMemory > thresholds.memoryUsageMax) {
            this.emit('alert', {
                type: 'high-memory-usage',
                message: `Cache memory usage is above threshold: ${(memoryUsage / maxMemory * 100).toFixed(2)}% > ${thresholds.memoryUsageMax * 100}%`,
                severity: 'warning'
            });
        }
        // 检查响应时间
        if (this.stats.avgResponseTime > thresholds.latencyMax) {
            this.emit('alert', {
                type: 'high-latency',
                message: `Cache average response time is above threshold: ${this.stats.avgResponseTime.toFixed(2)}ms > ${thresholds.latencyMax}ms`,
                severity: 'warning'
            });
        }
    }
    /**
     * 优化缓存
     */
    optimizeCache() {
        // 清理过期数据
        this.cleanupExpiredItems();
        // 优化热点数据
        this.optimizeHotData();
        // 调整缓存策略
        this.adjustCacheStrategy();
    }
    /**
     * 清理过期项
     */
    cleanupExpiredItems() {
        const now = new Date();
        const expiredKeys = [];
        for (const [key, item] of this.l1Cache.entries()) {
            if (item && new Date(item.expiresAt) < now) {
                expiredKeys.push(key);
            }
        }
        expiredKeys.forEach(key => {
            this.l1Cache.delete(key);
            this.stats.evictions++;
        });
    }
    /**
     * 优化热点数据
     */
    optimizeHotData() {
        // 将热点数据的TTL延长
        for (const hotKey of this.hotKeys) {
            const item = this.l1Cache.get(hotKey);
            if (item) {
                const extendedTTL = this.config.l1.ttl * 2;
                item.expiresAt = new Date(Date.now() + extendedTTL);
                this.l1Cache.set(hotKey, item, { ttl: extendedTTL });
            }
        }
    }
    /**
     * 调整缓存策略
     */
    adjustCacheStrategy() {
        // 根据命中率调整策略
        if (this.stats.hitRate < 0.5) {
            // 命中率低，增加缓存大小
            if (this.l1Cache.max < 2000) {
                this.l1Cache.resize(this.l1Cache.max * 1.2);
                console.log(`Increased L1 cache size to ${this.l1Cache.max}`);
            }
        }
        else if (this.stats.hitRate > 0.9) {
            // 命中率高，可以适当减少缓存大小
            if (this.l1Cache.max > 500) {
                this.l1Cache.resize(this.l1Cache.max * 0.9);
                console.log(`Decreased L1 cache size to ${this.l1Cache.max}`);
            }
        }
    }
    /**
     * 执行缓存预热
     */
    async performWarmup() {
        console.log('Performing cache warmup...');
        const warmupQueries = this.config.warmup.queries;
        for (const query of warmupQueries) {
            try {
                // 这里需要实际执行查询并缓存结果
                // await this.executeAndCache(query)
                console.log(`Warmed up query: ${query}`);
            }
            catch (error) {
                console.error(`Warmup failed for query ${query}:`, error);
            }
        }
        this.emit('warmup-completed', { queries: warmupQueries.length });
    }
    /**
     * 获取缓存统计
     *
     * @returns 缓存统计
     */
    getStats() {
        return { ...this.stats };
    }
    /**
     * 获取热点键
     *
     * @returns 热点键数组
     */
    getHotKeys() {
        return Array.from(this.hotKeys);
    }
    /**
     * 获取缓存配置
     *
     * @returns 缓存配置
     */
    getConfig() {
        return { ...this.config };
    }
    /**
     * 更新缓存配置
     *
     * @param newConfig - 新配置
     */
    updateConfig(newConfig) {
        this.config = this.mergeConfig(newConfig);
        console.log('Cache configuration updated');
        this.emit('config-updated', this.config);
    }
    /**
     * 清空所有缓存
     */
    async clearAll() {
        // 清空L1缓存
        this.l1Cache.clear();
        // 清空L2缓存
        if (this.config.l2.enabled && this.l2Cache) {
            await this.l2Cache.flushdb();
        }
        // 重置统计
        this.stats = this.initializeStats();
        // 清空辅助数据
        this.accessPatterns.clear();
        this.hotKeys.clear();
        this.keyVersions.clear();
        console.log('All caches cleared');
        this.emit('cache-cleared');
    }
    /**
     * 生成缓存报告
     *
     * @returns 缓存报告
     */
    generateReport() {
        const recommendations = [];
        if (this.stats.hitRate < 0.7) {
            recommendations.push('缓存命中率较低，建议检查缓存策略和TTL设置');
        }
        if (this.stats.avgResponseTime > 50) {
            recommendations.push('缓存响应时间较高，建议优化缓存层级或增加内存');
        }
        if (this.hotKeys.size > 100) {
            recommendations.push('热点数据较多，建议考虑分片或专用缓存');
        }
        return {
            summary: `
智能缓存管理报告
================
生成时间: ${new Date().toISOString()}
总请求数: ${this.stats.totalRequests}
命中率: ${(this.stats.hitRate * 100).toFixed(2)}%
平均响应时间: ${this.stats.avgResponseTime.toFixed(2)}ms
L1缓存大小: ${this.stats.levelStats[CacheLevel.L1].size}
L2缓存启用: ${this.config.l2.enabled ? '是' : '否'}
热点数据: ${this.hotKeys.size} 个
错误次数: ${this.stats.errors}
      `.trim(),
            performance: {
                hitRate: this.stats.hitRate,
                avgResponseTime: this.stats.avgResponseTime,
                levelStats: this.stats.levelStats,
                hotKeysCount: this.hotKeys.size,
                errorRate: this.stats.errors / Math.max(1, this.stats.totalRequests)
            },
            recommendations
        };
    }
}
exports.IntelligentCacheManager = IntelligentCacheManager;
// 创建全局实例
exports.intelligentCacheManager = new IntelligentCacheManager();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRTpcXHprLWFnZW50XFxsaWJcXGRhdGFiYXNlXFxpbnRlbGxpZ2VudC1jYWNoZS1tYW5hZ2VyLnRzIiwibWFwcGluZ3MiOiI7QUFBQSxjQUFjO0FBQ2Q7Ozs7Ozs7Ozs7Ozs7R0FhRzs7O0FBRUgsbUNBQXFDO0FBQ3JDLHlDQUFvQztBQUNwQyw2Q0FBOEM7QUFDOUMsK0VBQXlFO0FBRXpFLHVCQUF1QjtBQUN2QixJQUFJLEtBQUssR0FBUSxJQUFJLENBQUE7QUFDckIsSUFBSSxPQUFPLE1BQU0sS0FBSyxXQUFXLEVBQUUsQ0FBQztJQUNsQyxJQUFJLENBQUM7UUFDSCxLQUFLLEdBQUcsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFBO0lBQzVCLENBQUM7SUFBQyxPQUFPLEtBQVUsRUFBRSxDQUFDO1FBQ3BCLE9BQU8sQ0FBQyxJQUFJLENBQUMsMENBQTBDLEVBQUUsS0FBSyxDQUFDLENBQUE7SUFDakUsQ0FBQztBQUNILENBQUM7QUFFRDs7R0FFRztBQUNILElBQUssVUFJSjtBQUpELFdBQUssVUFBVTtJQUNiLHVCQUFTLENBQUE7SUFDVCx1QkFBUyxDQUFBO0lBQ1QsdUJBQVMsQ0FBQSxDQUFFLFFBQVE7QUFDckIsQ0FBQyxFQUpJLFVBQVUsMEJBQVYsVUFBVSxRQUlkO0FBRUQ7O0dBRUc7QUFDSCxJQUFLLGFBS0o7QUFMRCxXQUFLLGFBQWE7SUFDaEIsNEJBQVcsQ0FBQTtJQUNYLDRCQUFXLENBQUE7SUFDWCw0QkFBVyxDQUFBO0lBQ1gsc0NBQXFCLENBQUEsQ0FBRyxRQUFRO0FBQ2xDLENBQUMsRUFMSSxhQUFhLDZCQUFiLGFBQWEsUUFLakI7QUFxSUQ7O0dBRUc7QUFDSCxNQUFhLHVCQUF3QixTQUFRLHFCQUFZO0lBYXZELFlBQVksU0FBK0IsRUFBRTtRQUMzQyxLQUFLLEVBQUUsQ0FBQTtRQVhELFlBQU8sR0FBZSxJQUFJLENBQUE7UUFFMUIsYUFBUSxHQUFZLEtBQUssQ0FBQTtRQUN6Qix1QkFBa0IsR0FBMEIsSUFBSSxDQUFBO1FBQ2hELG1CQUFjLEdBQTBCLElBQUksQ0FBQTtR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QUFhO09BQ3pCLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLEdBQUcsR0FBRyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztVQUNsQyxJQUFJLENBQUMsS0FBSyxDQUFDLGVBQWUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1VBQ3JDLElBQUksQ0FBQyxLQUFLLENBQUMsVUFBVSxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxJQUFJO1VBQ3pDLElBQUksQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHO1FBQ3BDLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSTtRQUNqQixJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU07T0FDbEIsQ0FBQyxJQUFJLEVBQUU7WUFDUixXQUFXLEVBQUU7Z0JBQ1gsT0FBTyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTztnQkFDM0IsZUFBZSxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsZUFBZTtnQkFDM0MsVUFBVSxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsVUFBVTtnQkFDakMsWUFBWSxFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSTtnQkFDL0IsU0FBUyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsYUFBYSxDQUFDO2FBQ3JFO1lBQ0QsZUFBZTtTQUNoQixDQUFBO0lBQ0gsQ0FBQztDQUNGO0FBMWxDRCwwREEwbENDO0FBRUQsU0FBUztBQUNJLFFBQUEsdUJBQXVCLEdBQUcsSUFBSSx1QkFBdUIsRUFBRSxDQUFBIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkU6XFx6ay1hZ2VudFxcbGliXFxkYXRhYmFzZVxcaW50ZWxsaWdlbnQtY2FjaGUtbWFuYWdlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBAdHMtbm9jaGVja1xuLyoqXG4gKiDmmbrog73nvJPlrZjnrqHnkIblmahcbiAqIOWkmuWxgue6p+OAgeiHqumAguW6lOeahOaVsOaNruW6k+e8k+WtmOezu+e7n1xuICogXG4gKiDlip/og706XG4gKiAtIOWkmuWxgue6p+e8k+WtmOaetuaehChMMeWGheWtmOe8k+WtmOOAgUwyUmVkaXPnvJPlrZgpXG4gKiAtIOaZuuiDvee8k+WtmOetlueVpeWSjOiHquWKqOWkseaViFxuICogLSDnvJPlrZjpooTng63lkozpooTmtYvmgKfliqDovb1cbiAqIC0g57yT5a2Y5oCn6IO955uR5o6n5ZKM5LyY5YyWXG4gKiAtIOWIhuW4g+W8j+e8k+WtmOS4gOiHtOaAp+S/neivgVxuICogXG4gKiBAYXV0aG9yIFpLLUFnZW50IFRlYW1cbiAqIEB2ZXJzaW9uIDEuMC4wXG4gKi9cblxuaW1wb3J0IHsgRXZlbnRFbWl0dGVyIH0gZnJvbSAnZXZlbnRzJ1xuaW1wb3J0IHsgTFJVQ2FjaGUgfSBmcm9tICdscnUtY2FjaGUnXG5pbXBvcnQgeyBkYXRhYmFzZU1vbml0b3IgfSBmcm9tICcuL21vbml0b3JpbmcnXG5pbXBvcnQgeyBxdWVyeVBlcmZvcm1hbmNlT3B0aW1pemVyIH0gZnJvbSAnLi9xdWVyeS1wZXJmb3JtYW5jZS1vcHRpbWl6ZXInXG5cbi8vIOadoeS7tuWvvOWFpVJlZGlz77yM5LuF5Zyo5pyN5Yqh5Zmo546v5aKD5Lit5L2/55SoXG5sZXQgUmVkaXM6IGFueSA9IG51bGxcbmlmICh0eXBlb2Ygd2luZG93ID09PSAndW5kZWZpbmVkJykge1xuICB0cnkge1xuICAgIFJlZGlzID0gcmVxdWlyZSgnaW9yZWRpcycpXG4gIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICBjb25zb2xlLndhcm4oJ1JlZGlzIG5vdCBhdmFpbGFibGUgaW4gdGhpcyBlbnZpcm9ubWVudDonLCBlcnJvcilcbiAgfVxufVxuXG4vKipcbiAqIOe8k+WtmOWxgue6p+aemuS4vlxuICovXG5lbnVtIENhY2hlTGV2ZWwge1xuICBMMSA9ICdMMScsIC8vIOWGheWtmOe8k+WtmFxuICBMMiA9ICdMMicsIC8vIFJlZGlz57yT5a2YXG4gIEwzID0gJ0wzJyAgLy8g5pWw5o2u5bqT57yT5a2YXG59XG5cbi8qKlxuICog57yT5a2Y562W55Wl5p6a5Li+XG4gKi9cbmVudW0gQ2FjaGVTdHJhdGVneSB7XG4gIExSVSA9ICdscnUnLCAgICAgICAgICAgLy8g5pyA6L+R5pyA5bCR5L2/55SoXG4gIExGVSA9ICdsZnUnLCAgICAgICAgICAgLy8g5pyA5bCR5L2/55So6aKR546HXG4gIFRUTCA9ICd0dGwnLCAgICAgICAgICAgLy8g5Z+65LqO5pe26Ze0XG4gIEFEQVBUSVZFID0gJ2FkYXB0aXZlJyAgIC8vIOiHqumAguW6lOetlueVpVxufVxuXG4vKipcbiAqIOe8k+WtmOmhueaOpeWPo1xuICovXG5pbnRlcmZhY2UgQ2FjaGVJdGVtPFQgPSBhbnk+IHtcbiAgLyoqIOe8k+WtmOmUriAqL1xuICBrZXk6IHN0cmluZ1xuICAvKiog57yT5a2Y5YC8ICovXG4gIHZhbHVlOiBUXG4gIC8qKiDliJvlu7rml7bpl7QgKi9cbiAgY3JlYXRlZEF0OiBEYXRlXG4gIC8qKiDov4fmnJ/ml7bpl7QgKi9cbiAgZXhwaXJlc0F0OiBEYXRlXG4gIC8qKiDorr/pl67mrKHmlbAgKi9cbiAgYWNjZXNzQ291bnQ6IG51bWJlclxuICAvKiog5pyA5ZCO6K6/6Zeu5pe26Ze0ICovXG4gIGxhc3RBY2Nlc3NlZEF0OiBEYXRlXG4gIC8qKiDmlbDmja7lpKflsI8oYnl0ZXMpICovXG4gIHNpemU6IG51bWJlclxuICAvKiog57yT5a2Y5bGC57qnICovXG4gIGxldmVsOiBDYWNoZUxldmVsXG4gIC8qKiDmlbDmja7niYjmnKwgKi9cbiAgdmVyc2lvbjogbnVtYmVyXG4gIC8qKiDmoIfnrb4o55So5LqO5om56YeP5aSx5pWIKSAqL1xuICB0YWdzOiBzdHJpbmdbXVxuICAvKiog5LyY5YWI57qnICovXG4gIHByaW9yaXR5OiBudW1iZXJcbiAgLyoqIOaYr+WQpuS4uueDreeCueaVsOaNriAqL1xuICBpc0hvdDogYm9vbGVhblxufVxuXG4vKipcbiAqIOe8k+WtmOmFjee9ruaOpeWPo1xuICovXG5pbnRlcmZhY2UgQ2FjaGVDb25maWcge1xuICAvKiogTDHnvJPlrZjphY3nva4gKi9cbiAgbDE6IHtcbiAgICBlbmFibGVkOiBib29sZWFuXG4gICAgbWF4U2l6ZTogbnVtYmVyXG4gICAgdHRsOiBudW1iZXJcbiAgICBzdHJhdGVneTogQ2FjaGVTdHJhdGVneVxuICB9XG4gIC8qKiBMMue8k+WtmOmFjee9riAqL1xuICBsMjoge1xuICAgIGVuYWJsZWQ6IGJvb2xlYW5cbiAgICByZWRpczoge1xuICAgICAgaG9zdDogc3RyaW5nXG4gICAgICBwb3J0OiBudW1iZXJcbiAgICAgIHBhc3N3b3JkPzogc3RyaW5nXG4gICAgICBkYjogbnVtYmVyXG4gICAgICBrZXlQcmVmaXg6IHN0cmluZ1xuICAgIH1cbiAgICBtYXhTaXplOiBudW1iZXJcbiAgICB0dGw6IG51bWJlclxuICAgIHN0cmF0ZWd5OiBDYWNoZVN0cmF0ZWd5XG4gIH1cbiAgLyoqIOmihOeDremFjee9riAqL1xuICB3YXJtdXA6IHtcbiAgICBlbmFibGVkOiBib29sZWFuXG4gICAgcXVlcmllczogc3RyaW5nW11cbiAgICBzY2hlZHVsZTogc3RyaW5nXG4gIH1cbiAgLyoqIOebkeaOp+mFjee9riAqL1xuICBtb25pdG9yaW5nOiB7XG4gICAgZW5hYmxlZDogYm9vbGVhblxuICAgIG1ldHJpY3NJbnRlcnZhbDogbnVtYmVyXG4gICAgYWxlcnRUaHJlc2hvbGRzOiB7XG4gICAgICBoaXRSYXRlTWluOiBudW1iZXJcbiAgICAgIG1lbW9yeVVzYWdlTWF4OiBudW1iZXJcbiAgICAgIGxhdGVuY3lNYXg6IG51bWJlclxuICAgIH1cbiAgfVxufVxuXG4vKipcbiAqIOe8k+WtmOe7n+iuoeaOpeWPo1xuICovXG5pbnRlcmZhY2UgQ2FjaGVTdGF0cyB7XG4gIC8qKiDmgLvor7fmsYLmlbAgKi9cbiAgdG90YWxSZXF1ZXN0czogbnVtYmVyXG4gIC8qKiDlkb3kuK3mrKHmlbAgKi9cbiAgaGl0czogbnVtYmVyXG4gIC8qKiDmnKrlkb3kuK3mrKHmlbAgKi9cbiAgbWlzc2VzOiBudW1iZXJcbiAgLyoqIOWRveS4reeOhyAqL1xuICBoaXRSYXRlOiBudW1iZXJcbiAgLyoqIOWQhOWxgue6p+e7n+iuoSAqL1xuICBsZXZlbFN0YXRzOiB7XG4gICAgW2tleSBpbiBDYWNoZUxldmVsXToge1xuICAgICAgcmVxdWVzdHM6IG51bWJlclxuICAgICAgaGl0czogbnVtYmVyXG4gICAgICBtaXNzZXM6IG51bWJlclxuICAgICAgaGl0UmF0ZTogbnVtYmVyXG4gICAgICBzaXplOiBudW1iZXJcbiAgICAgIG1lbW9yeVVzYWdlOiBudW1iZXJcbiAgICB9XG4gIH1cbiAgLyoqIOW5s+Wdh+WTjeW6lOaXtumXtCAqL1xuICBhdmdSZXNwb25zZVRpbWU6IG51bWJlclxuICAvKiog6ZSZ6K+v5qyh5pWwICovXG4gIGVycm9yczogbnVtYmVyXG4gIC8qKiDlpLHmlYjmrKHmlbAgKi9cbiAgZXZpY3Rpb25zOiBudW1iZXJcbn1cblxuLyoqXG4gKiDnvJPlrZjkuovku7bmjqXlj6NcbiAqL1xuaW50ZXJmYWNlIENhY2hlRXZlbnQge1xuICB0eXBlOiAnaGl0JyB8ICdtaXNzJyB8ICdzZXQnIHwgJ2RlbGV0ZScgfCAnZXZpY3QnIHwgJ2V4cGlyZSdcbiAga2V5OiBzdHJpbmdcbiAgbGV2ZWw6IENhY2hlTGV2ZWxcbiAgdGltZXN0YW1wOiBEYXRlXG4gIG1ldGFkYXRhPzogYW55XG59XG5cbi8qKlxuICog6aKE5rWL5oCn5Yqg6L296YWN572uXG4gKi9cbmludGVyZmFjZSBQcmVkaWN0aXZlTG9hZENvbmZpZyB7XG4gIC8qKiDmmK/lkKblkK/nlKggKi9cbiAgZW5hYmxlZDogYm9vbGVhblxuICAvKiog6aKE5rWL566X5rOVICovXG4gIGFsZ29yaXRobTogJ3BhdHRlcm4nIHwgJ21sJyB8ICdoeWJyaWQnXG4gIC8qKiDpooTmtYvnqpflj6MobXMpICovXG4gIHByZWRpY3Rpb25XaW5kb3c6IG51bWJlclxuICAvKiog572u5L+h5bqm6ZiI5YC8ICovXG4gIGNvbmZpZGVuY2VUaHJlc2hvbGQ6IG51bWJlclxuICAvKiog5pyA5aSn6aKE5Yqg6L295pWw6YePICovXG4gIG1heFByZWRpY3RpdmVMb2FkczogbnVtYmVyXG59XG5cbi8qKlxuICog5pm66IO957yT5a2Y566h55CG5Zmo57G7XG4gKi9cbmV4cG9ydCBjbGFzcyBJbnRlbGxpZ2VudENhY2hlTWFuYWdlciBleHRlbmRzIEV2ZW50RW1pdHRlciB7XG4gIHByaXZhdGUgY29uZmlnOiBDYWNoZUNvbmZpZ1xuICBwcml2YXRlIGwxQ2FjaGU6IExSVUNhY2hlPHN0cmluZywgQ2FjaGVJdGVtPlxuICBwcml2YXRlIGwyQ2FjaGU6IGFueSB8IG51bGwgPSBudWxsXG4gIHByaXZhdGUgc3RhdHM6IENhY2hlU3RhdHNcbiAgcHJpdmF0ZSBpc0FjdGl2ZTogYm9vbGVhbiA9IGZhbHNlXG4gIHByaXZhdGUgbW9uaXRvcmluZ0ludGVydmFsOiBOb2RlSlMuVGltZW91dCB8IG51bGwgPSBudWxsXG4gIHByaXZhdGUgd2FybXVwSW50ZXJ2YWw6IE5vZGVKUy5UaW1lb3V0IHwgbnVsbCA9IG51bGxcbiAgcHJpdmF0ZSBwcmVkaWN0aXZlQ29uZmlnOiBQcmVkaWN0aXZlTG9hZENvbmZpZ1xuICBwcml2YXRlIGFjY2Vzc1BhdHRlcm5zOiBNYXA8c3RyaW5nLCBudW1iZXJbXT4gPSBuZXcgTWFwKClcbiAgcHJpdmF0ZSBob3RLZXlzOiBTZXQ8c3RyaW5nPiA9IG5ldyBTZXQoKVxuICBwcml2YXRlIGtleVZlcnNpb25zOiBNYXA8c3RyaW5nLCBudW1iZXI+ID0gbmV3IE1hcCgpXG5cbiAgY29uc3RydWN0b3IoY29uZmlnOiBQYXJ0aWFsPENhY2hlQ29uZmlnPiA9IHt9KSB7XG4gICAgc3VwZXIoKVxuICAgIFxuICAgIC8vIOWIneWni+WMlumFjee9rlxuICAgIHRoaXMuY29uZmlnID0gdGhpcy5tZXJnZUNvbmZpZyhjb25maWcpXG4gICAgXG4gICAgLy8g5Yid5aeL5YyWTDHnvJPlrZhcbiAgICB0aGlzLmwxQ2FjaGUgPSBuZXcgTFJVQ2FjaGUoe1xuICAgICAgbWF4OiB0aGlzLmNvbmZpZy5sMS5tYXhTaXplLFxuICAgICAgdHRsOiB0aGlzLmNvbmZpZy5sMS50dGwsXG4gICAgICB1cGRhdGVBZ2VPbkdldDogdHJ1ZSxcbiAgICAgIGFsbG93U3RhbGU6IGZhbHNlXG4gICAgfSlcbiAgICBcbiAgICAvLyDliJ3lp4vljJbnu5/orqHkv6Hmga9cbiAgICB0aGlzLnN0YXRzID0gdGhpcy5pbml0aWFsaXplU3RhdHMoKVxuICAgIFxuICAgIC8vIOWIneWni+WMlumihOa1i+aAp+WKoOi9vemFjee9rlxuICAgIHRoaXMucHJlZGljdGl2ZUNvbmZpZyA9IHtcbiAgICAgIGVuYWJsZWQ6IHRydWUsXG4gICAgICBhbGdvcml0aG06ICdoeWJyaWQnLFxuICAgICAgcHJlZGljdGlvbldpbmRvdzogMzAwMDAwLCAvLyA15YiG6ZKfXG4gICAgICBjb25maWRlbmNlVGhyZXNob2xkOiAwLjcsXG4gICAgICBtYXhQcmVkaWN0aXZlTG9hZHM6IDUwXG4gICAgfVxuICAgIFxuICAgIHRoaXMuc2V0dXBFdmVudExpc3RlbmVycygpXG4gIH1cblxuICAvKipcbiAgICog5ZCI5bm26YWN572uXG4gICAqIFxuICAgKiBAcGFyYW0gdXNlckNvbmZpZyAtIOeUqOaIt+mFjee9rlxuICAgKiBAcmV0dXJucyDlkIjlubblkI7nmoTphY3nva5cbiAgICovXG4gIHByaXZhdGUgbWVyZ2VDb25maWcodXNlckNvbmZpZzogUGFydGlhbDxDYWNoZUNvbmZpZz4pOiBDYWNoZUNvbmZpZyB7XG4gICAgY29uc3QgZGVmYXVsdENvbmZpZzogQ2FjaGVDb25maWcgPSB7XG4gICAgICBsMToge1xuICAgICAgICBlbmFibGVkOiB0cnVlLFxuICAgICAgICBtYXhTaXplOiAxMDAwLFxuICAgICAgICB0dGw6IDMwMDAwMCwgLy8gNeWIhumSn1xuICAgICAgICBzdHJhdGVneTogQ2FjaGVTdHJhdGVneS5MUlVcbiAgICAgIH0sXG4gICAgICBsMjoge1xuICAgICAgICBlbmFibGVkOiB0cnVlLFxuICAgICAgICByZWRpczoge1xuICAgICAgICAgIGhvc3Q6IHByb2Nlc3MuZW52LlJFRElTX0hPU1QgfHwgJ2xvY2FsaG9zdCcsXG4gICAgICAgICAgcG9ydDogcGFyc2VJbnQocHJvY2Vzcy5lbnYuUkVESVNfUE9SVCB8fCAnNjM3OScpLFxuICAgICAgICAgIHBhc3N3b3JkOiBwcm9jZXNzLmVudi5SRURJU19QQVNTV09SRCxcbiAgICAgICAgICBkYjogcGFyc2VJbnQocHJvY2Vzcy5lbnYuUkVESVNfREIgfHwgJzAnKSxcbiAgICAgICAgICBrZXlQcmVmaXg6ICd6a19jYWNoZTonXG4gICAgICAgIH0sXHJcbiAgICAgICAgbWF4U2l6ZTogMTAwMDAsXHJcbiAgICAgICAgdHRsOiAxODAwMDAwLCAvLyAzMOWIhumSn1xyXG4gICAgICAgIHN0cmF0ZWd5OiBDYWNoZVN0cmF0ZWd5LkxSVVxyXG4gICAgICB9LFxyXG4gICAgICB3YXJtdXA6IHtcclxuICAgICAgICBlbmFibGVkOiB0cnVlLFxyXG4gICAgICAgIHF1ZXJpZXM6IFtdLFxyXG4gICAgICAgIHNjaGVkdWxlOiAnMCAqLzYgKiAqIConIC8vIOavjzblsI/ml7ZcclxuICAgICAgfSxcclxuICAgICAgbW9uaXRvcmluZzoge1xyXG4gICAgICAgIGVuYWJsZWQ6IHRydWUsXHJcbiAgICAgICAgbWV0cmljc0ludGVydmFsOiA2MDAwMCwgLy8gMeWIhumSn1xyXG4gICAgICAgIGFsZXJ0VGhyZXNob2xkczoge1xyXG4gICAgICAgICAgaGl0UmF0ZU1pbjogMC44LFxyXG4gICAgICAgICAgbWVtb3J5VXNhZ2VNYXg6IDAuOSxcclxuICAgICAgICAgIGxhdGVuY3lNYXg6IDEwMFxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgXHJcbiAgICByZXR1cm4gdGhpcy5kZWVwTWVyZ2UoZGVmYXVsdENvbmZpZywgdXNlckNvbmZpZylcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOa3seW6puWQiOW5tuWvueixoVxyXG4gICAqIFxyXG4gICAqIEBwYXJhbSB0YXJnZXQgLSDnm67moIflr7nosaFcclxuICAgKiBAcGFyYW0gc291cmNlIC0g5rqQ5a+56LGhXHJcbiAgICogQHJldHVybnMg5ZCI5bm25ZCO55qE5a+56LGhXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBkZWVwTWVyZ2UodGFyZ2V0OiBhbnksIHNvdXJjZTogYW55KTogYW55IHtcclxuICAgIGNvbnN0IHJlc3VsdCA9IHsgLi4udGFyZ2V0IH1cclxuICAgIFxyXG4gICAgZm9yIChjb25zdCBrZXkgaW4gc291cmNlKSB7XHJcbiAgICAgIGlmIChzb3VyY2Vba2V5XSAmJiB0eXBlb2Ygc291cmNlW2tleV0gPT09ICdvYmplY3QnICYmICFBcnJheS5pc0FycmF5KHNvdXJjZVtrZXldKSkge1xyXG4gICAgICAgIHJlc3VsdFtrZXldID0gdGhpcy5kZWVwTWVyZ2UodGFyZ2V0W2tleV0gfHwge30sIHNvdXJjZVtrZXldKVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJlc3VsdFtrZXldID0gc291cmNlW2tleV1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgXHJcbiAgICByZXR1cm4gcmVzdWx0XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDliJ3lp4vljJbnu5/orqHkv6Hmga9cclxuICAgKiBcclxuICAgKiBAcmV0dXJucyDliJ3lp4vnu5/orqHkv6Hmga9cclxuICAgKi9cclxuICBwcml2YXRlIGluaXRpYWxpemVTdGF0cygpOiBDYWNoZVN0YXRzIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHRvdGFsUmVxdWVzdHM6IDAsXHJcbiAgICAgIGhpdHM6IDAsXHJcbiAgICAgIG1pc3NlczogMCxcclxuICAgICAgaGl0UmF0ZTogMCxcclxuICAgICAgbGV2ZWxTdGF0czoge1xyXG4gICAgICAgIFtDYWNoZUxldmVsLkwxXToge1xyXG4gICAgICAgICAgcmVxdWVzdHM6IDAsXHJcbiAgICAgICAgICBoaXRzOiAwLFxyXG4gICAgICAgICAgbWlzc2VzOiAwLFxyXG4gICAgICAgICAgaGl0UmF0ZTogMCxcclxuICAgICAgICAgIHNpemU6IDAsXHJcbiAgICAgICAgICBtZW1vcnlVc2FnZTogMFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgW0NhY2hlTGV2ZWwuTDJdOiB7XHJcbiAgICAgICAgICByZXF1ZXN0czogMCxcclxuICAgICAgICAgIGhpdHM6IDAsXHJcbiAgICAgICAgICBtaXNzZXM6IDAsXHJcbiAgICAgICAgICBoaXRSYXRlOiAwLFxyXG4gICAgICAgICAgc2l6ZTogMCxcclxuICAgICAgICAgIG1lbW9yeVVzYWdlOiAwXHJcbiAgICAgICAgfSxcclxuICAgICAgICBbQ2FjaGVMZXZlbC5MM106IHtcclxuICAgICAgICAgIHJlcXVlc3RzOiAwLFxyXG4gICAgICAgICAgaGl0czogMCxcclxuICAgICAgICAgIG1pc3NlczogMCxcclxuICAgICAgICAgIGhpdFJhdGU6IDAsXHJcbiAgICAgICAgICBzaXplOiAwLFxyXG4gICAgICAgICAgbWVtb3J5VXNhZ2U6IDBcclxuICAgICAgICB9XHJcbiAgICAgIH0sXHJcbiAgICAgIGF2Z1Jlc3BvbnNlVGltZTogMCxcclxuICAgICAgZXJyb3JzOiAwLFxyXG4gICAgICBldmljdGlvbnM6IDBcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiuvue9ruS6i+S7tuebkeWQrOWZqFxyXG4gICAqL1xyXG4gIHByaXZhdGUgc2V0dXBFdmVudExpc3RlbmVycygpOiB2b2lkIHtcclxuICAgIC8vIOebkeWQrOafpeivouaAp+iDveS8mOWMluWZqOS6i+S7tlxyXG4gICAgcXVlcnlQZXJmb3JtYW5jZU9wdGltaXplci5vbigncXVlcnktY29tcGxldGVkJywgKHN0YXRzOiBhbnkpID0+IHtcclxuICAgICAgdGhpcy5oYW5kbGVRdWVyeUNvbXBsZXRlZChzdGF0cylcclxuICAgIH0pXHJcbiAgICBcclxuICAgIC8vIOebkeWQrOaVsOaNruW6k+ebkeaOp+S6i+S7tlxyXG4gICAgZGF0YWJhc2VNb25pdG9yLm9uKCdtZXRyaWNzJywgKG1ldHJpY3M6IGFueSkgPT4ge1xyXG4gICAgICB0aGlzLmhhbmRsZURhdGFiYXNlTWV0cmljcyhtZXRyaWNzKVxyXG4gICAgfSlcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWQr+WKqOe8k+WtmOeuoeeQhuWZqFxyXG4gICAqL1xyXG4gIGFzeW5jIHN0YXJ0KCk6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgaWYgKHRoaXMuaXNBY3RpdmUpIHtcclxuICAgICAgY29uc29sZS5sb2coJ0ludGVsbGlnZW50IGNhY2hlIG1hbmFnZXIgaXMgYWxyZWFkeSBhY3RpdmUnKVxyXG4gICAgICByZXR1cm5cclxuICAgIH1cclxuXHJcbiAgICBjb25zb2xlLmxvZygnU3RhcnRpbmcgaW50ZWxsaWdlbnQgY2FjaGUgbWFuYWdlcicpXHJcbiAgICBcclxuICAgIHRyeSB7XHJcbiAgICAgIC8vIOWIneWni+WMlkwy57yT5a2YKFJlZGlzKVxyXG4gICAgICBpZiAodGhpcy5jb25maWcubDIuZW5hYmxlZCkge1xyXG4gICAgICAgIGF3YWl0IHRoaXMuaW5pdGlhbGl6ZUwyQ2FjaGUoKVxyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICAvLyDlkK/liqjnm5HmjqdcclxuICAgICAgaWYgKHRoaXMuY29uZmlnLm1vbml0b3JpbmcuZW5hYmxlZCkge1xyXG4gICAgICAgIHRoaXMuc3RhcnRNb25pdG9yaW5nKClcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgLy8g5ZCv5Yqo57yT5a2Y6aKE54OtXHJcbiAgICAgIGlmICh0aGlzLmNvbmZpZy53YXJtdXAuZW5hYmxlZCkge1xyXG4gICAgICAgIHRoaXMuc3RhcnRXYXJtdXAoKVxyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICB0aGlzLmlzQWN0aXZlID0gdHJ1ZVxyXG4gICAgICB0aGlzLmVtaXQoJ2NhY2hlLW1hbmFnZXItc3RhcnRlZCcpXHJcbiAgICAgIFxyXG4gICAgICBjb25zb2xlLmxvZygnSW50ZWxsaWdlbnQgY2FjaGUgbWFuYWdlciBzdGFydGVkIHN1Y2Nlc3NmdWxseScpXHJcbiAgICAgIFxyXG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gc3RhcnQgaW50ZWxsaWdlbnQgY2FjaGUgbWFuYWdlcjonLCBlcnJvcilcclxuICAgICAgdGhyb3cgZXJyb3JcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWBnOatoue8k+WtmOeuoeeQhuWZqFxyXG4gICAqL1xyXG4gIGFzeW5jIHN0b3AoKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICBpZiAoIXRoaXMuaXNBY3RpdmUpIHtcclxuICAgICAgcmV0dXJuXHJcbiAgICB9XHJcblxyXG4gICAgY29uc29sZS5sb2coJ1N0b3BwaW5nIGludGVsbGlnZW50IGNhY2hlIG1hbmFnZXInKVxyXG4gICAgXHJcbiAgICB0aGlzLmlzQWN0aXZlID0gZmFsc2VcclxuICAgIFxyXG4gICAgLy8g5YGc5q2i55uR5o6nXHJcbiAgICBpZiAodGhpcy5tb25pdG9yaW5nSW50ZXJ2YWwpIHtcclxuICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLm1vbml0b3JpbmdJbnRlcnZhbClcclxuICAgICAgdGhpcy5tb25pdG9yaW5nSW50ZXJ2YWwgPSBudWxsXHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIOWBnOatoumihOeDrVxyXG4gICAgaWYgKHRoaXMud2FybXVwSW50ZXJ2YWwpIHtcclxuICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLndhcm11cEludGVydmFsKVxyXG4gICAgICB0aGlzLndhcm11cEludGVydmFsID0gbnVsbFxyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyDlhbPpl61SZWRpc+i/nuaOpVxyXG4gICAgaWYgKHRoaXMubDJDYWNoZSkge1xyXG4gICAgICBhd2FpdCB0aGlzLmwyQ2FjaGUucXVpdCgpXHJcbiAgICAgIHRoaXMubDJDYWNoZSA9IG51bGxcclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8g5riF56m6TDHnvJPlrZhcclxuICAgIHRoaXMubDFDYWNoZS5jbGVhcigpXHJcbiAgICBcclxuICAgIHRoaXMuZW1pdCgnY2FjaGUtbWFuYWdlci1zdG9wcGVkJylcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWIneWni+WMlkwy57yT5a2YXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBhc3luYyBpbml0aWFsaXplTDJDYWNoZSgpOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIC8vIOajgOafpVJlZGlz5piv5ZCm5Y+v55SoXHJcbiAgICBpZiAoIVJlZGlzKSB7XHJcbiAgICAgIGNvbnNvbGUud2FybignUmVkaXMgbm90IGF2YWlsYWJsZSwgTDIgY2FjaGUgZGlzYWJsZWQnKVxyXG4gICAgICB0aGlzLmNvbmZpZy5sMi5lbmFibGVkID0gZmFsc2VcclxuICAgICAgcmV0dXJuXHJcbiAgICB9XHJcbiAgICBcclxuICAgIGNvbnN0IHJlZGlzQ29uZmlnID0gdGhpcy5jb25maWcubDIucmVkaXNcclxuICAgIFxyXG4gICAgdHJ5IHtcclxuICAgICAgdGhpcy5sMkNhY2hlID0gbmV3IFJlZGlzKHtcclxuICAgICAgICBob3N0OiByZWRpc0NvbmZpZy5ob3N0LFxyXG4gICAgICAgIHBvcnQ6IHJlZGlzQ29uZmlnLnBvcnQsXHJcbiAgICAgICAgcGFzc3dvcmQ6IHJlZGlzQ29uZmlnLnBhc3N3b3JkLFxyXG4gICAgICAgIGRiOiByZWRpc0NvbmZpZy5kYixcclxuICAgICAgICBrZXlQcmVmaXg6IHJlZGlzQ29uZmlnLmtleVByZWZpeCxcclxuICAgICAgICByZXRyeURlbGF5T25GYWlsb3ZlcjogMTAwLFxyXG4gICAgICAgIG1heFJldHJpZXNQZXJSZXF1ZXN0OiAzLFxyXG4gICAgICAgIGxhenlDb25uZWN0OiB0cnVlXHJcbiAgICAgIH0pXHJcbiAgICAgIFxyXG4gICAgICAvLyDorr7nva5SZWRpc+S6i+S7tuebkeWQrFxyXG4gICAgICB0aGlzLmwyQ2FjaGUub24oJ2Nvbm5lY3QnLCAoKSA9PiB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ0Nvbm5lY3RlZCB0byBSZWRpcyBjYWNoZScpXHJcbiAgICAgIH0pXHJcbiAgICAgIFxyXG4gICAgICB0aGlzLmwyQ2FjaGUub24oJ2Vycm9yJywgKGVycm9yOiBhbnkpID0+IHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdSZWRpcyBjYWNoZSBlcnJvcjonLCBlcnJvcilcclxuICAgICAgICB0aGlzLnN0YXRzLmVycm9ycysrXHJcbiAgICAgIH0pXHJcbiAgICAgIFxyXG4gICAgICAvLyDmtYvor5Xov57mjqVcclxuICAgICAgYXdhaXQgdGhpcy5sMkNhY2hlLnBpbmcoKVxyXG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xyXG4gICAgICBjb25zb2xlLndhcm4oJ0ZhaWxlZCB0byBpbml0aWFsaXplIFJlZGlzIGNhY2hlLCBmYWxsaW5nIGJhY2sgdG8gTDEgb25seTonLCBlcnJvcilcclxuICAgICAgdGhpcy5jb25maWcubDIuZW5hYmxlZCA9IGZhbHNlXHJcbiAgICAgIHRoaXMubDJDYWNoZSA9IG51bGxcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWQr+WKqOebkeaOp1xyXG4gICAqL1xyXG4gIHByaXZhdGUgc3RhcnRNb25pdG9yaW5nKCk6IHZvaWQge1xyXG4gICAgdGhpcy5tb25pdG9yaW5nSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XHJcbiAgICAgIHRoaXMuY29sbGVjdE1ldHJpY3MoKVxyXG4gICAgICB0aGlzLmNoZWNrQWxlcnRzKClcclxuICAgICAgdGhpcy5vcHRpbWl6ZUNhY2hlKClcclxuICAgIH0sIHRoaXMuY29uZmlnLm1vbml0b3JpbmcubWV0cmljc0ludGVydmFsKVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5ZCv5Yqo57yT5a2Y6aKE54OtXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBzdGFydFdhcm11cCgpOiB2b2lkIHtcclxuICAgIC8vIOeri+WNs+aJp+ihjOS4gOasoemihOeDrVxyXG4gICAgdGhpcy5wZXJmb3JtV2FybXVwKClcclxuICAgIFxyXG4gICAgLy8g5a6a5pyf6aKE54OtKOi/memHjOeugOWMluS4uuavj+Wwj+aXtuS4gOasoSlcclxuICAgIHRoaXMud2FybXVwSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XHJcbiAgICAgIHRoaXMucGVyZm9ybVdhcm11cCgpXHJcbiAgICB9LCAzNjAwMDAwKSAvLyAx5bCP5pe2XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDojrflj5bnvJPlrZjmlbDmja5cclxuICAgKiBcclxuICAgKiBAcGFyYW0ga2V5IC0g57yT5a2Y6ZSuXHJcbiAgICogQHBhcmFtIGxvYWRlciAtIOaVsOaNruWKoOi9veWHveaVsFxyXG4gICAqIEBwYXJhbSBvcHRpb25zIC0g6YCJ6aG5XHJcbiAgICogQHJldHVybnMg57yT5a2Y5pWw5o2uXHJcbiAgICovXHJcbiAgYXN5bmMgZ2V0PFQ+KFxyXG4gICAga2V5OiBzdHJpbmcsIFxyXG4gICAgbG9hZGVyPzogKCkgPT4gUHJvbWlzZTxUPiwgXHJcbiAgICBvcHRpb25zOiB7XHJcbiAgICAgIHR0bD86IG51bWJlclxyXG4gICAgICB0YWdzPzogc3RyaW5nW11cclxuICAgICAgcHJpb3JpdHk/OiBudW1iZXJcclxuICAgICAgbGV2ZWw/OiBDYWNoZUxldmVsXHJcbiAgICB9ID0ge31cclxuICApOiBQcm9taXNlPFQgfCBudWxsPiB7XHJcbiAgICBjb25zdCBzdGFydFRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKVxyXG4gICAgXHJcbiAgICB0cnkge1xyXG4gICAgICB0aGlzLnN0YXRzLnRvdGFsUmVxdWVzdHMrK1xyXG4gICAgICB0aGlzLnJlY29yZEFjY2VzcyhrZXkpXHJcbiAgICAgIFxyXG4gICAgICAvLyDlsJ3or5Xku45MMee8k+WtmOiOt+WPllxyXG4gICAgICBsZXQgcmVzdWx0ID0gYXdhaXQgdGhpcy5nZXRGcm9tTDEoa2V5KVxyXG4gICAgICBpZiAocmVzdWx0ICE9PSBudWxsKSB7XHJcbiAgICAgICAgdGhpcy5yZWNvcmRIaXQoQ2FjaGVMZXZlbC5MMSlcclxuICAgICAgICB0aGlzLmVtaXQoJ2NhY2hlLWV2ZW50Jywge1xyXG4gICAgICAgICAgdHlwZTogJ2hpdCcsXHJcbiAgICAgICAgICBrZXksXHJcbiAgICAgICAgICBsZXZlbDogQ2FjaGVMZXZlbC5MMSxcclxuICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKVxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdC52YWx1ZVxyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICAvLyDlsJ3or5Xku45MMue8k+WtmOiOt+WPllxyXG4gICAgICBpZiAodGhpcy5jb25maWcubDIuZW5hYmxlZCAmJiB0aGlzLmwyQ2FjaGUpIHtcclxuICAgICAgICByZXN1bHQgPSBhd2FpdCB0aGlzLmdldEZyb21MMihrZXkpXHJcbiAgICAgICAgaWYgKHJlc3VsdCAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgLy8g5Zue5YaZ5YiwTDHnvJPlrZhcclxuICAgICAgICAgIGF3YWl0IHRoaXMuc2V0VG9MMShrZXksIHJlc3VsdC52YWx1ZSwgb3B0aW9ucylcclxuICAgICAgICAgIHRoaXMucmVjb3JkSGl0KENhY2hlTGV2ZWwuTDIpXHJcbiAgICAgICAgICB0aGlzLmVtaXQoJ2NhY2hlLWV2ZW50Jywge1xyXG4gICAgICAgICAgICB0eXBlOiAnaGl0JyxcclxuICAgICAgICAgICAga2V5LFxyXG4gICAgICAgICAgICBsZXZlbDogQ2FjaGVMZXZlbC5MMixcclxuICAgICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpXHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgICAgcmV0dXJuIHJlc3VsdC52YWx1ZVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgLy8g57yT5a2Y5pyq5ZG95Lit77yM5L2/55SobG9hZGVy5Yqg6L295pWw5o2uXHJcbiAgICAgIGlmIChsb2FkZXIpIHtcclxuICAgICAgICBjb25zdCBkYXRhID0gYXdhaXQgbG9hZGVyKClcclxuICAgICAgICBpZiAoZGF0YSAhPT0gbnVsbCAmJiBkYXRhICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgIGF3YWl0IHRoaXMuc2V0KGtleSwgZGF0YSwgb3B0aW9ucylcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5yZWNvcmRNaXNzKClcclxuICAgICAgICByZXR1cm4gZGF0YVxyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICB0aGlzLnJlY29yZE1pc3MoKVxyXG4gICAgICByZXR1cm4gbnVsbFxyXG4gICAgICBcclxuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcclxuICAgICAgY29uc29sZS5lcnJvcihgQ2FjaGUgZ2V0IGVycm9yIGZvciBrZXkgJHtrZXl9OmAsIGVycm9yKVxyXG4gICAgICB0aGlzLnN0YXRzLmVycm9ycysrXHJcbiAgICAgIFxyXG4gICAgICAvLyDlpoLmnpzmnIlsb2FkZXLvvIzlsJ3or5Xnm7TmjqXliqDovb1cclxuICAgICAgaWYgKGxvYWRlcikge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICByZXR1cm4gYXdhaXQgbG9hZGVyKClcclxuICAgICAgICB9IGNhdGNoIChsb2FkZXJFcnJvcjogYW55KSB7XHJcbiAgICAgICAgICBjb25zb2xlLmVycm9yKGBMb2FkZXIgZXJyb3IgZm9yIGtleSAke2tleX06YCwgbG9hZGVyRXJyb3IpXHJcbiAgICAgICAgICByZXR1cm4gbnVsbFxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgcmV0dXJuIG51bGxcclxuICAgICAgXHJcbiAgICB9IGZpbmFsbHkge1xyXG4gICAgICBjb25zdCBlbmRUaW1lID0gcGVyZm9ybWFuY2Uubm93KClcclxuICAgICAgdGhpcy51cGRhdGVSZXNwb25zZVRpbWUoZW5kVGltZSAtIHN0YXJ0VGltZSlcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiuvue9rue8k+WtmOaVsOaNrlxyXG4gICAqIFxyXG4gICAqIEBwYXJhbSBrZXkgLSDnvJPlrZjplK5cclxuICAgKiBAcGFyYW0gdmFsdWUgLSDnvJPlrZjlgLxcclxuICAgKiBAcGFyYW0gb3B0aW9ucyAtIOmAiemhuVxyXG4gICAqL1xyXG4gIGFzeW5jIHNldDxUPihcclxuICAgIGtleTogc3RyaW5nLCBcclxuICAgIHZhbHVlOiBULCBcclxuICAgIG9wdGlvbnM6IHtcclxuICAgICAgdHRsPzogbnVtYmVyXHJcbiAgICAgIHRhZ3M/OiBzdHJpbmdbXVxyXG4gICAgICBwcmlvcml0eT86IG51bWJlclxyXG4gICAgICBsZXZlbD86IENhY2hlTGV2ZWxcclxuICAgIH0gPSB7fVxyXG4gICk6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgdHRsID0gb3B0aW9ucy50dGwgfHwgdGhpcy5jb25maWcubDEudHRsXHJcbiAgICAgIGNvbnN0IHRhZ3MgPSBvcHRpb25zLnRhZ3MgfHwgW11cclxuICAgICAgY29uc3QgcHJpb3JpdHkgPSBvcHRpb25zLnByaW9yaXR5IHx8IDFcclxuICAgICAgY29uc3QgdGFyZ2V0TGV2ZWwgPSBvcHRpb25zLmxldmVsXHJcbiAgICAgIFxyXG4gICAgICAvLyDmm7TmlrDniYjmnKzlj7dcclxuICAgICAgY29uc3QgdmVyc2lvbiA9IHRoaXMuaW5jcmVtZW50VmVyc2lvbihrZXkpXHJcbiAgICAgIFxyXG4gICAgICBjb25zdCBjYWNoZUl0ZW06IENhY2hlSXRlbTxUPiA9IHtcclxuICAgICAgICBrZXksXHJcbiAgICAgICAgdmFsdWUsXHJcbiAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLFxyXG4gICAgICAgIGV4cGlyZXNBdDogbmV3IERhdGUoRGF0ZS5ub3coKSArIHR0bCksXHJcbiAgICAgICAgYWNjZXNzQ291bnQ6IDAsXHJcbiAgICAgICAgbGFzdEFjY2Vzc2VkQXQ6IG5ldyBEYXRlKCksXHJcbiAgICAgICAgc2l6ZTogdGhpcy5jYWxjdWxhdGVTaXplKHZhbHVlKSxcclxuICAgICAgICBsZXZlbDogQ2FjaGVMZXZlbC5MMSxcclxuICAgICAgICB2ZXJzaW9uLFxyXG4gICAgICAgIHRhZ3MsXHJcbiAgICAgICAgcHJpb3JpdHksXHJcbiAgICAgICAgaXNIb3Q6IHRoaXMuaG90S2V5cy5oYXMoa2V5KVxyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICAvLyDorr7nva7liLBMMee8k+WtmFxyXG4gICAgICBpZiAoIXRhcmdldExldmVsIHx8IHRhcmdldExldmVsID09PSBDYWNoZUxldmVsLkwxKSB7XHJcbiAgICAgICAgYXdhaXQgdGhpcy5zZXRUb0wxKGtleSwgdmFsdWUsIG9wdGlvbnMpXHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIC8vIOiuvue9ruWIsEwy57yT5a2YXHJcbiAgICAgIGlmICh0aGlzLmNvbmZpZy5sMi5lbmFibGVkICYmIHRoaXMubDJDYWNoZSAmJiAoIXRhcmdldExldmVsIHx8IHRhcmdldExldmVsID09PSBDYWNoZUxldmVsLkwyKSkge1xyXG4gICAgICAgIGF3YWl0IHRoaXMuc2V0VG9MMihrZXksIGNhY2hlSXRlbSlcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgdGhpcy5lbWl0KCdjYWNoZS1ldmVudCcsIHtcclxuICAgICAgICB0eXBlOiAnc2V0JyxcclxuICAgICAgICBrZXksXHJcbiAgICAgICAgbGV2ZWw6IHRhcmdldExldmVsIHx8IENhY2hlTGV2ZWwuTDEsXHJcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxyXG4gICAgICAgIG1ldGFkYXRhOiB7IHNpemU6IGNhY2hlSXRlbS5zaXplLCB0dGwgfVxyXG4gICAgICB9KVxyXG4gICAgICBcclxuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcclxuICAgICAgY29uc29sZS5lcnJvcihgQ2FjaGUgc2V0IGVycm9yIGZvciBrZXkgJHtrZXl9OmAsIGVycm9yKVxyXG4gICAgICB0aGlzLnN0YXRzLmVycm9ycysrXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDliKDpmaTnvJPlrZjmlbDmja5cclxuICAgKiBcclxuICAgKiBAcGFyYW0ga2V5IC0g57yT5a2Y6ZSuXHJcbiAgICovXHJcbiAgYXN5bmMgZGVsZXRlKGtleTogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAvLyDku45MMee8k+WtmOWIoOmZpFxyXG4gICAgICB0aGlzLmwxQ2FjaGUuZGVsZXRlKGtleSlcclxuICAgICAgXHJcbiAgICAgIC8vIOS7jkwy57yT5a2Y5Yig6ZmkXHJcbiAgICAgIGlmICh0aGlzLmNvbmZpZy5sMi5lbmFibGVkICYmIHRoaXMubDJDYWNoZSkge1xyXG4gICAgICAgIGF3YWl0IHRoaXMubDJDYWNoZS5kZWwoa2V5KVxyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICAvLyDmuIXnkIbnm7jlhbPmlbDmja5cclxuICAgICAgdGhpcy5hY2Nlc3NQYXR0ZXJucy5kZWxldGUoa2V5KVxyXG4gICAgICB0aGlzLmhvdEtleXMuZGVsZXRlKGtleSlcclxuICAgICAgdGhpcy5rZXlWZXJzaW9ucy5kZWxldGUoa2V5KVxyXG4gICAgICBcclxuICAgICAgdGhpcy5lbWl0KCdjYWNoZS1ldmVudCcsIHtcclxuICAgICAgICB0eXBlOiAnZGVsZXRlJyxcclxuICAgICAgICBrZXksXHJcbiAgICAgICAgbGV2ZWw6IENhY2hlTGV2ZWwuTDEsXHJcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpXHJcbiAgICAgIH0pXHJcbiAgICAgIFxyXG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xyXG4gICAgICBjb25zb2xlLmVycm9yKGBDYWNoZSBkZWxldGUgZXJyb3IgZm9yIGtleSAke2tleX06YCwgZXJyb3IpXHJcbiAgICAgIHRoaXMuc3RhdHMuZXJyb3JzKytcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaJuemHj+WIoOmZpOe8k+WtmCjmjInmoIfnrb4pXHJcbiAgICogXHJcbiAgICogQHBhcmFtIHRhZ3MgLSDmoIfnrb7mlbDnu4RcclxuICAgKi9cclxuICBhc3luYyBkZWxldGVCeVRhZ3ModGFnczogc3RyaW5nW10pOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IGtleXNUb0RlbGV0ZTogc3RyaW5nW10gPSBbXVxyXG4gICAgICBcclxuICAgICAgLy8g5LuOTDHnvJPlrZjkuK3mn6Xmib7ljLnphY3nmoTplK5cclxuICAgICAgZm9yIChjb25zdCBba2V5LCBpdGVtXSBvZiB0aGlzLmwxQ2FjaGUuZW50cmllcygpKSB7XHJcbiAgICAgICAgaWYgKGl0ZW0gJiYgaXRlbS50YWdzICYmIGl0ZW0udGFncy5zb21lKCh0YWc6IHN0cmluZykgPT4gdGFncy5pbmNsdWRlcyh0YWcpKSkge1xyXG4gICAgICAgICAga2V5c1RvRGVsZXRlLnB1c2goa2V5KVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgLy8g5LuOTDLnvJPlrZjkuK3mn6Xmib7ljLnphY3nmoTplK4o5aaC5p6c5ZCv55SoKVxyXG4gICAgICBpZiAodGhpcy5jb25maWcubDIuZW5hYmxlZCAmJiB0aGlzLmwyQ2FjaGUpIHtcclxuICAgICAgICAvLyDov5nph4zpnIDopoHlrp7njrBSZWRpc+S4reaMieagh+etvuafpeaJvueahOmAu+i+kVxyXG4gICAgICAgIC8vIOWPr+S7peS9v+eUqFJlZGlz55qEU0VU5pWw5o2u57uT5p6E5p2l57u05oqk5qCH562+5Yiw6ZSu55qE5pig5bCEXHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIC8vIOaJuemHj+WIoOmZpFxyXG4gICAgICBmb3IgKGNvbnN0IGtleSBvZiBrZXlzVG9EZWxldGUpIHtcclxuICAgICAgICBhd2FpdCB0aGlzLmRlbGV0ZShrZXkpXHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIGNvbnNvbGUubG9nKGBEZWxldGVkICR7a2V5c1RvRGVsZXRlLmxlbmd0aH0gY2FjaGUgaXRlbXMgYnkgdGFnczpgLCB0YWdzKVxyXG4gICAgICBcclxuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignQ2FjaGUgZGVsZXRlIGJ5IHRhZ3MgZXJyb3I6JywgZXJyb3IpXHJcbiAgICAgIHRoaXMuc3RhdHMuZXJyb3JzKytcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOS7jkwx57yT5a2Y6I635Y+W5pWw5o2uXHJcbiAgICogXHJcbiAgICogQHBhcmFtIGtleSAtIOe8k+WtmOmUrlxyXG4gICAqIEByZXR1cm5zIOe8k+WtmOmhuVxyXG4gICAqL1xyXG4gIHByaXZhdGUgYXN5bmMgZ2V0RnJvbUwxKGtleTogc3RyaW5nKTogUHJvbWlzZTxDYWNoZUl0ZW0gfCBudWxsPiB7XHJcbiAgICB0aGlzLnN0YXRzLmxldmVsU3RhdHNbQ2FjaGVMZXZlbC5MMV0ucmVxdWVzdHMrK1xyXG4gICAgXHJcbiAgICBjb25zdCBpdGVtID0gdGhpcy5sMUNhY2hlLmdldChrZXkpXHJcbiAgICBpZiAoaXRlbSkge1xyXG4gICAgICBpdGVtLmFjY2Vzc0NvdW50KytcclxuICAgICAgaXRlbS5sYXN0QWNjZXNzZWRBdCA9IG5ldyBEYXRlKClcclxuICAgICAgcmV0dXJuIGl0ZW1cclxuICAgIH1cclxuICAgIFxyXG4gICAgcmV0dXJuIG51bGxcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOS7jkwy57yT5a2Y6I635Y+W5pWw5o2uXHJcbiAgICogXHJcbiAgICogQHBhcmFtIGtleSAtIOe8k+WtmOmUrlxyXG4gICAqIEByZXR1cm5zIOe8k+WtmOmhuVxyXG4gICAqL1xyXG4gIHByaXZhdGUgYXN5bmMgZ2V0RnJvbUwyKGtleTogc3RyaW5nKTogUHJvbWlzZTxDYWNoZUl0ZW0gfCBudWxsPiB7XHJcbiAgICBpZiAoIXRoaXMubDJDYWNoZSkge1xyXG4gICAgICByZXR1cm4gbnVsbFxyXG4gICAgfVxyXG4gICAgXHJcbiAgICB0aGlzLnN0YXRzLmxldmVsU3RhdHNbQ2FjaGVMZXZlbC5MMl0ucmVxdWVzdHMrK1xyXG4gICAgXHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBkYXRhID0gYXdhaXQgdGhpcy5sMkNhY2hlLmdldChrZXkpXHJcbiAgICAgIGlmIChkYXRhKSB7XHJcbiAgICAgICAgY29uc3QgaXRlbTogQ2FjaGVJdGVtID0gSlNPTi5wYXJzZShkYXRhKVxyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIOajgOafpeaYr+WQpui/h+acn1xyXG4gICAgICAgIGlmIChuZXcgRGF0ZShpdGVtLmV4cGlyZXNBdCkgPiBuZXcgRGF0ZSgpKSB7XHJcbiAgICAgICAgICBpdGVtLmFjY2Vzc0NvdW50KytcclxuICAgICAgICAgIGl0ZW0ubGFzdEFjY2Vzc2VkQXQgPSBuZXcgRGF0ZSgpXHJcbiAgICAgICAgICBcclxuICAgICAgICAgIC8vIOabtOaWsEwy57yT5a2Y5Lit55qE6K6/6Zeu5L+h5oGvXHJcbiAgICAgICAgICBhd2FpdCB0aGlzLmwyQ2FjaGUuc2V0KGtleSwgSlNPTi5zdHJpbmdpZnkoaXRlbSksICdQWCcsIHRoaXMuY29uZmlnLmwyLnR0bClcclxuICAgICAgICAgIFxyXG4gICAgICAgICAgcmV0dXJuIGl0ZW1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgLy8g6L+H5pyf5pWw5o2u77yM5Yig6ZmkXHJcbiAgICAgICAgICBhd2FpdCB0aGlzLmwyQ2FjaGUuZGVsKGtleSlcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcclxuICAgICAgY29uc29sZS5lcnJvcihgTDIgY2FjaGUgZ2V0IGVycm9yIGZvciBrZXkgJHtrZXl9OmAsIGVycm9yKVxyXG4gICAgfVxyXG4gICAgXHJcbiAgICByZXR1cm4gbnVsbFxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6K6+572u5pWw5o2u5YiwTDHnvJPlrZhcclxuICAgKiBcclxuICAgKiBAcGFyYW0ga2V5IC0g57yT5a2Y6ZSuXHJcbiAgICogQHBhcmFtIHZhbHVlIC0g57yT5a2Y5YC8XHJcbiAgICogQHBhcmFtIG9wdGlvbnMgLSDpgInpoblcclxuICAgKi9cclxuICBwcml2YXRlIGFzeW5jIHNldFRvTDE8VD4oa2V5OiBzdHJpbmcsIHZhbHVlOiBULCBvcHRpb25zOiBhbnkgPSB7fSk6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgY29uc3QgdHRsID0gb3B0aW9ucy50dGwgfHwgdGhpcy5jb25maWcubDEudHRsXHJcbiAgICBjb25zdCB0YWdzID0gb3B0aW9ucy50YWdzIHx8IFtdXHJcbiAgICBjb25zdCBwcmlvcml0eSA9IG9wdGlvbnMucHJpb3JpdHkgfHwgMVxyXG4gICAgY29uc3QgdmVyc2lvbiA9IHRoaXMuZ2V0VmVyc2lvbihrZXkpXHJcbiAgICBcclxuICAgIGNvbnN0IGNhY2hlSXRlbTogQ2FjaGVJdGVtPFQ+ID0ge1xyXG4gICAgICBrZXksXHJcbiAgICAgIHZhbHVlLFxyXG4gICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXHJcbiAgICAgIGV4cGlyZXNBdDogbmV3IERhdGUoRGF0ZS5ub3coKSArIHR0bCksXHJcbiAgICAgIGFjY2Vzc0NvdW50OiAwLFxyXG4gICAgICBsYXN0QWNjZXNzZWRBdDogbmV3IERhdGUoKSxcclxuICAgICAgc2l6ZTogdGhpcy5jYWxjdWxhdGVTaXplKHZhbHVlKSxcclxuICAgICAgbGV2ZWw6IENhY2hlTGV2ZWwuTDEsXHJcbiAgICAgIHZlcnNpb24sXHJcbiAgICAgIHRhZ3MsXHJcbiAgICAgIHByaW9yaXR5LFxyXG4gICAgICBpc0hvdDogdGhpcy5ob3RLZXlzLmhhcyhrZXkpXHJcbiAgICB9XHJcbiAgICBcclxuICAgIHRoaXMubDFDYWNoZS5zZXQoa2V5LCBjYWNoZUl0ZW0sIHsgdHRsIH0pXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDorr7nva7mlbDmja7liLBMMue8k+WtmFxyXG4gICAqIFxyXG4gICAqIEBwYXJhbSBrZXkgLSDnvJPlrZjplK5cclxuICAgKiBAcGFyYW0gaXRlbSAtIOe8k+WtmOmhuVxyXG4gICAqL1xyXG4gIHByaXZhdGUgYXN5bmMgc2V0VG9MMihrZXk6IHN0cmluZywgaXRlbTogQ2FjaGVJdGVtKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICBpZiAoIXRoaXMubDJDYWNoZSkge1xyXG4gICAgICByZXR1cm5cclxuICAgIH1cclxuICAgIFxyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3Qgc2VyaWFsaXplZEl0ZW0gPSBKU09OLnN0cmluZ2lmeShpdGVtKVxyXG4gICAgICBhd2FpdCB0aGlzLmwyQ2FjaGUuc2V0KGtleSwgc2VyaWFsaXplZEl0ZW0sICdQWCcsIHRoaXMuY29uZmlnLmwyLnR0bClcclxuICAgICAgXHJcbiAgICAgIC8vIOe7tOaKpOagh+etvue0ouW8lVxyXG4gICAgICBpZiAoaXRlbS50YWdzICYmIGl0ZW0udGFncy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgZm9yIChjb25zdCB0YWcgb2YgaXRlbS50YWdzKSB7XHJcbiAgICAgICAgICBhd2FpdCB0aGlzLmwyQ2FjaGUuc2FkZChgdGFnOiR7dGFnfWAsIGtleSlcclxuICAgICAgICAgIGF3YWl0IHRoaXMubDJDYWNoZS5leHBpcmUoYHRhZzoke3RhZ31gLCBNYXRoLmNlaWwodGhpcy5jb25maWcubDIudHRsIC8gMTAwMCkpXHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xyXG4gICAgICBjb25zb2xlLmVycm9yKGBMMiBjYWNoZSBzZXQgZXJyb3IgZm9yIGtleSAke2tleX06YCwgZXJyb3IpXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDorrDlvZXorr/pl67mqKHlvI9cclxuICAgKiBcclxuICAgKiBAcGFyYW0ga2V5IC0g57yT5a2Y6ZSuXHJcbiAgICovXHJcbiAgcHJpdmF0ZSByZWNvcmRBY2Nlc3Moa2V5OiBzdHJpbmcpOiB2b2lkIHtcclxuICAgIGNvbnN0IG5vdyA9IERhdGUubm93KClcclxuICAgIGNvbnN0IHBhdHRlcm4gPSB0aGlzLmFjY2Vzc1BhdHRlcm5zLmdldChrZXkpIHx8IFtdXHJcbiAgICBcclxuICAgIHBhdHRlcm4ucHVzaChub3cpXHJcbiAgICBcclxuICAgIC8vIOWPquS/neeVmeacgOi/keeahOiuv+mXruiusOW9lVxyXG4gICAgY29uc3QgY3V0b2ZmID0gbm93IC0gdGhpcy5wcmVkaWN0aXZlQ29uZmlnLnByZWRpY3Rpb25XaW5kb3dcclxuICAgIGNvbnN0IHJlY2VudEFjY2Vzc2VzID0gcGF0dGVybi5maWx0ZXIodGltZSA9PiB0aW1lID4gY3V0b2ZmKVxyXG4gICAgXHJcbiAgICB0aGlzLmFjY2Vzc1BhdHRlcm5zLnNldChrZXksIHJlY2VudEFjY2Vzc2VzKVxyXG4gICAgXHJcbiAgICAvLyDliKTmlq3mmK/lkKbkuLrng63ngrnmlbDmja5cclxuICAgIGlmIChyZWNlbnRBY2Nlc3Nlcy5sZW5ndGggPiAxMCkge1xyXG4gICAgICB0aGlzLmhvdEtleXMuYWRkKGtleSlcclxuICAgIH0gZWxzZSBpZiAocmVjZW50QWNjZXNzZXMubGVuZ3RoIDwgMykge1xyXG4gICAgICB0aGlzLmhvdEtleXMuZGVsZXRlKGtleSlcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiusOW9leWRveS4rVxyXG4gICAqIFxyXG4gICAqIEBwYXJhbSBsZXZlbCAtIOe8k+WtmOWxgue6p1xyXG4gICAqL1xyXG4gIHByaXZhdGUgcmVjb3JkSGl0KGxldmVsOiBDYWNoZUxldmVsKTogdm9pZCB7XHJcbiAgICB0aGlzLnN0YXRzLmhpdHMrK1xyXG4gICAgdGhpcy5zdGF0cy5sZXZlbFN0YXRzW2xldmVsXS5oaXRzKytcclxuICAgIHRoaXMudXBkYXRlSGl0UmF0ZSgpXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDorrDlvZXmnKrlkb3kuK1cclxuICAgKi9cclxuICBwcml2YXRlIHJlY29yZE1pc3MoKTogdm9pZCB7XHJcbiAgICB0aGlzLnN0YXRzLm1pc3NlcysrXHJcbiAgICB0aGlzLnVwZGF0ZUhpdFJhdGUoKVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5pu05paw5ZG95Lit546HXHJcbiAgICovXHJcbiAgcHJpdmF0ZSB1cGRhdGVIaXRSYXRlKCk6IHZvaWQge1xyXG4gICAgdGhpcy5zdGF0cy5oaXRSYXRlID0gdGhpcy5zdGF0cy5oaXRzIC8gTWF0aC5tYXgoMSwgdGhpcy5zdGF0cy50b3RhbFJlcXVlc3RzKVxyXG4gICAgXHJcbiAgICBmb3IgKGNvbnN0IGxldmVsIG9mIE9iamVjdC52YWx1ZXMoQ2FjaGVMZXZlbCkpIHtcclxuICAgICAgY29uc3QgbGV2ZWxTdGF0cyA9IHRoaXMuc3RhdHMubGV2ZWxTdGF0c1tsZXZlbF1cclxuICAgICAgbGV2ZWxTdGF0cy5oaXRSYXRlID0gbGV2ZWxTdGF0cy5oaXRzIC8gTWF0aC5tYXgoMSwgbGV2ZWxTdGF0cy5yZXF1ZXN0cylcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOabtOaWsOWTjeW6lOaXtumXtFxyXG4gICAqIFxyXG4gICAqIEBwYXJhbSByZXNwb25zZVRpbWUgLSDlk43lupTml7bpl7RcclxuICAgKi9cclxuICBwcml2YXRlIHVwZGF0ZVJlc3BvbnNlVGltZShyZXNwb25zZVRpbWU6IG51bWJlcik6IHZvaWQge1xyXG4gICAgY29uc3QgdG90YWxUaW1lID0gdGhpcy5zdGF0cy5hdmdSZXNwb25zZVRpbWUgKiAodGhpcy5zdGF0cy50b3RhbFJlcXVlc3RzIC0gMSkgKyByZXNwb25zZVRpbWVcclxuICAgIHRoaXMuc3RhdHMuYXZnUmVzcG9uc2VUaW1lID0gdG90YWxUaW1lIC8gdGhpcy5zdGF0cy50b3RhbFJlcXVlc3RzXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDorqHnrpfmlbDmja7lpKflsI9cclxuICAgKiBcclxuICAgKiBAcGFyYW0gdmFsdWUgLSDmlbDmja7lgLxcclxuICAgKiBAcmV0dXJucyDmlbDmja7lpKflsI8oYnl0ZXMpXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBjYWxjdWxhdGVTaXplKHZhbHVlOiBhbnkpOiBudW1iZXIge1xyXG4gICAgdHJ5IHtcclxuICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHZhbHVlKS5sZW5ndGggKiAyIC8vIOeyl+eVpeS8sOeulyhVVEYtMTYpXHJcbiAgICB9IGNhdGNoIHtcclxuICAgICAgcmV0dXJuIDBcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiOt+WPlueJiOacrOWPt1xyXG4gICAqIFxyXG4gICAqIEBwYXJhbSBrZXkgLSDnvJPlrZjplK5cclxuICAgKiBAcmV0dXJucyDniYjmnKzlj7dcclxuICAgKi9cclxuICBwcml2YXRlIGdldFZlcnNpb24oa2V5OiBzdHJpbmcpOiBudW1iZXIge1xyXG4gICAgcmV0dXJuIHRoaXMua2V5VmVyc2lvbnMuZ2V0KGtleSkgfHwgMVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6YCS5aKe54mI5pys5Y+3XHJcbiAgICogXHJcbiAgICogQHBhcmFtIGtleSAtIOe8k+WtmOmUrlxyXG4gICAqIEByZXR1cm5zIOaWsOeJiOacrOWPt1xyXG4gICAqL1xyXG4gIHByaXZhdGUgaW5jcmVtZW50VmVyc2lvbihrZXk6IHN0cmluZyk6IG51bWJlciB7XHJcbiAgICBjb25zdCBjdXJyZW50VmVyc2lvbiA9IHRoaXMuZ2V0VmVyc2lvbihrZXkpXHJcbiAgICBjb25zdCBuZXdWZXJzaW9uID0gY3VycmVudFZlcnNpb24gKyAxXHJcbiAgICB0aGlzLmtleVZlcnNpb25zLnNldChrZXksIG5ld1ZlcnNpb24pXHJcbiAgICByZXR1cm4gbmV3VmVyc2lvblxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5aSE55CG5p+l6K+i5a6M5oiQ5LqL5Lu2XHJcbiAgICogXHJcbiAgICogQHBhcmFtIHN0YXRzIC0g5p+l6K+i57uf6K6hXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBoYW5kbGVRdWVyeUNvbXBsZXRlZChzdGF0czogYW55KTogdm9pZCB7XHJcbiAgICAvLyDln7rkuo7mn6Xor6Lnu5/orqHov5vooYzpooTmtYvmgKfliqDovb1cclxuICAgIGlmICh0aGlzLnByZWRpY3RpdmVDb25maWcuZW5hYmxlZCAmJiBzdGF0cy5zdWNjZXNzKSB7XHJcbiAgICAgIHRoaXMucGVyZm9ybVByZWRpY3RpdmVMb2FkaW5nKHN0YXRzKVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5aSE55CG5pWw5o2u5bqT5oyH5qCHXHJcbiAgICogXHJcbiAgICogQHBhcmFtIG1ldHJpY3MgLSDmlbDmja7lupPmjIfmoIdcclxuICAgKi9cclxuICBwcml2YXRlIGhhbmRsZURhdGFiYXNlTWV0cmljcyhtZXRyaWNzOiBhbnkpOiB2b2lkIHtcclxuICAgIC8vIOagueaNruaVsOaNruW6k+i0n+i9veiwg+aVtOe8k+WtmOetlueVpVxyXG4gICAgaWYgKG1ldHJpY3MuY3B1VXNhZ2UgPiA4MCkge1xyXG4gICAgICAvLyDpq5hDUFXkvb/nlKjnjofml7bvvIzlop7liqDnvJPlrZhUVExcclxuICAgICAgdGhpcy5hZGp1c3RDYWNoZVRUTCgxLjUpXHJcbiAgICB9IGVsc2UgaWYgKG1ldHJpY3MuY3B1VXNhZ2UgPCAzMCkge1xyXG4gICAgICAvLyDkvY5DUFXkvb/nlKjnjofml7bvvIzlh4/lsJHnvJPlrZhUVExcclxuICAgICAgdGhpcy5hZGp1c3RDYWNoZVRUTCgwLjgpXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmiafooYzpooTmtYvmgKfliqDovb1cclxuICAgKiBcclxuICAgKiBAcGFyYW0gc3RhdHMgLSDmn6Xor6Lnu5/orqFcclxuICAgKi9cclxuICBwcml2YXRlIHBlcmZvcm1QcmVkaWN0aXZlTG9hZGluZyhzdGF0czogYW55KTogdm9pZCB7XHJcbiAgICAvLyDov5nph4zlrp7njrDpooTmtYvmgKfliqDovb3pgLvovpFcclxuICAgIC8vIOWfuuS6juiuv+mXruaooeW8j+mihOa1i+WPr+iDvemcgOimgeeahOaVsOaNrlxyXG4gICAgY29uc3QgcmVsYXRlZEtleXMgPSB0aGlzLnByZWRpY3RSZWxhdGVkS2V5cyhzdGF0cylcclxuICAgIFxyXG4gICAgcmVsYXRlZEtleXMuZm9yRWFjaChhc3luYyAoa2V5KSA9PiB7XHJcbiAgICAgIGlmICghdGhpcy5sMUNhY2hlLmhhcyhrZXkpICYmICFhd2FpdCB0aGlzLmhhc0luTDIoa2V5KSkge1xyXG4gICAgICAgIC8vIOmihOWKoOi9veaVsOaNrlxyXG4gICAgICAgIHRoaXMuZW1pdCgncHJlZGljdGl2ZS1sb2FkLW5lZWRlZCcsIHsga2V5LCBzdGF0cyB9KVxyXG4gICAgICB9XHJcbiAgICB9KVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6aKE5rWL55u45YWz6ZSuXHJcbiAgICogXHJcbiAgICogQHBhcmFtIHN0YXRzIC0g5p+l6K+i57uf6K6hXHJcbiAgICogQHJldHVybnMg55u45YWz6ZSu5pWw57uEXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBwcmVkaWN0UmVsYXRlZEtleXMoc3RhdHM6IGFueSk6IHN0cmluZ1tdIHtcclxuICAgIC8vIOeugOWNleeahOmihOa1i+mAu+i+ke+8jOWunumZheW6lOeUqOS4reWPr+S7peS9v+eUqOabtOWkjeadgueahOeul+azlVxyXG4gICAgY29uc3QgcmVsYXRlZEtleXM6IHN0cmluZ1tdID0gW11cclxuICAgIFxyXG4gICAgaWYgKHN0YXRzLnRhYmxlcykge1xyXG4gICAgICBzdGF0cy50YWJsZXMuZm9yRWFjaCgodGFibGU6IHN0cmluZykgPT4ge1xyXG4gICAgICAgIC8vIOmihOa1i+WQjOihqOeahOWFtuS7luW4uOeUqOafpeivolxyXG4gICAgICAgIHJlbGF0ZWRLZXlzLnB1c2goYCR7dGFibGV9OnBvcHVsYXJfcXVlcmllc2ApXHJcbiAgICAgICAgcmVsYXRlZEtleXMucHVzaChgJHt0YWJsZX06cmVjZW50X2RhdGFgKVxyXG4gICAgICB9KVxyXG4gICAgfVxyXG4gICAgXHJcbiAgICByZXR1cm4gcmVsYXRlZEtleXNcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOajgOafpUwy57yT5a2Y5Lit5piv5ZCm5a2Y5ZyoXHJcbiAgICogXHJcbiAgICogQHBhcmFtIGtleSAtIOe8k+WtmOmUrlxyXG4gICAqIEByZXR1cm5zIOaYr+WQpuWtmOWcqFxyXG4gICAqL1xyXG4gIHByaXZhdGUgYXN5bmMgaGFzSW5MMihrZXk6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xyXG4gICAgaWYgKCF0aGlzLmwyQ2FjaGUpIHtcclxuICAgICAgcmV0dXJuIGZhbHNlXHJcbiAgICB9XHJcbiAgICBcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IGV4aXN0cyA9IGF3YWl0IHRoaXMubDJDYWNoZS5leGlzdHMoa2V5KVxyXG4gICAgICByZXR1cm4gZXhpc3RzID09PSAxXHJcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XHJcbiAgICAgIHJldHVybiBmYWxzZVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6LCD5pW057yT5a2YVFRMXHJcbiAgICogXHJcbiAgICogQHBhcmFtIGZhY3RvciAtIOiwg+aVtOWboOWtkFxyXG4gICAqL1xyXG4gIHByaXZhdGUgYWRqdXN0Q2FjaGVUVEwoZmFjdG9yOiBudW1iZXIpOiB2b2lkIHtcclxuICAgIC8vIOWKqOaAgeiwg+aVtOe8k+WtmFRUTFxyXG4gICAgY29uc3QgbmV3TDFUVEwgPSBNYXRoLm1heCg2MDAwMCwgdGhpcy5jb25maWcubDEudHRsICogZmFjdG9yKSAvLyDmnIDlsJEx5YiG6ZKfXHJcbiAgICBjb25zdCBuZXdMMlRUTCA9IE1hdGgubWF4KDMwMDAwMCwgdGhpcy5jb25maWcubDIudHRsICogZmFjdG9yKSAvLyDmnIDlsJE15YiG6ZKfXHJcbiAgICBcclxuICAgIHRoaXMuY29uZmlnLmwxLnR0bCA9IG5ld0wxVFRMXHJcbiAgICB0aGlzLmNvbmZpZy5sMi50dGwgPSBuZXdMMlRUTFxyXG4gICAgXHJcbiAgICBjb25zb2xlLmxvZyhgQWRqdXN0ZWQgY2FjaGUgVFRMOiBMMT0ke25ld0wxVFRMfW1zLCBMMj0ke25ld0wyVFRMfW1zYClcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaUtumbhuaMh+agh1xyXG4gICAqL1xyXG4gIHByaXZhdGUgY29sbGVjdE1ldHJpY3MoKTogdm9pZCB7XHJcbiAgICAvLyDmm7TmlrBMMee8k+WtmOe7n+iuoVxyXG4gICAgdGhpcy5zdGF0cy5sZXZlbFN0YXRzW0NhY2hlTGV2ZWwuTDFdLnNpemUgPSB0aGlzLmwxQ2FjaGUuc2l6ZVxyXG4gICAgdGhpcy5zdGF0cy5sZXZlbFN0YXRzW0NhY2hlTGV2ZWwuTDFdLm1lbW9yeVVzYWdlID0gdGhpcy5jYWxjdWxhdGVMMU1lbW9yeVVzYWdlKClcclxuICAgIFxyXG4gICAgLy8g5Y+R6YCB5oyH5qCH5LqL5Lu2XHJcbiAgICB0aGlzLmVtaXQoJ21ldHJpY3MtY29sbGVjdGVkJywgdGhpcy5zdGF0cylcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiuoeeul0wx57yT5a2Y5YaF5a2Y5L2/55SoXHJcbiAgICogXHJcbiAgICogQHJldHVybnMg5YaF5a2Y5L2/55So6YePKGJ5dGVzKVxyXG4gICAqL1xyXG4gIHByaXZhdGUgY2FsY3VsYXRlTDFNZW1vcnlVc2FnZSgpOiBudW1iZXIge1xyXG4gICAgbGV0IHRvdGFsU2l6ZSA9IDBcclxuICAgIGZvciAoY29uc3QgaXRlbSBvZiB0aGlzLmwxQ2FjaGUudmFsdWVzKCkpIHtcclxuICAgICAgaWYgKGl0ZW0pIHtcclxuICAgICAgICB0b3RhbFNpemUgKz0gaXRlbS5zaXplXHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiB0b3RhbFNpemVcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOajgOafpeWRiuitplxyXG4gICAqL1xyXG4gIHByaXZhdGUgY2hlY2tBbGVydHMoKTogdm9pZCB7XHJcbiAgICBjb25zdCB0aHJlc2hvbGRzID0gdGhpcy5jb25maWcubW9uaXRvcmluZy5hbGVydFRocmVzaG9sZHNcclxuICAgIFxyXG4gICAgLy8g5qOA5p+l5ZG95Lit546HXHJcbiAgICBpZiAodGhpcy5zdGF0cy5oaXRSYXRlIDwgdGhyZXNob2xkcy5oaXRSYXRlTWluKSB7XHJcbiAgICAgIHRoaXMuZW1pdCgnYWxlcnQnLCB7XHJcbiAgICAgICAgdHlwZTogJ2xvdy1oaXQtcmF0ZScsXHJcbiAgICAgICAgbWVzc2FnZTogYENhY2hlIGhpdCByYXRlIGlzIGJlbG93IHRocmVzaG9sZDogJHt0aGlzLnN0YXRzLmhpdFJhdGUudG9GaXhlZCgyKX0gPCAke3RocmVzaG9sZHMuaGl0UmF0ZU1pbn1gLFxyXG4gICAgICAgIHNldmVyaXR5OiAnd2FybmluZydcclxuICAgICAgfSlcclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8g5qOA5p+l5YaF5a2Y5L2/55SoXHJcbiAgICBjb25zdCBtZW1vcnlVc2FnZSA9IHRoaXMuY2FsY3VsYXRlTDFNZW1vcnlVc2FnZSgpXHJcbiAgICBjb25zdCBtYXhNZW1vcnkgPSB0aGlzLmNvbmZpZy5sMS5tYXhTaXplICogMTAyNCAvLyDlgYforr7mr4/pobnlubPlnYcxS0JcclxuICAgIGlmIChtZW1vcnlVc2FnZSAvIG1heE1lbW9yeSA+IHRocmVzaG9sZHMubWVtb3J5VXNhZ2VNYXgpIHtcclxuICAgICAgdGhpcy5lbWl0KCdhbGVydCcsIHtcclxuICAgICAgICB0eXBlOiAnaGlnaC1tZW1vcnktdXNhZ2UnLFxyXG4gICAgICAgIG1lc3NhZ2U6IGBDYWNoZSBtZW1vcnkgdXNhZ2UgaXMgYWJvdmUgdGhyZXNob2xkOiAkeyhtZW1vcnlVc2FnZSAvIG1heE1lbW9yeSAqIDEwMCkudG9GaXhlZCgyKX0lID4gJHt0aHJlc2hvbGRzLm1lbW9yeVVzYWdlTWF4ICogMTAwfSVgLFxyXG4gICAgICAgIHNldmVyaXR5OiAnd2FybmluZydcclxuICAgICAgfSlcclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8g5qOA5p+l5ZON5bqU5pe26Ze0XHJcbiAgICBpZiAodGhpcy5zdGF0cy5hdmdSZXNwb25zZVRpbWUgPiB0aHJlc2hvbGRzLmxhdGVuY3lNYXgpIHtcclxuICAgICAgdGhpcy5lbWl0KCdhbGVydCcsIHtcclxuICAgICAgICB0eXBlOiAnaGlnaC1sYXRlbmN5JyxcclxuICAgICAgICBtZXNzYWdlOiBgQ2FjaGUgYXZlcmFnZSByZXNwb25zZSB0aW1lIGlzIGFib3ZlIHRocmVzaG9sZDogJHt0aGlzLnN0YXRzLmF2Z1Jlc3BvbnNlVGltZS50b0ZpeGVkKDIpfW1zID4gJHt0aHJlc2hvbGRzLmxhdGVuY3lNYXh9bXNgLFxyXG4gICAgICAgIHNldmVyaXR5OiAnd2FybmluZydcclxuICAgICAgfSlcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOS8mOWMlue8k+WtmFxyXG4gICAqL1xyXG4gIHByaXZhdGUgb3B0aW1pemVDYWNoZSgpOiB2b2lkIHtcclxuICAgIC8vIOa4heeQhui/h+acn+aVsOaNrlxyXG4gICAgdGhpcy5jbGVhbnVwRXhwaXJlZEl0ZW1zKClcclxuICAgIFxyXG4gICAgLy8g5LyY5YyW54Ot54K55pWw5o2uXHJcbiAgICB0aGlzLm9wdGltaXplSG90RGF0YSgpXHJcbiAgICBcclxuICAgIC8vIOiwg+aVtOe8k+WtmOetlueVpVxyXG4gICAgdGhpcy5hZGp1c3RDYWNoZVN0cmF0ZWd5KClcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOa4heeQhui/h+acn+mhuVxyXG4gICAqL1xyXG4gIHByaXZhdGUgY2xlYW51cEV4cGlyZWRJdGVtcygpOiB2b2lkIHtcclxuICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKClcclxuICAgIGNvbnN0IGV4cGlyZWRLZXlzOiBzdHJpbmdbXSA9IFtdXHJcbiAgICBcclxuICAgIGZvciAoY29uc3QgW2tleSwgaXRlbV0gb2YgdGhpcy5sMUNhY2hlLmVudHJpZXMoKSkge1xyXG4gICAgICBpZiAoaXRlbSAmJiBuZXcgRGF0ZShpdGVtLmV4cGlyZXNBdCkgPCBub3cpIHtcclxuICAgICAgICBleHBpcmVkS2V5cy5wdXNoKGtleSlcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgXHJcbiAgICBleHBpcmVkS2V5cy5mb3JFYWNoKGtleSA9PiB7XHJcbiAgICAgIHRoaXMubDFDYWNoZS5kZWxldGUoa2V5KVxyXG4gICAgICB0aGlzLnN0YXRzLmV2aWN0aW9ucysrXHJcbiAgICB9KVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5LyY5YyW54Ot54K55pWw5o2uXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBvcHRpbWl6ZUhvdERhdGEoKTogdm9pZCB7XHJcbiAgICAvLyDlsIbng63ngrnmlbDmja7nmoRUVEzlu7bplb9cclxuICAgIGZvciAoY29uc3QgaG90S2V5IG9mIHRoaXMuaG90S2V5cykge1xyXG4gICAgICBjb25zdCBpdGVtID0gdGhpcy5sMUNhY2hlLmdldChob3RLZXkpXHJcbiAgICAgIGlmIChpdGVtKSB7XHJcbiAgICAgICAgY29uc3QgZXh0ZW5kZWRUVEwgPSB0aGlzLmNvbmZpZy5sMS50dGwgKiAyXHJcbiAgICAgICAgaXRlbS5leHBpcmVzQXQgPSBuZXcgRGF0ZShEYXRlLm5vdygpICsgZXh0ZW5kZWRUVEwpXHJcbiAgICAgICAgdGhpcy5sMUNhY2hlLnNldChob3RLZXksIGl0ZW0sIHsgdHRsOiBleHRlbmRlZFRUTCB9KVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDosIPmlbTnvJPlrZjnrZbnlaVcclxuICAgKi9cclxuICBwcml2YXRlIGFkanVzdENhY2hlU3RyYXRlZ3koKTogdm9pZCB7XHJcbiAgICAvLyDmoLnmja7lkb3kuK3njofosIPmlbTnrZbnlaVcclxuICAgIGlmICh0aGlzLnN0YXRzLmhpdFJhdGUgPCAwLjUpIHtcclxuICAgICAgLy8g5ZG95Lit546H5L2O77yM5aKe5Yqg57yT5a2Y5aSn5bCPXHJcbiAgICAgIGlmICh0aGlzLmwxQ2FjaGUubWF4IDwgMjAwMCkge1xyXG4gICAgICAgIHRoaXMubDFDYWNoZS5yZXNpemUodGhpcy5sMUNhY2hlLm1heCAqIDEuMilcclxuICAgICAgICBjb25zb2xlLmxvZyhgSW5jcmVhc2VkIEwxIGNhY2hlIHNpemUgdG8gJHt0aGlzLmwxQ2FjaGUubWF4fWApXHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSBpZiAodGhpcy5zdGF0cy5oaXRSYXRlID4gMC45KSB7XHJcbiAgICAgIC8vIOWRveS4reeOh+mrmO+8jOWPr+S7pemAguW9k+WHj+Wwkee8k+WtmOWkp+Wwj1xyXG4gICAgICBpZiAodGhpcy5sMUNhY2hlLm1heCA+IDUwMCkge1xyXG4gICAgICAgIHRoaXMubDFDYWNoZS5yZXNpemUodGhpcy5sMUNhY2hlLm1heCAqIDAuOSlcclxuICAgICAgICBjb25zb2xlLmxvZyhgRGVjcmVhc2VkIEwxIGNhY2hlIHNpemUgdG8gJHt0aGlzLmwxQ2FjaGUubWF4fWApXHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaJp+ihjOe8k+WtmOmihOeDrVxyXG4gICAqL1xyXG4gIHByaXZhdGUgYXN5bmMgcGVyZm9ybVdhcm11cCgpOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIGNvbnNvbGUubG9nKCdQZXJmb3JtaW5nIGNhY2hlIHdhcm11cC4uLicpXHJcbiAgICBcclxuICAgIGNvbnN0IHdhcm11cFF1ZXJpZXMgPSB0aGlzLmNvbmZpZy53YXJtdXAucXVlcmllc1xyXG4gICAgXHJcbiAgICBmb3IgKGNvbnN0IHF1ZXJ5IG9mIHdhcm11cFF1ZXJpZXMpIHtcclxuICAgICAgdHJ5IHtcclxuICAgICAgICAvLyDov5nph4zpnIDopoHlrp7pmYXmiafooYzmn6Xor6LlubbnvJPlrZjnu5PmnpxcclxuICAgICAgICAvLyBhd2FpdCB0aGlzLmV4ZWN1dGVBbmRDYWNoZShxdWVyeSlcclxuICAgICAgICBjb25zb2xlLmxvZyhgV2FybWVkIHVwIHF1ZXJ5OiAke3F1ZXJ5fWApXHJcbiAgICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGBXYXJtdXAgZmFpbGVkIGZvciBxdWVyeSAke3F1ZXJ5fTpgLCBlcnJvcilcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgXHJcbiAgICB0aGlzLmVtaXQoJ3dhcm11cC1jb21wbGV0ZWQnLCB7IHF1ZXJpZXM6IHdhcm11cFF1ZXJpZXMubGVuZ3RoIH0pXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDojrflj5bnvJPlrZjnu5/orqFcclxuICAgKiBcclxuICAgKiBAcmV0dXJucyDnvJPlrZjnu5/orqFcclxuICAgKi9cclxuICBnZXRTdGF0cygpOiBDYWNoZVN0YXRzIHtcclxuICAgIHJldHVybiB7IC4uLnRoaXMuc3RhdHMgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6I635Y+W54Ot54K56ZSuXHJcbiAgICogXHJcbiAgICogQHJldHVybnMg54Ot54K56ZSu5pWw57uEXHJcbiAgICovXHJcbiAgZ2V0SG90S2V5cygpOiBzdHJpbmdbXSB7XHJcbiAgICByZXR1cm4gQXJyYXkuZnJvbSh0aGlzLmhvdEtleXMpXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDojrflj5bnvJPlrZjphY3nva5cclxuICAgKiBcclxuICAgKiBAcmV0dXJucyDnvJPlrZjphY3nva5cclxuICAgKi9cclxuICBnZXRDb25maWcoKTogQ2FjaGVDb25maWcge1xyXG4gICAgcmV0dXJuIHsgLi4udGhpcy5jb25maWcgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5pu05paw57yT5a2Y6YWN572uXHJcbiAgICogXHJcbiAgICogQHBhcmFtIG5ld0NvbmZpZyAtIOaWsOmFjee9rlxyXG4gICAqL1xyXG4gIHVwZGF0ZUNvbmZpZyhuZXdDb25maWc6IFBhcnRpYWw8Q2FjaGVDb25maWc+KTogdm9pZCB7XHJcbiAgICB0aGlzLmNvbmZpZyA9IHRoaXMubWVyZ2VDb25maWcobmV3Q29uZmlnKVxyXG4gICAgY29uc29sZS5sb2coJ0NhY2hlIGNvbmZpZ3VyYXRpb24gdXBkYXRlZCcpXHJcbiAgICB0aGlzLmVtaXQoJ2NvbmZpZy11cGRhdGVkJywgdGhpcy5jb25maWcpXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmuIXnqbrmiYDmnInnvJPlrZhcclxuICAgKi9cclxuICBhc3luYyBjbGVhckFsbCgpOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIC8vIOa4heepukwx57yT5a2YXHJcbiAgICB0aGlzLmwxQ2FjaGUuY2xlYXIoKVxyXG4gICAgXHJcbiAgICAvLyDmuIXnqbpMMue8k+WtmFxyXG4gICAgaWYgKHRoaXMuY29uZmlnLmwyLmVuYWJsZWQgJiYgdGhpcy5sMkNhY2hlKSB7XHJcbiAgICAgIGF3YWl0IHRoaXMubDJDYWNoZS5mbHVzaGRiKClcclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8g6YeN572u57uf6K6hXHJcbiAgICB0aGlzLnN0YXRzID0gdGhpcy5pbml0aWFsaXplU3RhdHMoKVxyXG4gICAgXHJcbiAgICAvLyDmuIXnqbrovoXliqnmlbDmja5cclxuICAgIHRoaXMuYWNjZXNzUGF0dGVybnMuY2xlYXIoKVxyXG4gICAgdGhpcy5ob3RLZXlzLmNsZWFyKClcclxuICAgIHRoaXMua2V5VmVyc2lvbnMuY2xlYXIoKVxyXG4gICAgXHJcbiAgICBjb25zb2xlLmxvZygnQWxsIGNhY2hlcyBjbGVhcmVkJylcclxuICAgIHRoaXMuZW1pdCgnY2FjaGUtY2xlYXJlZCcpXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDnlJ/miJDnvJPlrZjmiqXlkYpcclxuICAgKiBcclxuICAgKiBAcmV0dXJucyDnvJPlrZjmiqXlkYpcclxuICAgKi9cclxuICBnZW5lcmF0ZVJlcG9ydCgpOiB7XHJcbiAgICBzdW1tYXJ5OiBzdHJpbmdcclxuICAgIHBlcmZvcm1hbmNlOiBhbnlcclxuICAgIHJlY29tbWVuZGF0aW9uczogc3RyaW5nW11cclxuICB9IHtcclxuICAgIGNvbnN0IHJlY29tbWVuZGF0aW9uczogc3RyaW5nW10gPSBbXVxyXG4gICAgXHJcbiAgICBpZiAodGhpcy5zdGF0cy5oaXRSYXRlIDwgMC43KSB7XHJcbiAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKCfnvJPlrZjlkb3kuK3njofovoPkvY7vvIzlu7rorq7mo4Dmn6XnvJPlrZjnrZbnlaXlkoxUVEzorr7nva4nKVxyXG4gICAgfVxyXG4gICAgXHJcbiAgICBpZiAodGhpcy5zdGF0cy5hdmdSZXNwb25zZVRpbWUgPiA1MCkge1xyXG4gICAgICByZWNvbW1lbmRhdGlvbnMucHVzaCgn57yT5a2Y5ZON5bqU5pe26Ze06L6D6auY77yM5bu66K6u5LyY5YyW57yT5a2Y5bGC57qn5oiW5aKe5Yqg5YaF5a2YJylcclxuICAgIH1cclxuICAgIFxyXG4gICAgaWYgKHRoaXMuaG90S2V5cy5zaXplID4gMTAwKSB7XHJcbiAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKCfng63ngrnmlbDmja7ovoPlpJrvvIzlu7rorq7ogIPomZHliIbniYfmiJbkuJPnlKjnvJPlrZgnKVxyXG4gICAgfVxyXG4gICAgXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdW1tYXJ5OiBgXHJcbuaZuuiDvee8k+WtmOeuoeeQhuaKpeWRilxyXG49PT09PT09PT09PT09PT09XHJcbueUn+aIkOaXtumXtDogJHtuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCl9XHJcbuaAu+ivt+axguaVsDogJHt0aGlzLnN0YXRzLnRvdGFsUmVxdWVzdHN9XHJcbuWRveS4reeOhzogJHsodGhpcy5zdGF0cy5oaXRSYXRlICogMTAwKS50b0ZpeGVkKDIpfSVcclxu5bmz5Z2H5ZON5bqU5pe26Ze0OiAke3RoaXMuc3RhdHMuYXZnUmVzcG9uc2VUaW1lLnRvRml4ZWQoMil9bXNcclxuTDHnvJPlrZjlpKflsI86ICR7dGhpcy5zdGF0cy5sZXZlbFN0YXRzW0NhY2hlTGV2ZWwuTDFdLnNpemV9XHJcbkwy57yT5a2Y5ZCv55SoOiAke3RoaXMuY29uZmlnLmwyLmVuYWJsZWQgPyAn5pivJyA6ICflkKYnfVxyXG7ng63ngrnmlbDmja46ICR7dGhpcy5ob3RLZXlzLnNpemV9IOS4qlxyXG7plJnor6/mrKHmlbA6ICR7dGhpcy5zdGF0cy5lcnJvcnN9XHJcbiAgICAgIGAudHJpbSgpLFxyXG4gICAgICBwZXJmb3JtYW5jZToge1xyXG4gICAgICAgIGhpdFJhdGU6IHRoaXMuc3RhdHMuaGl0UmF0ZSxcclxuICAgICAgICBhdmdSZXNwb25zZVRpbWU6IHRoaXMuc3RhdHMuYXZnUmVzcG9uc2VUaW1lLFxyXG4gICAgICAgIGxldmVsU3RhdHM6IHRoaXMuc3RhdHMubGV2ZWxTdGF0cyxcclxuICAgICAgICBob3RLZXlzQ291bnQ6IHRoaXMuaG90S2V5cy5zaXplLFxyXG4gICAgICAgIGVycm9yUmF0ZTogdGhpcy5zdGF0cy5lcnJvcnMgLyBNYXRoLm1heCgxLCB0aGlzLnN0YXRzLnRvdGFsUmVxdWVzdHMpXHJcbiAgICAgIH0sXHJcbiAgICAgIHJlY29tbWVuZGF0aW9uc1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxuLy8g5Yib5bu65YWo5bGA5a6e5L6LXHJcbmV4cG9ydCBjb25zdCBpbnRlbGxpZ2VudENhY2hlTWFuYWdlciA9IG5ldyBJbnRlbGxpZ2VudENhY2hlTWFuYWdlcigpXHJcblxyXG4vLyDlr7zlh7rnsbvlnotcclxuZXhwb3J0IHR5cGUge1xyXG4gIENhY2hlQ29uZmlnLFxyXG4gIENhY2hlSXRlbSxcclxuICBDYWNoZVN0YXRzLFxyXG4gIENhY2hlRXZlbnQsXHJcbiAgUHJlZGljdGl2ZUxvYWRDb25maWdcclxufVxyXG5cclxuZXhwb3J0IHsgQ2FjaGVMZXZlbCwgQ2FjaGVTdHJhdGVneSB9Il0sInZlcnNpb24iOjN9