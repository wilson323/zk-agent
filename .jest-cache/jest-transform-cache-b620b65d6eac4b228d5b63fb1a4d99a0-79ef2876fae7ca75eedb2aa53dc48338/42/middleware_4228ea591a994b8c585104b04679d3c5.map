{"version":3,"names":["cov_wrci3z7jp","actualCoverage","s","AgUIMiddlewareManager","constructor","f","middlewares","Map","initialized","register","middleware","has","name","b","Error","set","initialize","unregister","get","dispose","delete","values","processEvent","event","processedEvent","onEvent","result","processMessage","message","processedMessage","onMessage","processRun","input","processedInput","onRun","processError","error","context","processedError","onError","clear","exports","LoggingMiddleware","options","version","debug","console","type","PerformanceMiddleware","metrics","runId","start","Date","now","metric","end","duration","info","getMetrics","entries","SecurityMiddleware","maxMessageLength","content","length","allowedTools","filteredTools","tools","filter","tool","includes","function"],"sources":["E:\\zk-agent\\lib\\ag-ui\\protocol\\middleware.ts"],"sourcesContent":["// @ts-nocheck\nimport type { AgUIEvent, Message, RunInput } from \"./types\"\n\n/**\n * AG-UI中间件接口\n * 用于扩展和自定义协议行为\n */\nexport interface AgUIMiddleware {\n  name: string\n  version: string\n\n  // 事件中间件\n  onEvent?(event: AgUIEvent): AgUIEvent | null\n\n  // 消息中间件\n  onMessage?(message: Message): Message | null\n\n  // 运行中间件\n  onRun?(input: RunInput): RunInput | Promise<RunInput>\n\n  // 错误中间件\n  onError?(error: Error, context: any): Error | null\n\n  // 初始化和清理\n  initialize?(): Promise<void> | void\n  dispose?(): Promise<void> | void\n}\n\n/**\n * AG-UI中间件管理器\n */\nexport class AgUIMiddlewareManager {\n  private middlewares: Map<string, AgUIMiddleware> = new Map()\n  private initialized = false\n\n  /**\n   * 注册中间件\n   */\n  register(middleware: AgUIMiddleware): void {\n    if (this.middlewares.has(middleware.name)) {\n      throw new Error(`Middleware ${middleware.name} already registered`)\n    }\n\n    this.middlewares.set(middleware.name, middleware)\n\n    if (this.initialized && middleware.initialize) {\n      middleware.initialize()\n    }\n  }\n\n  /**\n   * 注销中间件\n   */\n  unregister(name: string): boolean {\n    const middleware = this.middlewares.get(name)\n    if (middleware) {\n      if (middleware.dispose) {\n        middleware.dispose()\n      }\n      return this.middlewares.delete(name)\n    }\n    return false\n  }\n\n  /**\n   * 初始化所有中间件\n   */\n  async initialize(): Promise<void> {\n    for (const middleware of this.middlewares.values()) {\n      if (middleware.initialize) {\n        await middleware.initialize()\n      }\n    }\n    this.initialized = true\n  }\n\n  /**\n   * 处理事件\n   */\n  processEvent(event: AgUIEvent): AgUIEvent | null {\n    let processedEvent = event\n\n    for (const middleware of this.middlewares.values()) {\n      if (middleware.onEvent) {\n        const result = middleware.onEvent(processedEvent)\n        if (result === null) {\n          return null // 中间件决定丢弃事件\n        }\n        processedEvent = result\n      }\n    }\n\n    return processedEvent\n  }\n\n  /**\n   * 处理消息\n   */\n  processMessage(message: Message): Message | null {\n    let processedMessage = message\n\n    for (const middleware of this.middlewares.values()) {\n      if (middleware.onMessage) {\n        const result = middleware.onMessage(processedMessage)\n        if (result === null) {\n          return null\n        }\n        processedMessage = result\n      }\n    }\n\n    return processedMessage\n  }\n\n  /**\n   * 处理运行输入\n   */\n  async processRun(input: RunInput): Promise<RunInput> {\n    let processedInput = input\n\n    for (const middleware of this.middlewares.values()) {\n      if (middleware.onRun) {\n        processedInput = await middleware.onRun(processedInput)\n      }\n    }\n\n    return processedInput\n  }\n\n  /**\n   * 处理错误\n   */\n  processError(error: Error, context: any): Error | null {\n    let processedError = error\n\n    for (const middleware of this.middlewares.values()) {\n      if (middleware.onError) {\n        const result = middleware.onError(processedError, context)\n        if (result === null) {\n          return null // 中间件决定忽略错误\n        }\n        processedError = result\n      }\n    }\n\n    return processedError\n  }\n\n  /**\n   * 清理所有中间件\n   */\n  async dispose(): Promise<void> {\n    for (const middleware of this.middlewares.values()) {\n      if (middleware.dispose) {\n        await middleware.dispose()\n      }\n    }\n    this.middlewares.clear()\n    this.initialized = false\n  }\n}\n\n/**\n * 内置中间件：日志记录\n */\nexport class LoggingMiddleware implements AgUIMiddleware {\n  name = \"logging\"\n  version = \"1.0.0\"\n\n  constructor(private options: { debug?: boolean; logLevel?: \"info\" | \"debug\" | \"error\" } = {}) {}\n\n  onEvent(event: AgUIEvent): AgUIEvent {\n    if (this.options.debug) {\n      console.debug(`[AG-UI Event] ${event.type}:`, event)\n    }\n    return event\n  }\n\n  onError(error: Error, context: any): Error {\n    console.error(`[AG-UI Error] ${error.message}:`, { error, context })\n    return error\n  }\n}\n\n/**\n * 内置中间件：性能监控\n */\nexport class PerformanceMiddleware implements AgUIMiddleware {\n  name = \"performance\"\n  version = \"1.0.0\"\n\n  private metrics: Map<string, { start: number; end?: number }> = new Map()\n\n  onEvent(event: AgUIEvent): AgUIEvent {\n    switch (event.type) {\n      case \"run-started\":\n        this.metrics.set((event as any).runId, { start: Date.now() })\n        break\n      case \"run-finished\":\n      case \"run-error\":\n        const metric = this.metrics.get((event as any).runId)\n        if (metric) {\n          metric.end = Date.now()\n          const duration = metric.end - metric.start\n          console.info(`[AG-UI Performance] Run ${(event as any).runId} took ${duration}ms`)\n        }\n        break\n    }\n    return event\n  }\n\n  getMetrics(): Record<string, number> {\n    const result: Record<string, number> = {}\n    for (const [runId, metric] of this.metrics.entries()) {\n      if (metric.end) {\n        result[runId] = metric.end - metric.start\n      }\n    }\n    return result\n  }\n}\n\n/**\n * 内置中间件：安全验证\n */\nexport class SecurityMiddleware implements AgUIMiddleware {\n  name = \"security\"\n  version = \"1.0.0\"\n\n  constructor(\n    private options: {\n      allowedTools?: string[]\n      maxMessageLength?: number\n      rateLimitPerMinute?: number\n    } = {},\n  ) {}\n\n  onMessage(message: Message): Message | null {\n    // 检查消息长度\n    if (\n      this.options.maxMessageLength &&\n      typeof message.content === \"string\" &&\n      message.content.length > this.options.maxMessageLength\n    ) {\n      throw new Error(`Message too long: ${message.content.length} > ${this.options.maxMessageLength}`)\n    }\n\n    return message\n  }\n\n  onRun(input: RunInput): RunInput {\n    // 检查工具权限\n    if (this.options.allowedTools) {\n      const filteredTools = input.tools.filter((tool) => this.options.allowedTools!.includes(tool.function.name))\n      return { ...input, tools: filteredTools }\n    }\n\n    return input\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}