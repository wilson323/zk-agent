{"version":3,"names":["nextJest","require","path","createJestConfig","dir","experimental","forceSwcTransforms","customJestConfig","setupFilesAfterEnv","preset","undefined","testEnvironment","testMatch","testPathIgnorePatterns","collectCoverage","collectCoverageFrom","moduleNameMapper","transformIgnorePatterns","moduleFileExtensions","testTimeout","maxWorkers","verbose","silent","bail","forceExit","detectOpenHandles","clearMocks","restoreMocks","resetMocks","globals","reporters","outputDirectory","outputName","classNameTemplate","titleTemplate","ancestorSeparator","usePathForSuiteName","coverageReporters","coverageDirectory","coverageThreshold","global","branches","functions","lines","statements","cacheDirectory","errorOnDeprecated","resolver","module","exports"],"sources":["jest.config.fixed.js"],"sourcesContent":["/**\n * @file jest.config.fixed.js\n * @description Fixed Jest configuration - Resolves infinite loop and dependency issues\n * @author Jest Fix Team\n * @lastUpdate 2024-12-19\n */\n\nconst nextJest = require('next/jest');\nconst path = require('path');\n\n// Create Jest configuration with Next.js integration\nconst createJestConfig = nextJest({\n  // Provide the path to your Next.js app to load next.config.js and .env files\n  dir: './',\n  // Disable SWC for better compatibility\n  experimental: {\n    forceSwcTransforms: false,\n  },\n});\n\n// Add any custom config to be passed to Jest\nconst customJestConfig = {\n  // Use fixed setup file\n  setupFilesAfterEnv: ['<rootDir>/jest.setup.fixed.js'],\n  \n  // TypeScript configuration for Jest\n  preset: undefined, // Let Next.js handle the preset\n  \n  // 测试环境\n  testEnvironment: 'jsdom',\n  \n  // 测试文件匹配模式\n  testMatch: [\n    '**/__tests__/**/*.(test|spec).(js|jsx|ts|tsx)',\n    '**/*.(test|spec).(js|jsx|ts|tsx)',\n  ],\n  \n  // 忽略的测试路径\n  testPathIgnorePatterns: [\n    '<rootDir>/.next/',\n    '<rootDir>/node_modules/',\n    '<rootDir>/dist/',\n    '<rootDir>/build/',\n    '<rootDir>/coverage/',\n    '<rootDir>/.git/',\n    '<rootDir>/public/',\n    '<rootDir>/prisma/migrations/',\n  ],\n  \n  // 覆盖率收集\n  collectCoverage: false, // 默认关闭，避免性能问题\n  collectCoverageFrom: [\n    'app/**/*.{js,jsx,ts,tsx}',\n    'components/**/*.{js,jsx,ts,tsx}',\n    'lib/**/*.{js,jsx,ts,tsx}',\n    'hooks/**/*.{js,jsx,ts,tsx}',\n    '!**/*.d.ts',\n    '!**/node_modules/**',\n    '!**/.next/**',\n    '!**/coverage/**',\n    '!**/dist/**',\n    '!**/build/**',\n  ],\n  \n  // Module name mapping - Enhanced for better path resolution\n  moduleNameMapper: {\n    // Path aliases\n    '^@/(.*)$': '<rootDir>/$1',\n    '^@/components/(.*)$': '<rootDir>/components/$1',\n    '^@/lib/(.*)$': '<rootDir>/lib/$1',\n    '^@/hooks/(.*)$': '<rootDir>/hooks/$1',\n    '^@/app/(.*)$': '<rootDir>/app/$1',\n    '^@/types/(.*)$': '<rootDir>/types/$1',\n    '^@/utils/(.*)$': '<rootDir>/utils/$1',\n    '^@/config/(.*)$': '<rootDir>/config/$1',\n    '^@/prisma/(.*)$': '<rootDir>/prisma/$1',\n    \n    // Next.js specific mappings\n    '^next/router$': '<rootDir>/__mocks__/next/router.js',\n    '^next/navigation$': '<rootDir>/__mocks__/next/navigation.js',\n    '^next/image$': '<rootDir>/__mocks__/next/image.js',\n    \n    // CSS and style mappings\n    '\\\\.(css|less|scss|sass)$': 'identity-obj-proxy',\n    \n    // Static asset mappings\n    '\\\\.(jpg|jpeg|png|gif|eot|otf|webp|svg|ttf|woff|woff2|mp4|webm|wav|mp3|m4a|aac|oga)$': '<rootDir>/__mocks__/fileMock.js',\n  },\n  \n  // Transform configuration - Let Next.js handle transforms\n  // Remove conflicting transform config as Next.js handles this automatically\n  \n  // Transform ignore patterns - Updated for better ES module support\n  transformIgnorePatterns: [\n    '/node_modules/(?!(.*\\.mjs$|@testing-library|msw|uuid|nanoid))',\n  ],\n  \n  // 模块文件扩展名\n  moduleFileExtensions: ['ts', 'tsx', 'js', 'jsx', 'json', 'node'],\n  \n  // 测试超时\n  testTimeout: 30000,\n  \n  // 最大工作进程数\n  maxWorkers: '50%',\n  \n  // 详细输出\n  verbose: false,\n  \n  // 静默模式\n  silent: false,\n  \n  // 错误时停止\n  bail: false,\n  \n  // 强制退出\n  forceExit: true,\n  \n  // 检测打开的句柄\n  detectOpenHandles: true,\n  \n  // 清理模拟\n  clearMocks: true,\n  restoreMocks: true,\n  resetMocks: false,\n  \n  // Global variables - Simplified for Next.js compatibility\n  globals: {\n    // Remove ts-jest globals as Next.js handles TypeScript compilation\n  },\n  \n  // 报告器\n  reporters: [\n    'default',\n    [\n      'jest-junit',\n      {\n        outputDirectory: './test-reports',\n        outputName: 'junit.xml',\n        classNameTemplate: '{classname}',\n        titleTemplate: '{title}',\n        ancestorSeparator: ' › ',\n        usePathForSuiteName: true,\n      },\n    ],\n  ],\n  \n  // 覆盖率报告器\n  coverageReporters: ['text', 'lcov', 'html', 'json-summary'],\n  \n  // 覆盖率目录\n  coverageDirectory: 'coverage',\n  \n  // 覆盖率阈值（宽松设置，避免测试失败）\n  coverageThreshold: {\n    global: {\n      branches: 50,\n      functions: 50,\n      lines: 50,\n      statements: 50,\n    },\n  },\n  \n  // 监视插件（移除不存在的插件）\n  // watchPlugins: [\n  //   'jest-watch-typeahead/filename',\n  //   'jest-watch-typeahead/testname',\n  // ],\n  \n  // 缓存目录\n  cacheDirectory: '<rootDir>/.jest-cache',\n  \n  // 错误时显示堆栈跟踪\n  errorOnDeprecated: false,\n  \n  // Extensions configuration - Let Next.js handle ES modules\n  // Remove conflicting ESM and preset configurations\n  \n  // Additional Jest configuration\n  resolver: undefined, // Let Next.js handle module resolution\n  \n  // Experimental features\n  experimental: {\n    // Enable if needed for specific features\n  },\n};\n\n// createJestConfig is exported this way to ensure that next/jest can load the Next.js config which is async\nmodule.exports = createJestConfig(customJestConfig);"],"mappings":"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","ignoreList":[]}