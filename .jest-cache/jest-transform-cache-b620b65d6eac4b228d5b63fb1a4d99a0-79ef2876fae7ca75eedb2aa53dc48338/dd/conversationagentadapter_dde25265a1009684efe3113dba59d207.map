{"version":3,"names":["cov_1g5emrow0b","actualCoverage","s","enhanced_runtime_1","require","agent_manager_1","ConversationAgentAdapter","constructor","threadId","options","b","f","currentAgent","runtime","EnhancedAgUIRuntime","debug","apiEndpoint","enableMiddleware","enableBuiltinTools","agentManager","AgUIAgentManager","initialize","appId","apiKey","chatId","agent","createAgentFromFastGPT","metadata","protocolVersion","capabilities","category","type","tools","push","function","name","description","parameters","properties","limit","default","before","required","messageCount","setAgent","error","console","sendMessage","content","attachments","Error","userMessage","id","Date","now","role","timestamp","getState","map","file","Math","random","url","URL","createObjectURL","size","runInput","runId","messages","getMessages","state","run","getEventStream","getMessagesStream","getStateStream","getCurrentAgent","dispose","exports"],"sources":["E:\\zk-agent\\lib\\ag-ui\\agents\\conversation-agent-adapter.ts"],"sourcesContent":["// @ts-nocheck\nimport { EnhancedAgUIRuntime } from \"../protocol/enhanced-runtime\"\nimport { AgUIAgentManager } from \"../protocol/agent-manager\"\nimport type { AgentDefinition, Message, RunInput } from \"../protocol/complete-types\"\n\n/**\n * 对话智能体AG-UI适配器\n * 确保对话智能体完全遵循AG-UI协议\n */\nexport class ConversationAgentAdapter {\n  private runtime: EnhancedAgUIRuntime\n  private agentManager: AgUIAgentManager\n  private currentAgent: AgentDefinition | null = null\n\n  constructor(threadId: string, options: { debug?: boolean } = {}) {\n    this.runtime = new EnhancedAgUIRuntime({\n      threadId,\n      debug: options.debug,\n      apiEndpoint: \"/api/fastgpt/chat\",\n      enableMiddleware: true,\n      enableBuiltinTools: true,\n    })\n\n    this.agentManager = new AgUIAgentManager()\n  }\n\n  /**\n   * 初始化对话智能体\n   */\n  async initialize(appId: string, apiKey: string, chatId?: string): Promise<AgentDefinition> {\n    try {\n      // 从FastGPT创建智能体定义\n      const agent = await this.agentManager.createAgentFromFastGPT(appId, apiKey, chatId)\n\n      // 确保智能体符合AG-UI协议\n      agent.metadata = {\n        ...agent.metadata,\n        protocolVersion: \"1.0.0\",\n        capabilities: [\"text-chat\", \"file-upload\", \"context-memory\"],\n        category: \"conversation\",\n        type: \"conversation-agent\",\n      }\n\n      // 添加对话专用工具\n      agent.tools.push(\n        {\n          type: \"function\",\n          function: {\n            name: \"get_conversation_history\",\n            description: \"获取对话历史\",\n            parameters: {\n              type: \"object\",\n              properties: {\n                limit: { type: \"number\", description: \"返回消息数量\", default: 10 },\n                before: { type: \"string\", description: \"在此消息之前的历史\" },\n              },\n              required: [],\n            },\n          },\n        },\n        {\n          type: \"function\",\n          function: {\n            name: \"summarize_conversation\",\n            description: \"总结对话内容\",\n            parameters: {\n              type: \"object\",\n              properties: {\n                messageCount: { type: \"number\", description: \"要总结的消息数量\", default: 20 },\n              },\n              required: [],\n            },\n          },\n        },\n      )\n\n      // 设置智能体到运行时\n      this.runtime.setAgent(agent)\n      this.currentAgent = agent\n\n      return agent\n    } catch (error) {\n      console.error(\"Error initializing conversation agent:\", error)\n      throw error\n    }\n  }\n\n  /**\n   * 发送消息\n   */\n  async sendMessage(content: string, attachments?: File[]): Promise<void> {\n    if (!this.currentAgent) {\n      throw new Error(\"Conversation agent not initialized\")\n    }\n\n    // 创建用户消息\n    const userMessage: Message = {\n      id: `user-${Date.now()}`,\n      role: \"user\",\n      content,\n      timestamp: Date.now(),\n      threadId: this.runtime.getState().threadId,\n      attachments: attachments?.map((file) => ({\n        id: `file-${Date.now()}-${Math.random()}`,\n        name: file.name,\n        type: file.type,\n        url: URL.createObjectURL(file),\n        size: file.size,\n      })),\n    }\n\n    // 准备运行输入\n    const runInput: RunInput = {\n      threadId: this.runtime.getState().threadId || `thread-${Date.now()}`,\n      runId: `run-${Date.now()}`,\n      messages: [...this.runtime.getMessages(), userMessage],\n      tools: this.currentAgent.tools,\n      state: this.runtime.getState(),\n    }\n\n    // 执行运行\n    await this.runtime.run(runInput)\n  }\n\n  /**\n   * 获取事件流\n   */\n  getEventStream() {\n    return this.runtime.getEventStream()\n  }\n\n  /**\n   * 获取消息流\n   */\n  getMessagesStream() {\n    return this.runtime.getMessagesStream()\n  }\n\n  /**\n   * 获取状态流\n   */\n  getStateStream() {\n    return this.runtime.getStateStream()\n  }\n\n  /**\n   * 获取当前状态\n   */\n  getState() {\n    return this.runtime.getState()\n  }\n\n  /**\n   * 获取当前消息\n   */\n  getMessages() {\n    return this.runtime.getMessages()\n  }\n\n  /**\n   * 获取当前智能体\n   */\n  getCurrentAgent() {\n    return this.currentAgent\n  }\n\n  /**\n   * 清理资源\n   */\n  dispose() {\n    this.runtime.dispose()\n  }\n}\n"],"mappings":"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","ignoreList":[]}