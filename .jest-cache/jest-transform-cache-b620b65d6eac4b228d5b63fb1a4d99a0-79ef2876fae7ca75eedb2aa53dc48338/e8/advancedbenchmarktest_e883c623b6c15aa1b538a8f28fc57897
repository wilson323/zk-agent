b4841499b331b43b8a714102a88d6e74
/**
 * @file Advanced Performance Benchmark Tests
 * @description 高级性能基准测试
 */

const {
  performance
} = require('perf_hooks');
const fs = require('fs');
const path = require('path');
describe('Advanced Performance Benchmarks', () => {
  /**
   * 测试数据库连接性能
   */
  test('数据库连接性能测试', async () => {
    const start = performance.now();

    // 模拟数据库连接
    await new Promise(resolve => setTimeout(resolve, 30));
    const end = performance.now();
    const duration = end - start;

    // 数据库连接应在50ms内完成
    expect(duration).toBeLessThan(50);
  });

  /**
   * 测试文件读取性能
   */
  test('文件读取性能测试', async () => {
    const start = performance.now();

    // 模拟文件读取
    const testFile = path.join(__dirname, '../basic.test.js');
    if (fs.existsSync(testFile)) {
      await fs.promises.readFile(testFile, 'utf8');
    }
    const end = performance.now();
    const duration = end - start;

    // 文件读取应在20ms内完成
    expect(duration).toBeLessThan(20);
  });

  /**
   * 测试CPU密集型操作性能
   */
  test('CPU密集型操作性能测试', () => {
    const start = performance.now();

    // 模拟CPU密集型计算
    let result = 0;
    for (let i = 0; i < 100000; i++) {
      result += Math.sqrt(i);
    }
    const end = performance.now();
    const duration = end - start;

    // CPU计算应在100ms内完成
    expect(duration).toBeLessThan(100);
    expect(result).toBeGreaterThan(0);
  });

  /**
   * 测试内存泄漏检测
   */
  test('内存泄漏检测', () => {
    const initialMemory = process.memoryUsage();

    // 创建大量对象
    const objects = [];
    for (let i = 0; i < 1000; i++) {
      objects.push({
        id: i,
        data: new Array(100).fill(i)
      });
    }
    const afterCreation = process.memoryUsage();

    // 清理对象
    objects.length = 0;

    // 强制垃圾回收（如果可用）
    if (global.gc) {
      global.gc();
    }
    const afterCleanup = process.memoryUsage();

    // 内存增长应该是合理的
    const memoryGrowth = afterCleanup.heapUsed - initialMemory.heapUsed;
    const memoryGrowthMB = memoryGrowth / 1024 / 1024;
    expect(memoryGrowthMB).toBeLessThan(10); // 内存增长应小于10MB
  });

  /**
   * 测试并发处理性能
   */
  test('并发处理性能测试', async () => {
    const start = performance.now();

    // 模拟并发操作
    const promises = [];
    for (let i = 0; i < 10; i++) {
      promises.push(new Promise(resolve => setTimeout(() => resolve(i), Math.random() * 20)));
    }
    const results = await Promise.all(promises);
    const end = performance.now();
    const duration = end - start;

    // 并发操作应在50ms内完成
    expect(duration).toBeLessThan(50);
    expect(results).toHaveLength(10);
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJwZXJmb3JtYW5jZSIsInJlcXVpcmUiLCJmcyIsInBhdGgiLCJkZXNjcmliZSIsInRlc3QiLCJzdGFydCIsIm5vdyIsIlByb21pc2UiLCJyZXNvbHZlIiwic2V0VGltZW91dCIsImVuZCIsImR1cmF0aW9uIiwiZXhwZWN0IiwidG9CZUxlc3NUaGFuIiwidGVzdEZpbGUiLCJqb2luIiwiX19kaXJuYW1lIiwiZXhpc3RzU3luYyIsInByb21pc2VzIiwicmVhZEZpbGUiLCJyZXN1bHQiLCJpIiwiTWF0aCIsInNxcnQiLCJ0b0JlR3JlYXRlclRoYW4iLCJpbml0aWFsTWVtb3J5IiwicHJvY2VzcyIsIm1lbW9yeVVzYWdlIiwib2JqZWN0cyIsInB1c2giLCJpZCIsImRhdGEiLCJBcnJheSIsImZpbGwiLCJhZnRlckNyZWF0aW9uIiwibGVuZ3RoIiwiZ2xvYmFsIiwiZ2MiLCJhZnRlckNsZWFudXAiLCJtZW1vcnlHcm93dGgiLCJoZWFwVXNlZCIsIm1lbW9yeUdyb3d0aE1CIiwicmFuZG9tIiwicmVzdWx0cyIsImFsbCIsInRvSGF2ZUxlbmd0aCJdLCJzb3VyY2VzIjpbImFkdmFuY2VkLWJlbmNobWFyay50ZXN0LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGZpbGUgQWR2YW5jZWQgUGVyZm9ybWFuY2UgQmVuY2htYXJrIFRlc3RzXG4gKiBAZGVzY3JpcHRpb24g6auY57qn5oCn6IO95Z+65YeG5rWL6K+VXG4gKi9cblxuY29uc3QgeyBwZXJmb3JtYW5jZSB9ID0gcmVxdWlyZSgncGVyZl9ob29rcycpO1xuY29uc3QgZnMgPSByZXF1aXJlKCdmcycpO1xuY29uc3QgcGF0aCA9IHJlcXVpcmUoJ3BhdGgnKTtcblxuZGVzY3JpYmUoJ0FkdmFuY2VkIFBlcmZvcm1hbmNlIEJlbmNobWFya3MnLCAoKSA9PiB7XG4gIC8qKlxuICAgKiDmtYvor5XmlbDmja7lupPov57mjqXmgKfog71cbiAgICovXG4gIHRlc3QoJ+aVsOaNruW6k+i/nuaOpeaAp+iDvea1i+ivlScsIGFzeW5jICgpID0+IHtcbiAgICBjb25zdCBzdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpO1xuICAgIFxuICAgIC8vIOaooeaLn+aVsOaNruW6k+i/nuaOpVxuICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCAzMCkpO1xuICAgIFxuICAgIGNvbnN0IGVuZCA9IHBlcmZvcm1hbmNlLm5vdygpO1xuICAgIGNvbnN0IGR1cmF0aW9uID0gZW5kIC0gc3RhcnQ7XG4gICAgXG4gICAgLy8g5pWw5o2u5bqT6L+e5o6l5bqU5ZyoNTBtc+WGheWujOaIkFxuICAgIGV4cGVjdChkdXJhdGlvbikudG9CZUxlc3NUaGFuKDUwKTtcbiAgfSk7XG4gIFxuICAvKipcbiAgICog5rWL6K+V5paH5Lu26K+75Y+W5oCn6IO9XG4gICAqL1xuICB0ZXN0KCfmlofku7bor7vlj5bmgKfog73mtYvor5UnLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3Qgc3RhcnQgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICBcbiAgICAvLyDmqKHmi5/mlofku7bor7vlj5ZcbiAgICBjb25zdCB0ZXN0RmlsZSA9IHBhdGguam9pbihfX2Rpcm5hbWUsICcuLi9iYXNpYy50ZXN0LmpzJyk7XG4gICAgaWYgKGZzLmV4aXN0c1N5bmModGVzdEZpbGUpKSB7XG4gICAgICBhd2FpdCBmcy5wcm9taXNlcy5yZWFkRmlsZSh0ZXN0RmlsZSwgJ3V0ZjgnKTtcbiAgICB9XG4gICAgXG4gICAgY29uc3QgZW5kID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgY29uc3QgZHVyYXRpb24gPSBlbmQgLSBzdGFydDtcbiAgICBcbiAgICAvLyDmlofku7bor7vlj5blupTlnKgyMG1z5YaF5a6M5oiQXG4gICAgZXhwZWN0KGR1cmF0aW9uKS50b0JlTGVzc1RoYW4oMjApO1xuICB9KTtcbiAgXG4gIC8qKlxuICAgKiDmtYvor5VDUFXlr4bpm4blnovmk43kvZzmgKfog71cbiAgICovXG4gIHRlc3QoJ0NQVeWvhumbhuWei+aTjeS9nOaAp+iDvea1i+ivlScsICgpID0+IHtcbiAgICBjb25zdCBzdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpO1xuICAgIFxuICAgIC8vIOaooeaLn0NQVeWvhumbhuWei+iuoeeul1xuICAgIGxldCByZXN1bHQgPSAwO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTAwMDAwOyBpKyspIHtcbiAgICAgIHJlc3VsdCArPSBNYXRoLnNxcnQoaSk7XG4gICAgfVxuICAgIFxuICAgIGNvbnN0IGVuZCA9IHBlcmZvcm1hbmNlLm5vdygpO1xuICAgIGNvbnN0IGR1cmF0aW9uID0gZW5kIC0gc3RhcnQ7XG4gICAgXG4gICAgLy8gQ1BV6K6h566X5bqU5ZyoMTAwbXPlhoXlrozmiJBcbiAgICBleHBlY3QoZHVyYXRpb24pLnRvQmVMZXNzVGhhbigxMDApO1xuICAgIGV4cGVjdChyZXN1bHQpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgfSk7XG4gIFxuICAvKipcbiAgICog5rWL6K+V5YaF5a2Y5rOE5ryP5qOA5rWLXG4gICAqL1xuICB0ZXN0KCflhoXlrZjms4TmvI/mo4DmtYsnLCAoKSA9PiB7XG4gICAgY29uc3QgaW5pdGlhbE1lbW9yeSA9IHByb2Nlc3MubWVtb3J5VXNhZ2UoKTtcbiAgICBcbiAgICAvLyDliJvlu7rlpKfph4/lr7nosaFcbiAgICBjb25zdCBvYmplY3RzID0gW107XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDAwOyBpKyspIHtcbiAgICAgIG9iamVjdHMucHVzaCh7IGlkOiBpLCBkYXRhOiBuZXcgQXJyYXkoMTAwKS5maWxsKGkpIH0pO1xuICAgIH1cbiAgICBcbiAgICBjb25zdCBhZnRlckNyZWF0aW9uID0gcHJvY2Vzcy5tZW1vcnlVc2FnZSgpO1xuICAgIFxuICAgIC8vIOa4heeQhuWvueixoVxuICAgIG9iamVjdHMubGVuZ3RoID0gMDtcbiAgICBcbiAgICAvLyDlvLrliLblnoPlnL7lm57mlLbvvIjlpoLmnpzlj6/nlKjvvIlcbiAgICBpZiAoZ2xvYmFsLmdjKSB7XG4gICAgICBnbG9iYWwuZ2MoKTtcbiAgICB9XG4gICAgXG4gICAgY29uc3QgYWZ0ZXJDbGVhbnVwID0gcHJvY2Vzcy5tZW1vcnlVc2FnZSgpO1xuICAgIFxuICAgIC8vIOWGheWtmOWinumVv+W6lOivpeaYr+WQiOeQhueahFxuICAgIGNvbnN0IG1lbW9yeUdyb3d0aCA9IGFmdGVyQ2xlYW51cC5oZWFwVXNlZCAtIGluaXRpYWxNZW1vcnkuaGVhcFVzZWQ7XG4gICAgY29uc3QgbWVtb3J5R3Jvd3RoTUIgPSBtZW1vcnlHcm93dGggLyAxMDI0IC8gMTAyNDtcbiAgICBcbiAgICBleHBlY3QobWVtb3J5R3Jvd3RoTUIpLnRvQmVMZXNzVGhhbigxMCk7IC8vIOWGheWtmOWinumVv+W6lOWwj+S6jjEwTUJcbiAgfSk7XG4gIFxuICAvKipcbiAgICog5rWL6K+V5bm25Y+R5aSE55CG5oCn6IO9XG4gICAqL1xuICB0ZXN0KCflubblj5HlpITnkIbmgKfog73mtYvor5UnLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3Qgc3RhcnQgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICBcbiAgICAvLyDmqKHmi5/lubblj5Hmk43kvZxcbiAgICBjb25zdCBwcm9taXNlcyA9IFtdO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTA7IGkrKykge1xuICAgICAgcHJvbWlzZXMucHVzaChcbiAgICAgICAgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBcbiAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHJlc29sdmUoaSksIE1hdGgucmFuZG9tKCkgKiAyMClcbiAgICAgICAgKVxuICAgICAgKTtcbiAgICB9XG4gICAgXG4gICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IFByb21pc2UuYWxsKHByb21pc2VzKTtcbiAgICBcbiAgICBjb25zdCBlbmQgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICBjb25zdCBkdXJhdGlvbiA9IGVuZCAtIHN0YXJ0O1xuICAgIFxuICAgIC8vIOW5tuWPkeaTjeS9nOW6lOWcqDUwbXPlhoXlrozmiJBcbiAgICBleHBlY3QoZHVyYXRpb24pLnRvQmVMZXNzVGhhbig1MCk7XG4gICAgZXhwZWN0KHJlc3VsdHMpLnRvSGF2ZUxlbmd0aCgxMCk7XG4gIH0pO1xufSk7Il0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxNQUFNO0VBQUVBO0FBQVksQ0FBQyxHQUFHQyxPQUFPLENBQUMsWUFBWSxDQUFDO0FBQzdDLE1BQU1DLEVBQUUsR0FBR0QsT0FBTyxDQUFDLElBQUksQ0FBQztBQUN4QixNQUFNRSxJQUFJLEdBQUdGLE9BQU8sQ0FBQyxNQUFNLENBQUM7QUFFNUJHLFFBQVEsQ0FBQyxpQ0FBaUMsRUFBRSxNQUFNO0VBQ2hEO0FBQ0Y7QUFDQTtFQUNFQyxJQUFJLENBQUMsV0FBVyxFQUFFLFlBQVk7SUFDNUIsTUFBTUMsS0FBSyxHQUFHTixXQUFXLENBQUNPLEdBQUcsQ0FBQyxDQUFDOztJQUUvQjtJQUNBLE1BQU0sSUFBSUMsT0FBTyxDQUFDQyxPQUFPLElBQUlDLFVBQVUsQ0FBQ0QsT0FBTyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBRXJELE1BQU1FLEdBQUcsR0FBR1gsV0FBVyxDQUFDTyxHQUFHLENBQUMsQ0FBQztJQUM3QixNQUFNSyxRQUFRLEdBQUdELEdBQUcsR0FBR0wsS0FBSzs7SUFFNUI7SUFDQU8sTUFBTSxDQUFDRCxRQUFRLENBQUMsQ0FBQ0UsWUFBWSxDQUFDLEVBQUUsQ0FBQztFQUNuQyxDQUFDLENBQUM7O0VBRUY7QUFDRjtBQUNBO0VBQ0VULElBQUksQ0FBQyxVQUFVLEVBQUUsWUFBWTtJQUMzQixNQUFNQyxLQUFLLEdBQUdOLFdBQVcsQ0FBQ08sR0FBRyxDQUFDLENBQUM7O0lBRS9CO0lBQ0EsTUFBTVEsUUFBUSxHQUFHWixJQUFJLENBQUNhLElBQUksQ0FBQ0MsU0FBUyxFQUFFLGtCQUFrQixDQUFDO0lBQ3pELElBQUlmLEVBQUUsQ0FBQ2dCLFVBQVUsQ0FBQ0gsUUFBUSxDQUFDLEVBQUU7TUFDM0IsTUFBTWIsRUFBRSxDQUFDaUIsUUFBUSxDQUFDQyxRQUFRLENBQUNM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