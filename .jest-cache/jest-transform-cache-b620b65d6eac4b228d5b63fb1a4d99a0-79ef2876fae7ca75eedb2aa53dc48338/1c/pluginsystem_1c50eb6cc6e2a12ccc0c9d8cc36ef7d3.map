{"version":3,"names":["cov_28eeemfdzk","actualCoverage","s","AgUIPluginSystem","constructor","f","plugins","Map","extensions","eventHandlers","registerPlugin","plugin","has","name","b","Error","dependencies","dep","install","set","activate","console","info","version","unregisterPlugin","get","otherPlugin","includes","deactivate","uninstall","delete","registerExtension","extension","initialize","unregisterExtension","dispose","getPlugins","Array","from","values","getExtensions","emitEvent","event","handlers","type","handler","error","onEvent","eventType","Set","add","offEvent","clear","exports","DebugPlugin","description","debugWindow","close","document","addEventListener","handleKeyDown","bind","removeEventListener","ctrlKey","shiftKey","key","openDebugWindow","closed","focus","window","open","PerformancePlugin","metrics","observer","disconnect","PerformanceObserver","list","entry","getEntries","recordMetric","duration","startTime","entryType","observe","entryTypes","data","getMetrics","result","value","entries","MultimediaExtension","eventTypes","messageTypes","toolTypes","CollaborationExtension"],"sources":["E:\\zk-agent\\lib\\ag-ui\\protocol\\plugin-system.ts"],"sourcesContent":["// @ts-nocheck\nimport type { AgUIPlugin, ProtocolExtension, AgUIEvent } from \"./complete-types\"\n\n/**\n * AG-UI插件系统\n * 支持动态加载和管理插件\n */\nexport class AgUIPluginSystem {\n  private plugins: Map<string, AgUIPlugin> = new Map()\n  private extensions: Map<string, ProtocolExtension> = new Map()\n  private eventHandlers: Map<string, Set<Function>> = new Map()\n\n  /**\n   * 注册插件\n   */\n  async registerPlugin(plugin: AgUIPlugin): Promise<void> {\n    if (this.plugins.has(plugin.name)) {\n      throw new Error(`Plugin ${plugin.name} already registered`)\n    }\n\n    // 检查依赖\n    if (plugin.dependencies) {\n      for (const dep of plugin.dependencies) {\n        if (!this.plugins.has(dep)) {\n          throw new Error(`Plugin dependency ${dep} not found`)\n        }\n      }\n    }\n\n    // 安装插件\n    await plugin.install()\n\n    // 注册插件\n    this.plugins.set(plugin.name, plugin)\n\n    // 激活插件\n    await plugin.activate()\n\n    console.info(`Plugin ${plugin.name} v${plugin.version} registered and activated`)\n  }\n\n  /**\n   * 注销插件\n   */\n  async unregisterPlugin(name: string): Promise<boolean> {\n    const plugin = this.plugins.get(name)\n    if (!plugin) {\n      return false\n    }\n\n    // 检查是否有其他插件依赖此插件\n    for (const [, otherPlugin] of this.plugins) {\n      if (otherPlugin.dependencies?.includes(name)) {\n        throw new Error(`Cannot unregister plugin ${name}: it is required by ${otherPlugin.name}`)\n      }\n    }\n\n    // 停用插件\n    await plugin.deactivate()\n\n    // 卸载插件\n    await plugin.uninstall()\n\n    // 移除插件\n    this.plugins.delete(name)\n\n    console.info(`Plugin ${name} unregistered`)\n    return true\n  }\n\n  /**\n   * 注册协议扩展\n   */\n  async registerExtension(extension: ProtocolExtension): Promise<void> {\n    if (this.extensions.has(extension.name)) {\n      throw new Error(`Extension ${extension.name} already registered`)\n    }\n\n    // 初始化扩展\n    await extension.initialize()\n\n    // 注册扩展\n    this.extensions.set(extension.name, extension)\n\n    console.info(`Protocol extension ${extension.name} v${extension.version} registered`)\n  }\n\n  /**\n   * 注销协议扩展\n   */\n  async unregisterExtension(name: string): Promise<boolean> {\n    const extension = this.extensions.get(name)\n    if (!extension) {\n      return false\n    }\n\n    // 清理扩展\n    await extension.dispose()\n\n    // 移除扩展\n    this.extensions.delete(name)\n\n    console.info(`Protocol extension ${name} unregistered`)\n    return true\n  }\n\n  /**\n   * 获取插件列表\n   */\n  getPlugins(): AgUIPlugin[] {\n    return Array.from(this.plugins.values())\n  }\n\n  /**\n   * 获取扩展列表\n   */\n  getExtensions(): ProtocolExtension[] {\n    return Array.from(this.extensions.values())\n  }\n\n  /**\n   * 发送事件到所有插件\n   */\n  emitEvent(event: AgUIEvent): void {\n    const handlers = this.eventHandlers.get(event.type)\n    if (handlers) {\n      for (const handler of handlers) {\n        try {\n          handler(event)\n        } catch (error) {\n          console.error(`Error in event handler for ${event.type}:`, error)\n        }\n      }\n    }\n  }\n\n  /**\n   * 注册事件处理器\n   */\n  onEvent(eventType: string, handler: Function): void {\n    if (!this.eventHandlers.has(eventType)) {\n      this.eventHandlers.set(eventType, new Set())\n    }\n    this.eventHandlers.get(eventType)!.add(handler)\n  }\n\n  /**\n   * 移除事件处理器\n   */\n  offEvent(eventType: string, handler: Function): void {\n    const handlers = this.eventHandlers.get(eventType)\n    if (handlers) {\n      handlers.delete(handler)\n    }\n  }\n\n  /**\n   * 清理所有插件和扩展\n   */\n  async dispose(): Promise<void> {\n    // 停用所有插件\n    for (const plugin of this.plugins.values()) {\n      try {\n        await plugin.deactivate()\n        await plugin.uninstall()\n      } catch (error) {\n        console.error(`Error disposing plugin ${plugin.name}:`, error)\n      }\n    }\n\n    // 清理所有扩展\n    for (const extension of this.extensions.values()) {\n      try {\n        await extension.dispose()\n      } catch (error) {\n        console.error(`Error disposing extension ${extension.name}:`, error)\n      }\n    }\n\n    // 清理事件处理器\n    this.eventHandlers.clear()\n    this.plugins.clear()\n    this.extensions.clear()\n  }\n}\n\n/**\n * 内置插件：调试工具\n */\nexport class DebugPlugin implements AgUIPlugin {\n  name = \"debug\"\n  version = \"1.0.0\"\n  description = \"AG-UI调试工具插件\"\n\n  private debugWindow: Window | null = null\n\n  async install(): Promise<void> {\n    console.info(\"Installing debug plugin...\")\n  }\n\n  async uninstall(): Promise<void> {\n    if (this.debugWindow) {\n      this.debugWindow.close()\n    }\n    console.info(\"Uninstalling debug plugin...\")\n  }\n\n  async activate(): Promise<void> {\n    // 添加调试快捷键\n    document.addEventListener(\"keydown\", this.handleKeyDown.bind(this))\n    console.info(\"Debug plugin activated\")\n  }\n\n  async deactivate(): Promise<void> {\n    document.removeEventListener(\"keydown\", this.handleKeyDown.bind(this))\n    if (this.debugWindow) {\n      this.debugWindow.close()\n    }\n    console.info(\"Debug plugin deactivated\")\n  }\n\n  private handleKeyDown(event: KeyboardEvent): void {\n    // Ctrl+Shift+D 打开调试窗口\n    if (event.ctrlKey && event.shiftKey && event.key === \"D\") {\n      this.openDebugWindow()\n    }\n  }\n\n  private openDebugWindow(): void {\n    if (this.debugWindow && !this.debugWindow.closed) {\n      this.debugWindow.focus()\n      return\n    }\n\n    this.debugWindow = window.open(\"/debug/ag-ui\", \"ag-ui-debug\", \"width=800,height=600,scrollbars=yes,resizable=yes\")\n  }\n}\n\n/**\n * 内置插件：性能监控\n */\nexport class PerformancePlugin implements AgUIPlugin {\n  name = \"performance\"\n  version = \"1.0.0\"\n  description = \"AG-UI性能监控插件\"\n\n  private metrics: Map<string, any> = new Map()\n  private observer: PerformanceObserver | null = null\n\n  async install(): Promise<void> {\n    console.info(\"Installing performance plugin...\")\n  }\n\n  async uninstall(): Promise<void> {\n    if (this.observer) {\n      this.observer.disconnect()\n    }\n    console.info(\"Uninstalling performance plugin...\")\n  }\n\n  async activate(): Promise<void> {\n    // 监控性能指标\n    if (typeof PerformanceObserver !== \"undefined\") {\n      this.observer = new PerformanceObserver((list) => {\n        for (const entry of list.getEntries()) {\n          this.recordMetric(entry.name, {\n            duration: entry.duration,\n            startTime: entry.startTime,\n            type: entry.entryType,\n          })\n        }\n      })\n\n      this.observer.observe({ entryTypes: [\"measure\", \"navigation\", \"resource\"] })\n    }\n\n    console.info(\"Performance plugin activated\")\n  }\n\n  async deactivate(): Promise<void> {\n    if (this.observer) {\n      this.observer.disconnect()\n    }\n    console.info(\"Performance plugin deactivated\")\n  }\n\n  private recordMetric(name: string, data: any): void {\n    this.metrics.set(name, data)\n  }\n\n  getMetrics(): Record<string, any> {\n    const result: Record<string, any> = {}\n    for (const [key, value] of this.metrics.entries()) {\n      result[key] = value\n    }\n    return result\n  }\n}\n\n/**\n * 内置扩展：多媒体支持\n */\nexport class MultimediaExtension implements ProtocolExtension {\n  name = \"multimedia\"\n  version = \"1.0.0\"\n  eventTypes = [\"image-message\", \"audio-message\", \"video-message\", \"file-message\"]\n  messageTypes = [\"image\", \"audio\", \"video\", \"file\"]\n  toolTypes = [\"image-processor\", \"audio-processor\", \"video-processor\"]\n\n  async initialize(): Promise<void> {\n    console.info(\"Initializing multimedia extension...\")\n  }\n\n  async dispose(): Promise<void> {\n    console.info(\"Disposing multimedia extension...\")\n  }\n}\n\n/**\n * 内置扩展：协作支持\n */\nexport class CollaborationExtension implements ProtocolExtension {\n  name = \"collaboration\"\n  version = \"1.0.0\"\n  eventTypes = [\"collaboration-join\", \"collaboration-leave\", \"collaboration-cursor\", \"collaboration-edit\"]\n  messageTypes = [\"collaboration\"]\n  toolTypes = [\"collaboration-tool\"]\n\n  async initialize(): Promise<void> {\n    console.info(\"Initializing collaboration extension...\")\n  }\n\n  async dispose(): Promise<void> {\n    console.info(\"Disposing collaboration extension...\")\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}