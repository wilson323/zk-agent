314e8301be7919d27033dd810289fde8
// @ts-nocheck
/**
 * @file lib/auth/enhanced-password-security.ts
 * @description 增强密码安全模块 - 解决核查报告中的安全问题
 * @author B团队安全架构师
 * @lastUpdate 2024-12-19
 * @security 生产级密码安全实现
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: all[name]
    });
}
_export(exports, {
    EnhancedPasswordSecurity: function() {
        return EnhancedPasswordSecurity;
    },
    PasswordStrength: function() {
        return PasswordStrength;
    },
    enhancedPasswordSecurity: function() {
        return enhancedPasswordSecurity;
    },
    generateSecurePassword: function() {
        return generateSecurePassword;
    },
    hashPassword: function() {
        return hashPassword;
    },
    isAccountLocked: function() {
        return isAccountLocked;
    },
    recordLoginAttempt: function() {
        return recordLoginAttempt;
    },
    validatePassword: function() {
        return validatePassword;
    },
    verifyPassword: function() {
        return verifyPassword;
    }
});
const _bcryptjs = /*#__PURE__*/ _interop_require_default(require("bcryptjs"));
const _crypto = /*#__PURE__*/ _interop_require_default(require("crypto"));
const _logger = require("../utils/logger");
function _interop_require_default(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
const logger = new _logger.Logger('PasswordSecurity');
// 默认安全配置
const DEFAULT_CONFIG = {
    saltRounds: 12,
    minLength: 8,
    maxLength: 128,
    requireUppercase: true,
    requireLowercase: true,
    requireNumbers: true,
    requireSpecialChars: true,
    maxAttempts: 5,
    lockoutDuration: 15 * 60 * 1000,
    passwordHistory: 5
};
var PasswordStrength = /*#__PURE__*/ function(PasswordStrength) {
    PasswordStrength[PasswordStrength["VERY_WEAK"] = 0] = "VERY_WEAK";
    PasswordStrength[PasswordStrength["WEAK"] = 1] = "WEAK";
    PasswordStrength[PasswordStrength["FAIR"] = 2] = "FAIR";
    PasswordStrength[PasswordStrength["GOOD"] = 3] = "GOOD";
    PasswordStrength[PasswordStrength["STRONG"] = 4] = "STRONG";
    PasswordStrength[PasswordStrength["VERY_STRONG"] = 5] = "VERY_STRONG";
    return PasswordStrength;
}({});
class EnhancedPasswordSecurity {
    constructor(config){
        this.loginAttempts = new Map();
        this.lockedAccounts = new Map();
        this.commonPasswords = new Set();
        this.config = {
            ...DEFAULT_CONFIG,
            ...config
        };
        this.loadCommonPasswords();
        this.startCleanupProcess();
    }
    static getInstance(config) {
        if (!EnhancedPasswordSecurity.instance) {
            EnhancedPasswordSecurity.instance = new EnhancedPasswordSecurity(config);
        }
        return EnhancedPasswordSecurity.instance;
    }
    /**
   * 加载常见密码列表
   */ loadCommonPasswords() {
        const commonPasswords = [
            'password',
            '123456',
            'password123',
            'admin',
            'qwerty',
            'letmein',
            'welcome',
            'monkey',
            '1234567890',
            'abc123',
            'password1',
            '123456789',
            'welcome123',
            'admin123',
            'root',
            'toor',
            'pass',
            'test',
            'guest',
            'demo',
            'user',
            'login',
            'changeme',
            'secret',
            'default'
        ];
        commonPasswords.forEach((pwd)=>this.commonPasswords.add(pwd.toLowerCase()));
        logger.info('Common passwords loaded', {
            count: this.commonPasswords.size
        });
    }
    /**
   * 验证密码强度
   */ validatePassword(password, userInfo) {
        const errors = [];
        const warnings = [];
        const suggestions = [];
        let score = 0;
        // 基础长度检查
        if (password.length < this.config.minLength) {
            errors.push(`密码长度至少需要${this.config.minLength}位`);
        } else if (password.length >= this.config.minLength) {
            score += 1;
        }
        if (password.length > this.config.maxLength) {
            errors.push(`密码长度不能超过${this.config.maxLength}位`);
        }
        // 字符类型检查
        const hasLowercase = /[a-z]/.test(password);
        const hasUppercase = /[A-Z]/.test(password);
        const hasNumbers = /\d/.test(password);
        const hasSpecialChars = /[!@#$%^&*(),.?":{}|<>]/.test(password);
        if (this.config.requireLowercase && !hasLowercase) {
            errors.push('密码必须包含小写字母');
        } else if (hasLowercase) {
            score += 1;
        }
        if (this.config.requireUppercase && !hasUppercase) {
            errors.push('密码必须包含大写字母');
        } else if (hasUppercase) {
            score += 1;
        }
        if (this.config.requireNumbers && !hasNumbers) {
            errors.push('密码必须包含数字');
        } else if (hasNumbers) {
            score += 1;
        }
        if (this.config.requireSpecialChars && !hasSpecialChars) {
            errors.push('密码必须包含特殊字符');
        } else if (hasSpecialChars) {
            score += 1;
        }
        // 常见密码检查
        if (this.commonPasswords.has(password.toLowerCase())) {
            errors.push('不能使用常见密码');
            score = Math.max(0, score - 2);
        }
        // 个人信息检查
        if (userInfo) {
            const personalInfo = [
                userInfo.email?.split('@')[0],
                userInfo.name,
                userInfo.username
            ].filter(Boolean);
            for (const info of personalInfo){
                if (info && password.toLowerCase().includes(info.toLowerCase())) {
                    warnings.push('密码不应包含个人信息');
                    score = Math.max(0, score - 1);
                    break;
                }
            }
        }
        // 重复字符检查
        const repeatedChars = /(.)\1{2,}/.test(password);
        if (repeatedChars) {
            warnings.push('避免使用重复字符');
            score = Math.max(0, score - 1);
        }
        // 连续字符检查
        const sequentialChars = this.hasSequentialChars(password);
        if (sequentialChars) {
            warnings.push('避免使用连续字符');
            score = Math.max(0, score - 1);
        }
        // 长度加分
        if (password.length >= 12) score += 1;
        if (password.length >= 16) score += 1;
        // 复杂度加分
        const uniqueChars = new Set(password).size;
        if (uniqueChars >= password.length * 0.7) score += 1;
        // 生成建议
        if (score < 3) {
            suggestions.push('使用更长的密码（12位以上）');
            suggestions.push('混合使用大小写字母、数字和特殊字符');
            suggestions.push('避免使用个人信息和常见密码');
        }
        const strength = this.calculateStrength(score);
        return {
            isValid: errors.length === 0,
            strength,
            score,
            errors,
            warnings,
            suggestions
        };
    }
    /**
   * 安全地哈希密码
   */ async hashPassword(password) {
        try {
            const salt = await _bcryptjs.default.genSalt(this.config.saltRounds);
            const hash = await _bcryptjs.default.hash(password, salt);
            logger.info('Password hashed successfully', {
                saltRounds: this.config.saltRounds
            });
            return hash;
        } catch (error) {
            logger.error('Password hashing failed', {
                error: error.message
            });
            throw new Error('密码加密失败');
        }
    }
    /**
   * 验证密码
   */ async verifyPassword(password, hash) {
        try {
            const isValid = await _bcryptjs.default.compare(password, hash);
            logger.debug('Password verification completed', {
                success: isValid
            });
            return isValid;
        } catch (error) {
            logger.error('Password verification failed', {
                error: error.message
            });
            return false;
        }
    }
    /**
   * 记录登录尝试
   */ recordLoginAttempt(userId, ip, success, userAgent) {
        const attempt = {
            userId,
            ip,
            timestamp: Date.now(),
            success,
            userAgent
        };
        const key = `${userId}:${ip}`;
        const attempts = this.loginAttempts.get(key) || [];
        attempts.push(attempt);
        // 只保留最近的尝试记录
        const recentAttempts = attempts.filter((a)=>Date.now() - a.timestamp < this.config.lockoutDuration * 2);
        this.loginAttempts.set(key, recentAttempts);
        // 检查是否需要锁定账户
        if (!success) {
            this.checkAndLockAccount(userId, ip);
        }
        logger.info('Login attempt recorded', {
            userId,
            ip,
            success,
            totalAttempts: recentAttempts.length
        });
    }
    /**
   * 检查账户是否被锁定
   */ isAccountLocked(userId, ip) {
        const key = `${userId}:${ip}`;
        const lockTime = this.lockedAccounts.get(key);
        if (!lockTime) return false;
        if (Date.now() - lockTime > this.config.lockoutDuration) {
            this.lockedAccounts.delete(key);
            return false;
        }
        return true;
    }
    /**
   * 获取账户锁定剩余时间
   */ getLockoutTimeRemaining(userId, ip) {
        const key = `${userId}:${ip}`;
        const lockTime = this.lockedAccounts.get(key);
        if (!lockTime) return 0;
        const remaining = this.config.lockoutDuration - (Date.now() - lockTime);
        return Math.max(0, remaining);
    }
    /**
   * 手动解锁账户
   */ unlockAccount(userId, ip) {
        const key = `${userId}:${ip}`;
        this.lockedAccounts.delete(key);
        this.loginAttempts.delete(key);
        logger.info('Account manually unlocked', {
            userId,
            ip
        });
    }
    /**
   * 生成安全的随机密码
   */ generateSecurePassword(length = 16) {
        const lowercase = 'abcdefghijklmnopqrstuvwxyz';
        const uppercase = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
        const numbers = '0123456789';
        const symbols = '!@#$%^&*()_+-=[]{}|;:,.<>?';
        const allChars = lowercase + uppercase + numbers + symbols;
        let password = '';
        // 确保至少包含每种字符类型
        password += this.getRandomChar(lowercase);
        password += this.getRandomChar(uppercase);
        password += this.getRandomChar(numbers);
        password += this.getRandomChar(symbols);
        // 填充剩余长度
        for(let i = 4; i < length; i++){
            password += this.getRandomChar(allChars);
        }
        // 打乱字符顺序
        return password.split('').sort(()=>Math.random() - 0.5).join('');
    }
    /**
   * 检查密码是否在历史记录中
   */ async isPasswordInHistory(newPasswordHash, passwordHistory) {
        for (const oldHash of passwordHistory){
            // 注意：这里不能直接比较哈希值，因为每次哈希都会产生不同的结果
            // 实际实现中需要存储原始密码的哈希或使用其他方法
            // 这里仅作为示例
            if (newPasswordHash === oldHash) {
                return true;
            }
        }
        return false;
    }
    /**
   * 私有方法：检查连续字符
   */ hasSequentialChars(password) {
        const sequences = [
            'abcdefghijklmnopqrstuvwxyz',
            '0123456789',
            'qwertyuiopasdfghjklzxcvbnm'
        ];
        for (const seq of sequences){
            for(let i = 0; i <= seq.length - 3; i++){
                const subseq = seq.substring(i, i + 3);
                if (password.toLowerCase().includes(subseq)) {
                    return true;
                }
            }
        }
        return false;
    }
    /**
   * 私有方法：计算密码强度
   */ calculateStrength(score) {
        if (score <= 1) return 0;
        if (score <= 2) return 1;
        if (score <= 3) return 2;
        if (score <= 4) return 3;
        if (score <= 5) return 4;
        return 5;
    }
    /**
   * 私有方法：检查并锁定账户
   */ checkAndLockAccount(userId, ip) {
        const key = `${userId}:${ip}`;
        const attempts = this.loginAttempts.get(key) || [];
        const recentFailedAttempts = attempts.filter((a)=>!a.success && Date.now() - a.timestamp < this.config.lockoutDuration);
        if (recentFailedAttempts.length >= this.config.maxAttempts) {
            this.lockedAccounts.set(key, Date.now());
            logger.warn('Account locked due to failed attempts', {
                userId,
                ip,
                attempts: recentFailedAttempts.length,
                lockoutDuration: this.config.lockoutDuration
            });
        }
    }
    /**
   * 私有方法：获取随机字符
   */ getRandomChar(chars) {
        return chars[_crypto.default.randomInt(0, chars.length)];
    }
    /**
   * 私有方法：启动清理进程
   */ startCleanupProcess() {
        setInterval(()=>{
            this.cleanupExpiredData();
        }, 60000); // 每分钟清理一次
        logger.info('Password security cleanup process started');
    }
    /**
   * 私有方法：清理过期数据
   */ cleanupExpiredData() {
        const now = Date.now();
        let cleanedAttempts = 0;
        let cleanedLocks = 0;
        // 清理过期的登录尝试记录
        for (const [key, attempts] of this.loginAttempts.entries()){
            const validAttempts = attempts.filter((a)=>now - a.timestamp < this.config.lockoutDuration * 2);
            if (validAttempts.length === 0) {
                this.loginAttempts.delete(key);
                cleanedAttempts++;
            } else if (validAttempts.length < attempts.length) {
                this.loginAttempts.set(key, validAttempts);
            }
        }
        // 清理过期的账户锁定
        for (const [key, lockTime] of this.lockedAccounts.entries()){
            if (now - lockTime > this.config.lockoutDuration) {
                this.lockedAccounts.delete(key);
                cleanedLocks++;
            }
        }
        if (cleanedAttempts > 0 || cleanedLocks > 0) {
            logger.debug('Expired security data cleaned', {
                cleanedAttempts,
                cleanedLocks
            });
        }
    }
    /**
   * 获取安全统计信息
   */ getSecurityStats() {
        return {
            totalAttempts: Array.from(this.loginAttempts.values()).reduce((sum, attempts)=>sum + attempts.length, 0),
            lockedAccounts: this.lockedAccounts.size,
            config: {
                ...this.config
            }
        };
    }
}
const enhancedPasswordSecurity = EnhancedPasswordSecurity.getInstance();
const validatePassword = enhancedPasswordSecurity.validatePassword.bind(enhancedPasswordSecurity);
const hashPassword = enhancedPasswordSecurity.hashPassword.bind(enhancedPasswordSecurity);
const verifyPassword = enhancedPasswordSecurity.verifyPassword.bind(enhancedPasswordSecurity);
const generateSecurePassword = enhancedPasswordSecurity.generateSecurePassword.bind(enhancedPasswordSecurity);
const recordLoginAttempt = enhancedPasswordSecurity.recordLoginAttempt.bind(enhancedPasswordSecurity);
const isAccountLocked = enhancedPasswordSecurity.isAccountLocked.bind(enhancedPasswordSecurity);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkU6XFx6ay1hZ2VudFxcbGliXFxhdXRoXFxlbmhhbmNlZC1wYXNzd29yZC1zZWN1cml0eS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBAdHMtbm9jaGVja1xuLyoqXHJcbiAqIEBmaWxlIGxpYi9hdXRoL2VuaGFuY2VkLXBhc3N3b3JkLXNlY3VyaXR5LnRzXHJcbiAqIEBkZXNjcmlwdGlvbiDlop7lvLrlr4bnoIHlronlhajmqKHlnZcgLSDop6PlhrPmoLjmn6XmiqXlkYrkuK3nmoTlronlhajpl67pophcclxuICogQGF1dGhvciBC5Zui6Zif5a6J5YWo5p625p6E5biIXHJcbiAqIEBsYXN0VXBkYXRlIDIwMjQtMTItMTlcclxuICogQHNlY3VyaXR5IOeUn+S6p+e6p+WvhueggeWuieWFqOWunueOsFxyXG4gKi9cclxuXHJcbmltcG9ydCBiY3J5cHQgZnJvbSAnYmNyeXB0anMnO1xyXG5pbXBvcnQgY3J5cHRvIGZyb20gJ2NyeXB0byc7XHJcbmltcG9ydCB7IExvZ2dlciB9IGZyb20gJ0AvbGliL3V0aWxzL2xvZ2dlcic7XHJcblxyXG5jb25zdCBsb2dnZXIgPSBuZXcgTG9nZ2VyKCdQYXNzd29yZFNlY3VyaXR5Jyk7XHJcblxyXG4vLyDlr4bnoIHlronlhajphY3nva5cclxuaW50ZXJmYWNlIFBhc3N3b3JkU2VjdXJpdHlDb25maWcge1xyXG4gIHNhbHRSb3VuZHM6IG51bWJlcjtcclxuICBtaW5MZW5ndGg6IG51bWJlcjtcclxuICBtYXhMZW5ndGg6IG51bWJlcjtcclxuICByZXF1aXJlVXBwZXJjYXNlOiBib29sZWFuO1xyXG4gIHJlcXVpcmVMb3dlcmNhc2U6IGJvb2xlYW47XHJcbiAgcmVxdWlyZU51bWJlcnM6IGJvb2xlYW47XHJcbiAgcmVxdWlyZVNwZWNpYWxDaGFyczogYm9vbGVhbjtcclxuICBtYXhBdHRlbXB0czogbnVtYmVyO1xyXG4gIGxvY2tvdXREdXJhdGlvbjogbnVtYmVyOyAvLyDmr6vnp5JcclxuICBwYXNzd29yZEhpc3Rvcnk6IG51bWJlcjsgLy8g6K6w5L2P5pyA6L+RTuS4quWvhueggVxyXG59XHJcblxyXG4vLyDpu5jorqTlronlhajphY3nva5cclxuY29uc3QgREVGQVVMVF9DT05GSUc6IFBhc3N3b3JkU2VjdXJpdHlDb25maWcgPSB7XHJcbiAgc2FsdFJvdW5kczogMTIsXHJcbiAgbWluTGVuZ3RoOiA4LFxyXG4gIG1heExlbmd0aDogMTI4LFxyXG4gIHJlcXVpcmVVcHBlcmNhc2U6IHRydWUsXHJcbiAgcmVxdWlyZUxvd2VyY2FzZTogdHJ1ZSxcclxuICByZXF1aXJlTnVtYmVyczogdHJ1ZSxcclxuICByZXF1aXJlU3BlY2lhbENoYXJzOiB0cnVlLFxyXG4gIG1heEF0dGVtcHRzOiA1LFxyXG4gIGxvY2tvdXREdXJhdGlvbjogMTUgKiA2MCAqIDEwMDAsIC8vIDE15YiG6ZKfXHJcbiAgcGFzc3dvcmRIaXN0b3J5OiA1LFxyXG59O1xyXG5cclxuLy8g5a+G56CB5by65bqm562J57qnXHJcbmV4cG9ydCBlbnVtIFBhc3N3b3JkU3RyZW5ndGgge1xyXG4gIFZFUllfV0VBSyA9IDAsXHJcbiAgV0VBSyA9IDEsXHJcbiAgRkFJUiA9IDIsXHJcbiAgR09PRCA9IDMsXHJcbiAgU1RST05HID0gNCxcclxuICBWRVJZX1NUUk9ORyA9IDUsXHJcbn1cclxuXHJcbi8vIOWvhueggemqjOivgee7k+aenFxyXG5leHBvcnQgaW50ZXJmYWNlIFBhc3N3b3JkVmFsaWRhdGlvblJlc3VsdCB7XHJcbiAgaXNWYWxpZDogYm9vbGVhbjtcclxuICBzdHJlbmd0aDogUGFzc3dvcmRTdHJlbmd0aDtcclxuICBzY29yZTogbnVtYmVyO1xyXG4gIGVycm9yczogc3RyaW5nW107XHJcbiAgd2FybmluZ3M6IHN0cmluZ1tdO1xyXG4gIHN1Z2dlc3Rpb25zOiBzdHJpbmdbXTtcclxufVxyXG5cclxuLy8g55m75b2V5bCd6K+V6K6w5b2VXHJcbmludGVyZmFjZSBMb2dpbkF0dGVtcHQge1xyXG4gIHVzZXJJZDogc3RyaW5nO1xyXG4gIGlwOiBzdHJpbmc7XHJcbiAgdGltZXN0YW1wOiBudW1iZXI7XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICB1c2VyQWdlbnQ/OiBzdHJpbmc7XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBFbmhhbmNlZFBhc3N3b3JkU2VjdXJpdHkge1xyXG4gIHByaXZhdGUgc3RhdGljIGluc3RhbmNlOiBFbmhhbmNlZFBhc3N3b3JkU2VjdXJpdHk7XHJcbiAgcHJpdmF0ZSBjb25maWc6IFBhc3N3b3JkU2VjdXJpdHlDb25maWc7XHJcbiAgcHJpdmF0ZSBsb2dpbkF0dGVtcHRzOiBNYXA8c3RyaW5nLCBMb2dpbkF0dGVtcHRbXT4gPSBuZXcgTWFwKCk7XHJcbiAgcHJpdmF0ZSBsb2NrZWRBY2NvdW50czogTWFwPHN0cmluZywgbnVtYmVyPiA9IG5ldyBNYXAoKTtcclxuICBwcml2YXRlIGNvbW1vblBhc3N3b3JkczogU2V0PHN0cmluZz4gPSBuZXcgU2V0KCk7XHJcblxyXG4gIHByaXZhdGUgY29uc3RydWN0b3IoY29uZmlnPzogUGFydGlhbDxQYXNzd29yZFNlY3VyaXR5Q29uZmlnPikge1xyXG4gICAgdGhpcy5jb25maWcgPSB7IC4uLkRFRkFVTFRfQ09ORklHLCAuLi5jb25maWcgfTtcclxuICAgIHRoaXMubG9hZENvbW1vblBhc3N3b3JkcygpO1xyXG4gICAgdGhpcy5zdGFydENsZWFudXBQcm9jZXNzKCk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc3RhdGljIGdldEluc3RhbmNlKGNvbmZpZz86IFBhcnRpYWw8UGFzc3dvcmRTZWN1cml0eUNvbmZpZz4pOiBFbmhhbmNlZFBhc3N3b3JkU2VjdXJpdHkge1xyXG4gICAgaWYgKCFFbmhhbmNlZFBhc3N3b3JkU2VjdXJpdHkuaW5zdGFuY2UpIHtcclxuICAgICAgRW5oYW5jZWRQYXNzd29yZFNlY3VyaXR5Lmluc3RhbmNlID0gbmV3IEVuaGFuY2VkUGFzc3dvcmRTZWN1cml0eShjb25maWcpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIEVuaGFuY2VkUGFzc3dvcmRTZWN1cml0eS5pbnN0YW5jZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWKoOi9veW4uOingeWvhueggeWIl+ihqFxyXG4gICAqL1xyXG4gIHByaXZhdGUgbG9hZENvbW1vblBhc3N3b3JkcygpOiB2b2lkIHtcclxuICAgIGNvbnN0IGNvbW1vblBhc3N3b3JkcyA9IFtcclxuICAgICAgJ3Bhc3N3b3JkJywgJzEyMzQ1NicsICdwYXNzd29yZDEyMycsICdhZG1pbicsICdxd2VydHknLFxyXG4gICAgICAnbGV0bWVpbicsICd3ZWxjb21lJywgJ21vbmtleScsICcxMjM0NTY3ODkwJywgJ2FiYzEyMycsXHJcbiAgICAgICdwYXNzd29yZDEnLCAnMTIzNDU2Nzg5JywgJ3dlbGNvbWUxMjMnLCAnYWRtaW4xMjMnLFxyXG4gICAgICAncm9vdCcsICd0b29yJywgJ3Bhc3MnLCAndGVzdCcsICdndWVzdCcsICdkZW1vJyxcclxuICAgICAgJ3VzZXInLCAnbG9naW4nLCAnY2hhbmdlbWUnLCAnc2VjcmV0JywgJ2RlZmF1bHQnLFxyXG4gICAgXTtcclxuXHJcbiAgICBjb21tb25QYXNzd29yZHMuZm9yRWFjaChwd2QgPT4gdGhpcy5jb21tb25QYXNzd29yZHMuYWRkKHB3ZC50b0xvd2VyQ2FzZSgpKSk7XHJcbiAgICBsb2dnZXIuaW5mbygnQ29tbW9uIHBhc3N3b3JkcyBsb2FkZWQnLCB7IGNvdW50OiB0aGlzLmNvbW1vblBhc3N3b3Jkcy5zaXplIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6aqM6K+B5a+G56CB5by65bqmXHJcbiAgICovXHJcbiAgdmFsaWRhdGVQYXNzd29yZChwYXNzd29yZDogc3RyaW5nLCB1c2VySW5mbz86IHtcclxuICAgIGVtYWlsPzogc3RyaW5nO1xyXG4gICAgbmFtZT86IHN0cmluZztcclxuICAgIHVzZXJuYW1lPzogc3RyaW5nO1xyXG4gIH0pOiBQYXNzd29yZFZhbGlkYXRpb25SZXN1bHQge1xyXG4gICAgY29uc3QgZXJyb3JzOiBzdHJpbmdbXSA9IFtdO1xyXG4gICAgY29uc3Qgd2FybmluZ3M6IHN0cmluZ1tdID0gW107XHJcbiAgICBjb25zdCBzdWdnZXN0aW9uczogc3RyaW5nW10gPSBbXTtcclxuICAgIGxldCBzY29yZSA9IDA7XHJcblxyXG4gICAgLy8g5Z+656GA6ZW/5bqm5qOA5p+lXHJcbiAgICBpZiAocGFzc3dvcmQubGVuZ3RoIDwgdGhpcy5jb25maWcubWluTGVuZ3RoKSB7XHJcbiAgICAgIGVycm9ycy5wdXNoKGDlr4bnoIHplb/luqboh7PlsJHpnIDopoEke3RoaXMuY29uZmlnLm1pbkxlbmd0aH3kvY1gKTtcclxuICAgIH0gZWxzZSBpZiAocGFzc3dvcmQubGVuZ3RoID49IHRoaXMuY29uZmlnLm1pbkxlbmd0aCkge1xyXG4gICAgICBzY29yZSArPSAxO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChwYXNzd29yZC5sZW5ndGggPiB0aGlzLmNvbmZpZy5tYXhMZW5ndGgpIHtcclxuICAgICAgZXJyb3JzLnB1c2goYOWvhueggemVv+W6puS4jeiDvei2hei/hyR7dGhpcy5jb25maWcubWF4TGVuZ3RofeS9jWApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIOWtl+espuexu+Wei+ajgOafpVxyXG4gICAgY29uc3QgaGFzTG93ZXJjYXNlID0gL1thLXpdLy50ZXN0KHBhc3N3b3JkKTtcclxuICAgIGNvbnN0IGhhc1VwcGVyY2FzZSA9IC9bQS1aXS8udGVzdChwYXNzd29yZCk7XHJcbiAgICBjb25zdCBoYXNOdW1iZXJzID0gL1xcZC8udGVzdChwYXNzd29yZCk7XHJcbiAgICBjb25zdCBoYXNTcGVjaWFsQ2hhcnMgPSAvWyFAIyQlXiYqKCksLj9cIjp7fXw8Pl0vLnRlc3QocGFzc3dvcmQpO1xyXG5cclxuICAgIGlmICh0aGlzLmNvbmZpZy5yZXF1aXJlTG93ZXJjYXNlICYmICFoYXNMb3dlcmNhc2UpIHtcclxuICAgICAgZXJyb3JzLnB1c2goJ+WvhueggeW/hemhu+WMheWQq+Wwj+WGmeWtl+avjScpO1xyXG4gICAgfSBlbHNlIGlmIChoYXNMb3dlcmNhc2UpIHtcclxuICAgICAgc2NvcmUgKz0gMTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAodGhpcy5jb25maWcucmVxdWlyZVVwcGVyY2FzZSAmJiAhaGFzVXBwZXJjYXNlKSB7XHJcbiAgICAgIGVycm9ycy5wdXNoKCflr4bnoIHlv4XpobvljIXlkKvlpKflhpnlrZfmr40nKTtcclxuICAgIH0gZWxzZSBpZiAoaGFzVXBwZXJjYXNlKSB7XHJcbiAgICAgIHNjb3JlICs9IDE7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRoaXMuY29uZmlnLnJlcXVpcmVOdW1iZXJzICYmICFoYXNOdW1iZXJzKSB7XHJcbiAgICAgIGVycm9ycy5wdXNoKCflr4bnoIHlv4XpobvljIXlkKvmlbDlrZcnKTtcclxuICAgIH0gZWxzZSBpZiAoaGFzTnVtYmVycykge1xyXG4gICAgICBzY29yZSArPSAxO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICh0aGlzLmNvbmZpZy5yZXF1aXJlU3BlY2lhbENoYXJzICYmICFoYXNTcGVjaWFsQ2hhcnMpIHtcclxuICAgICAgZXJyb3JzLnB1c2goJ+WvhueggeW/hemhu+WMheWQq+eJueauiuWtl+espicpO1xyXG4gICAgfSBlbHNlIGlmIChoYXNTcGVjaWFsQ2hhcnMpIHtcclxuICAgICAgc2NvcmUgKz0gMTtcclxuICAgIH1cclxuXHJcbiAgICAvLyDluLjop4Hlr4bnoIHmo4Dmn6VcclxuICAgIGlmICh0aGlzLmNvbW1vblBhc3N3b3Jkcy5oYXMocGFzc3dvcmQudG9Mb3dlckNhc2UoKSkpIHtcclxuICAgICAgZXJyb3JzLnB1c2goJ+S4jeiDveS9v+eUqOW4uOingeWvhueggScpO1xyXG4gICAgICBzY29yZSA9IE1hdGgubWF4KDAsIHNjb3JlIC0gMik7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g5Liq5Lq65L+h5oGv5qOA5p+lXHJcbiAgICBpZiAodXNlckluZm8pIHtcclxuICAgICAgY29uc3QgcGVyc29uYWxJbmZvID0gW1xyXG4gICAgICAgIHVzZXJJbmZvLmVtYWlsPy5zcGxpdCgnQCcpWzBdLFxyXG4gICAgICAgIHVzZXJJbmZvLm5hbWUsXHJcbiAgICAgICAgdXNlckluZm8udXNlcm5hbWUsXHJcbiAgICAgIF0uZmlsdGVyKEJvb2xlYW4pO1xyXG5cclxuICAgICAgZm9yIChjb25zdCBpbmZvIG9mIHBlcnNvbmFsSW5mbykge1xyXG4gICAgICAgIGlmIChpbmZvICYmIHBhc3N3b3JkLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoaW5mby50b0xvd2VyQ2FzZSgpKSkge1xyXG4gICAgICAgICAgd2FybmluZ3MucHVzaCgn5a+G56CB5LiN5bqU5YyF5ZCr5Liq5Lq65L+h5oGvJyk7XHJcbiAgICAgICAgICBzY29yZSA9IE1hdGgubWF4KDAsIHNjb3JlIC0gMSk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyDph43lpI3lrZfnrKbmo4Dmn6VcclxuICAgIGNvbnN0IHJlcGVhdGVkQ2hhcnMgPSAvKC4pXFwxezIsfS8udGVzdChwYXNzd29yZCk7XHJcbiAgICBpZiAocmVwZWF0ZWRDaGFycykge1xyXG4gICAgICB3YXJuaW5ncy5wdXNoKCfpgb/lhY3kvb/nlKjph43lpI3lrZfnrKYnKTtcclxuICAgICAgc2NvcmUgPSBNYXRoLm1heCgwLCBzY29yZSAtIDEpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIOi/nue7reWtl+espuajgOafpVxyXG4gICAgY29uc3Qgc2VxdWVudGlhbENoYXJzID0gdGhpcy5oYXNTZXF1ZW50aWFsQ2hhcnMocGFzc3dvcmQpO1xyXG4gICAgaWYgKHNlcXVlbnRpYWxDaGFycykge1xyXG4gICAgICB3YXJuaW5ncy5wdXNoKCfpgb/lhY3kvb/nlKjov57nu63lrZfnrKYnKTtcclxuICAgICAgc2NvcmUgPSBNYXRoLm1heCgwLCBzY29yZSAtIDEpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIOmVv+W6puWKoOWIhlxyXG4gICAgaWYgKHBhc3N3b3JkLmxlbmd0aCA+PSAxMikgc2NvcmUgKz0gMTtcclxuICAgIGlmIChwYXNzd29yZC5sZW5ndGggPj0gMTYpIHNjb3JlICs9IDE7XHJcblxyXG4gICAgLy8g5aSN5p2C5bqm5Yqg5YiGXHJcbiAgICBjb25zdCB1bmlxdWVDaGFycyA9IG5ldyBTZXQocGFzc3dvcmQpLnNpemU7XHJcbiAgICBpZiAodW5pcXVlQ2hhcnMgPj0gcGFzc3dvcmQubGVuZ3RoICogMC43KSBzY29yZSArPSAxO1xyXG5cclxuICAgIC8vIOeUn+aIkOW7uuiurlxyXG4gICAgaWYgKHNjb3JlIDwgMykge1xyXG4gICAgICBzdWdnZXN0aW9ucy5wdXNoKCfkvb/nlKjmm7Tplb/nmoTlr4bnoIHvvIgxMuS9jeS7peS4iu+8iScpO1xyXG4gICAgICBzdWdnZXN0aW9ucy5wdXNoKCfmt7flkIjkvb/nlKjlpKflsI/lhpnlrZfmr43jgIHmlbDlrZflkoznibnmrorlrZfnrKYnKTtcclxuICAgICAgc3VnZ2VzdGlvbnMucHVzaCgn6YG/5YWN5L2/55So5Liq5Lq65L+h5oGv5ZKM5bi46KeB5a+G56CBJyk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3Qgc3RyZW5ndGggPSB0aGlzLmNhbGN1bGF0ZVN0cmVuZ3RoKHNjb3JlKTtcclxuICAgIFxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgaXNWYWxpZDogZXJyb3JzLmxlbmd0aCA9PT0gMCxcclxuICAgICAgc3RyZW5ndGgsXHJcbiAgICAgIHNjb3JlLFxyXG4gICAgICBlcnJvcnMsXHJcbiAgICAgIHdhcm5pbmdzLFxyXG4gICAgICBzdWdnZXN0aW9ucyxcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlronlhajlnLDlk4jluIzlr4bnoIFcclxuICAgKi9cclxuICBhc3luYyBoYXNoUGFzc3dvcmQocGFzc3dvcmQ6IHN0cmluZyk6IFByb21pc2U8c3RyaW5nPiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBzYWx0ID0gYXdhaXQgYmNyeXB0LmdlblNhbHQodGhpcy5jb25maWcuc2FsdFJvdW5kcyk7XHJcbiAgICAgIGNvbnN0IGhhc2ggPSBhd2FpdCBiY3J5cHQuaGFzaChwYXNzd29yZCwgc2FsdCk7XHJcbiAgICAgIFxyXG4gICAgICBsb2dnZXIuaW5mbygnUGFzc3dvcmQgaGFzaGVkIHN1Y2Nlc3NmdWxseScsIHtcclxuICAgICAgICBzYWx0Um91bmRzOiB0aGlzLmNvbmZpZy5zYWx0Um91bmRzLFxyXG4gICAgICB9KTtcclxuICAgICAgXHJcbiAgICAgIHJldHVybiBoYXNoO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgbG9nZ2VyLmVycm9yKCdQYXNzd29yZCBoYXNoaW5nIGZhaWxlZCcsIHsgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfSk7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcign5a+G56CB5Yqg5a+G5aSx6LSlJyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDpqozor4Hlr4bnoIFcclxuICAgKi9cclxuICBhc3luYyB2ZXJpZnlQYXNzd29yZChwYXNzd29yZDogc3RyaW5nLCBoYXNoOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IGlzVmFsaWQgPSBhd2FpdCBiY3J5cHQuY29tcGFyZShwYXNzd29yZCwgaGFzaCk7XHJcbiAgICAgIFxyXG4gICAgICBsb2dnZXIuZGVidWcoJ1Bhc3N3b3JkIHZlcmlmaWNhdGlvbiBjb21wbGV0ZWQnLCB7XHJcbiAgICAgICAgc3VjY2VzczogaXNWYWxpZCxcclxuICAgICAgfSk7XHJcbiAgICAgIFxyXG4gICAgICByZXR1cm4gaXNWYWxpZDtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGxvZ2dlci5lcnJvcignUGFzc3dvcmQgdmVyaWZpY2F0aW9uIGZhaWxlZCcsIHsgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfSk7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiusOW9leeZu+W9leWwneivlVxyXG4gICAqL1xyXG4gIHJlY29yZExvZ2luQXR0ZW1wdCh1c2VySWQ6IHN0cmluZywgaXA6IHN0cmluZywgc3VjY2VzczogYm9vbGVhbiwgdXNlckFnZW50Pzogc3RyaW5nKTogdm9pZCB7XHJcbiAgICBjb25zdCBhdHRlbXB0OiBMb2dpbkF0dGVtcHQgPSB7XHJcbiAgICAgIHVzZXJJZCxcclxuICAgICAgaXAsXHJcbiAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcclxuICAgICAgc3VjY2VzcyxcclxuICAgICAgdXNlckFnZW50LFxyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdCBrZXkgPSBgJHt1c2VySWR9OiR7aXB9YDtcclxuICAgIGNvbnN0IGF0dGVtcHRzID0gdGhpcy5sb2dpbkF0dGVtcHRzLmdldChrZXkpIHx8IFtdO1xyXG4gICAgYXR0ZW1wdHMucHVzaChhdHRlbXB0KTtcclxuXHJcbiAgICAvLyDlj6rkv53nlZnmnIDov5HnmoTlsJ3or5XorrDlvZVcclxuICAgIGNvbnN0IHJlY2VudEF0dGVtcHRzID0gYXR0ZW1wdHMuZmlsdGVyKFxyXG4gICAgICBhID0+IERhdGUubm93KCkgLSBhLnRpbWVzdGFtcCA8IHRoaXMuY29uZmlnLmxvY2tvdXREdXJhdGlvbiAqIDJcclxuICAgICk7XHJcblxyXG4gICAgdGhpcy5sb2dpbkF0dGVtcHRzLnNldChrZXksIHJlY2VudEF0dGVtcHRzKTtcclxuXHJcbiAgICAvLyDmo4Dmn6XmmK/lkKbpnIDopoHplIHlrprotKbmiLdcclxuICAgIGlmICghc3VjY2Vzcykge1xyXG4gICAgICB0aGlzLmNoZWNrQW5kTG9ja0FjY291bnQodXNlcklkLCBpcCk7XHJcbiAgICB9XHJcblxyXG4gICAgbG9nZ2VyLmluZm8oJ0xvZ2luIGF0dGVtcHQgcmVjb3JkZWQnLCB7XHJcbiAgICAgIHVzZXJJZCxcclxuICAgICAgaXAsXHJcbiAgICAgIHN1Y2Nlc3MsXHJcbiAgICAgIHRvdGFsQXR0ZW1wdHM6IHJlY2VudEF0dGVtcHRzLmxlbmd0aCxcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5qOA5p+l6LSm5oi35piv5ZCm6KKr6ZSB5a6aXHJcbiAgICovXHJcbiAgaXNBY2NvdW50TG9ja2VkKHVzZXJJZDogc3RyaW5nLCBpcDogc3RyaW5nKTogYm9vbGVhbiB7XHJcbiAgICBjb25zdCBrZXkgPSBgJHt1c2VySWR9OiR7aXB9YDtcclxuICAgIGNvbnN0IGxvY2tUaW1lID0gdGhpcy5sb2NrZWRBY2NvdW50cy5nZXQoa2V5KTtcclxuICAgIFxyXG4gICAgaWYgKCFsb2NrVGltZSkgcmV0dXJuIGZhbHNlO1xyXG4gICAgXHJcbiAgICBpZiAoRGF0ZS5ub3coKSAtIGxvY2tUaW1lID4gdGhpcy5jb25maWcubG9ja291dER1cmF0aW9uKSB7XHJcbiAgICAgIHRoaXMubG9ja2VkQWNjb3VudHMuZGVsZXRlKGtleSk7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgcmV0dXJuIHRydWU7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDojrflj5botKbmiLfplIHlrprliankvZnml7bpl7RcclxuICAgKi9cclxuICBnZXRMb2Nrb3V0VGltZVJlbWFpbmluZyh1c2VySWQ6IHN0cmluZywgaXA6IHN0cmluZyk6IG51bWJlciB7XHJcbiAgICBjb25zdCBrZXkgPSBgJHt1c2VySWR9OiR7aXB9YDtcclxuICAgIGNvbnN0IGxvY2tUaW1lID0gdGhpcy5sb2NrZWRBY2NvdW50cy5nZXQoa2V5KTtcclxuICAgIFxyXG4gICAgaWYgKCFsb2NrVGltZSkgcmV0dXJuIDA7XHJcbiAgICBcclxuICAgIGNvbnN0IHJlbWFpbmluZyA9IHRoaXMuY29uZmlnLmxvY2tvdXREdXJhdGlvbiAtIChEYXRlLm5vdygpIC0gbG9ja1RpbWUpO1xyXG4gICAgcmV0dXJuIE1hdGgubWF4KDAsIHJlbWFpbmluZyk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmiYvliqjop6PplIHotKbmiLdcclxuICAgKi9cclxuICB1bmxvY2tBY2NvdW50KHVzZXJJZDogc3RyaW5nLCBpcDogc3RyaW5nKTogdm9pZCB7XHJcbiAgICBjb25zdCBrZXkgPSBgJHt1c2VySWR9OiR7aXB9YDtcclxuICAgIHRoaXMubG9ja2VkQWNjb3VudHMuZGVsZXRlKGtleSk7XHJcbiAgICB0aGlzLmxvZ2luQXR0ZW1wdHMuZGVsZXRlKGtleSk7XHJcbiAgICBcclxuICAgIGxvZ2dlci5pbmZvKCdBY2NvdW50IG1hbnVhbGx5IHVubG9ja2VkJywgeyB1c2VySWQsIGlwIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog55Sf5oiQ5a6J5YWo55qE6ZqP5py65a+G56CBXHJcbiAgICovXHJcbiAgZ2VuZXJhdGVTZWN1cmVQYXNzd29yZChsZW5ndGg6IG51bWJlciA9IDE2KTogc3RyaW5nIHtcclxuICAgIGNvbnN0IGxvd2VyY2FzZSA9ICdhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5eic7XHJcbiAgICBjb25zdCB1cHBlcmNhc2UgPSAnQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVonO1xyXG4gICAgY29uc3QgbnVtYmVycyA9ICcwMTIzNDU2Nzg5JztcclxuICAgIGNvbnN0IHN5bWJvbHMgPSAnIUAjJCVeJiooKV8rLT1bXXt9fDs6LC48Pj8nO1xyXG5cclxuICAgIGNvbnN0IGFsbENoYXJzID0gbG93ZXJjYXNlICsgdXBwZXJjYXNlICsgbnVtYmVycyArIHN5bWJvbHM7XHJcbiAgICBsZXQgcGFzc3dvcmQgPSAnJztcclxuXHJcbiAgICAvLyDnoa7kv53oh7PlsJHljIXlkKvmr4/np43lrZfnrKbnsbvlnotcclxuICAgIHBhc3N3b3JkICs9IHRoaXMuZ2V0UmFuZG9tQ2hhcihsb3dlcmNhc2UpO1xyXG4gICAgcGFzc3dvcmQgKz0gdGhpcy5nZXRSYW5kb21DaGFyKHVwcGVyY2FzZSk7XHJcbiAgICBwYXNzd29yZCArPSB0aGlzLmdldFJhbmRvbUNoYXIobnVtYmVycyk7XHJcbiAgICBwYXNzd29yZCArPSB0aGlzLmdldFJhbmRvbUNoYXIoc3ltYm9scyk7XHJcblxyXG4gICAgLy8g5aGr5YWF5Ymp5L2Z6ZW/5bqmXHJcbiAgICBmb3IgKGxldCBpID0gNDsgaSA8IGxlbmd0aDsgaSsrKSB7XHJcbiAgICAgIHBhc3N3b3JkICs9IHRoaXMuZ2V0UmFuZG9tQ2hhcihhbGxDaGFycyk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g5omT5Lmx5a2X56ym6aG65bqPXHJcbiAgICByZXR1cm4gcGFzc3dvcmQuc3BsaXQoJycpLnNvcnQoKCkgPT4gTWF0aC5yYW5kb20oKSAtIDAuNSkuam9pbignJyk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmo4Dmn6Xlr4bnoIHmmK/lkKblnKjljoblj7LorrDlvZXkuK1cclxuICAgKi9cclxuICBhc3luYyBpc1Bhc3N3b3JkSW5IaXN0b3J5KG5ld1Bhc3N3b3JkSGFzaDogc3RyaW5nLCBwYXNzd29yZEhpc3Rvcnk6IHN0cmluZ1tdKTogUHJvbWlzZTxib29sZWFuPiB7XHJcbiAgICBmb3IgKGNvbnN0IG9sZEhhc2ggb2YgcGFzc3dvcmRIaXN0b3J5KSB7XHJcbiAgICAgIC8vIOazqOaEj++8mui/memHjOS4jeiDveebtOaOpeavlOi+g+WTiOW4jOWAvO+8jOWboOS4uuavj+asoeWTiOW4jOmDveS8muS6p+eUn+S4jeWQjOeahOe7k+aenFxyXG4gICAgICAvLyDlrp7pmYXlrp7njrDkuK3pnIDopoHlrZjlgqjljp/lp4vlr4bnoIHnmoTlk4jluIzmiJbkvb/nlKjlhbbku5bmlrnms5VcclxuICAgICAgLy8g6L+Z6YeM5LuF5L2c5Li656S65L6LXHJcbiAgICAgIGlmIChuZXdQYXNzd29yZEhhc2ggPT09IG9sZEhhc2gpIHtcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog56eB5pyJ5pa55rOV77ya5qOA5p+l6L+e57ut5a2X56ymXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBoYXNTZXF1ZW50aWFsQ2hhcnMocGFzc3dvcmQ6IHN0cmluZyk6IGJvb2xlYW4ge1xyXG4gICAgY29uc3Qgc2VxdWVuY2VzID0gW1xyXG4gICAgICAnYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXonLFxyXG4gICAgICAnMDEyMzQ1Njc4OScsXHJcbiAgICAgICdxd2VydHl1aW9wYXNkZmdoamtsenhjdmJubScsXHJcbiAgICBdO1xyXG5cclxuICAgIGZvciAoY29uc3Qgc2VxIG9mIHNlcXVlbmNlcykge1xyXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8PSBzZXEubGVuZ3RoIC0gMzsgaSsrKSB7XHJcbiAgICAgICAgY29uc3Qgc3Vic2VxID0gc2VxLnN1YnN0cmluZyhpLCBpICsgMyk7XHJcbiAgICAgICAgaWYgKHBhc3N3b3JkLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoc3Vic2VxKSkge1xyXG4gICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog56eB5pyJ5pa55rOV77ya6K6h566X5a+G56CB5by65bqmXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBjYWxjdWxhdGVTdHJlbmd0aChzY29yZTogbnVtYmVyKTogUGFzc3dvcmRTdHJlbmd0aCB7XHJcbiAgICBpZiAoc2NvcmUgPD0gMSkgcmV0dXJuIFBhc3N3b3JkU3RyZW5ndGguVkVSWV9XRUFLO1xyXG4gICAgaWYgKHNjb3JlIDw9IDIpIHJldHVybiBQYXNzd29yZFN0cmVuZ3RoLldFQUs7XHJcbiAgICBpZiAoc2NvcmUgPD0gMykgcmV0dXJuIFBhc3N3b3JkU3RyZW5ndGguRkFJUjtcclxuICAgIGlmIChzY29yZSA8PSA0KSByZXR1cm4gUGFzc3dvcmRTdHJlbmd0aC5HT09EO1xyXG4gICAgaWYgKHNjb3JlIDw9IDUpIHJldHVybiBQYXNzd29yZFN0cmVuZ3RoLlNUUk9ORztcclxuICAgIHJldHVybiBQYXNzd29yZFN0cmVuZ3RoLlZFUllfU1RST05HO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog56eB5pyJ5pa55rOV77ya5qOA5p+l5bm26ZSB5a6a6LSm5oi3XHJcbiAgICovXHJcbiAgcHJpdmF0ZSBjaGVja0FuZExvY2tBY2NvdW50KHVzZXJJZDogc3RyaW5nLCBpcDogc3RyaW5nKTogdm9pZCB7XHJcbiAgICBjb25zdCBrZXkgPSBgJHt1c2VySWR9OiR7aXB9YDtcclxuICAgIGNvbnN0IGF0dGVtcHRzID0gdGhpcy5sb2dpbkF0dGVtcHRzLmdldChrZXkpIHx8IFtdO1xyXG4gICAgXHJcbiAgICBjb25zdCByZWNlbnRGYWlsZWRBdHRlbXB0cyA9IGF0dGVtcHRzLmZpbHRlcihcclxuICAgICAgYSA9PiAhYS5zdWNjZXNzICYmIERhdGUubm93KCkgLSBhLnRpbWVzdGFtcCA8IHRoaXMuY29uZmlnLmxvY2tvdXREdXJhdGlvblxyXG4gICAgKTtcclxuXHJcbiAgICBpZiAocmVjZW50RmFpbGVkQXR0ZW1wdHMubGVuZ3RoID49IHRoaXMuY29uZmlnLm1heEF0dGVtcHRzKSB7XHJcbiAgICAgIHRoaXMubG9ja2VkQWNjb3VudHMuc2V0KGtleSwgRGF0ZS5ub3coKSk7XHJcbiAgICAgIFxyXG4gICAgICBsb2dnZXIud2FybignQWNjb3VudCBsb2NrZWQgZHVlIHRvIGZhaWxlZCBhdHRlbXB0cycsIHtcclxuICAgICAgICB1c2VySWQsXHJcbiAgICAgICAgaXAsXHJcbiAgICAgICAgYXR0ZW1wdHM6IHJlY2VudEZhaWxlZEF0dGVtcHRzLmxlbmd0aCxcclxuICAgICAgICBsb2Nrb3V0RHVyYXRpb246IHRoaXMuY29uZmlnLmxvY2tvdXREdXJhdGlvbixcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDnp4HmnInmlrnms5XvvJrojrflj5bpmo/mnLrlrZfnrKZcclxuICAgKi9cclxuICBwcml2YXRlIGdldFJhbmRvbUNoYXIoY2hhcnM6IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgICByZXR1cm4gY2hhcnNbY3J5cHRvLnJhbmRvbUludCgwLCBjaGFycy5sZW5ndGgpXTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOengeacieaWueazle+8muWQr+WKqOa4heeQhui/m+eoi1xyXG4gICAqL1xyXG4gIHByaXZhdGUgc3RhcnRDbGVhbnVwUHJvY2VzcygpOiB2b2lkIHtcclxuICAgIHNldEludGVydmFsKCgpID0+IHtcclxuICAgICAgdGhpcy5jbGVhbnVwRXhwaXJlZERhdGEoKTtcclxuICAgIH0sIDYwMDAwKTsgLy8g5q+P5YiG6ZKf5riF55CG5LiA5qyhXHJcblxyXG4gICAgbG9nZ2VyLmluZm8oJ1Bhc3N3b3JkIHNlY3VyaXR5IGNsZWFudXAgcHJvY2VzcyBzdGFydGVkJyk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDnp4HmnInmlrnms5XvvJrmuIXnkIbov4fmnJ/mlbDmja5cclxuICAgKi9cclxuICBwcml2YXRlIGNsZWFudXBFeHBpcmVkRGF0YSgpOiB2b2lkIHtcclxuICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XHJcbiAgICBsZXQgY2xlYW5lZEF0dGVtcHRzID0gMDtcclxuICAgIGxldCBjbGVhbmVkTG9ja3MgPSAwO1xyXG5cclxuICAgIC8vIOa4heeQhui/h+acn+eahOeZu+W9leWwneivleiusOW9lVxyXG4gICAgZm9yIChjb25zdCBba2V5LCBhdHRlbXB0c10gb2YgdGhpcy5sb2dpbkF0dGVtcHRzLmVudHJpZXMoKSkge1xyXG4gICAgICBjb25zdCB2YWxpZEF0dGVtcHRzID0gYXR0ZW1wdHMuZmlsdGVyKFxyXG4gICAgICAgIGEgPT4gbm93IC0gYS50aW1lc3RhbXAgPCB0aGlzLmNvbmZpZy5sb2Nrb3V0RHVyYXRpb24gKiAyXHJcbiAgICAgICk7XHJcbiAgICAgIFxyXG4gICAgICBpZiAodmFsaWRBdHRlbXB0cy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICB0aGlzLmxvZ2luQXR0ZW1wdHMuZGVsZXRlKGtleSk7XHJcbiAgICAgICAgY2xlYW5lZEF0dGVtcHRzKys7XHJcbiAgICAgIH0gZWxzZSBpZiAodmFsaWRBdHRlbXB0cy5sZW5ndGggPCBhdHRlbXB0cy5sZW5ndGgpIHtcclxuICAgICAgICB0aGlzLmxvZ2luQXR0ZW1wdHMuc2V0KGtleSwgdmFsaWRBdHRlbXB0cyk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyDmuIXnkIbov4fmnJ/nmoTotKbmiLfplIHlrppcclxuICAgIGZvciAoY29uc3QgW2tleSwgbG9ja1RpbWVdIG9mIHRoaXMubG9ja2VkQWNjb3VudHMuZW50cmllcygpKSB7XHJcbiAgICAgIGlmIChub3cgLSBsb2NrVGltZSA+IHRoaXMuY29uZmlnLmxvY2tvdXREdXJhdGlvbikge1xyXG4gICAgICAgIHRoaXMubG9ja2VkQWNjb3VudHMuZGVsZXRlKGtleSk7XHJcbiAgICAgICAgY2xlYW5lZExvY2tzKys7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBpZiAoY2xlYW5lZEF0dGVtcHRzID4gMCB8fCBjbGVhbmVkTG9ja3MgPiAwKSB7XHJcbiAgICAgIGxvZ2dlci5kZWJ1ZygnRXhwaXJlZCBzZWN1cml0eSBkYXRhIGNsZWFuZWQnLCB7XHJcbiAgICAgICAgY2xlYW5lZEF0dGVtcHRzLFxyXG4gICAgICAgIGNsZWFuZWRMb2NrcyxcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDojrflj5blronlhajnu5/orqHkv6Hmga9cclxuICAgKi9cclxuICBnZXRTZWN1cml0eVN0YXRzKCk6IHtcclxuICAgIHRvdGFsQXR0ZW1wdHM6IG51bWJlcjtcclxuICAgIGxvY2tlZEFjY291bnRzOiBudW1iZXI7XHJcbiAgICBjb25maWc6IFBhc3N3b3JkU2VjdXJpdHlDb25maWc7XHJcbiAgfSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICB0b3RhbEF0dGVtcHRzOiBBcnJheS5mcm9tKHRoaXMubG9naW5BdHRlbXB0cy52YWx1ZXMoKSlcclxuICAgICAgICAucmVkdWNlKChzdW0sIGF0dGVtcHRzKSA9PiBzdW0gKyBhdHRlbXB0cy5sZW5ndGgsIDApLFxyXG4gICAgICBsb2NrZWRBY2NvdW50czogdGhpcy5sb2NrZWRBY2NvdW50cy5zaXplLFxyXG4gICAgICBjb25maWc6IHsgLi4udGhpcy5jb25maWcgfSxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG4vLyDlr7zlh7rljZXkvovlrp7kvotcclxuZXhwb3J0IGNvbnN0IGVuaGFuY2VkUGFzc3dvcmRTZWN1cml0eSA9IEVuaGFuY2VkUGFzc3dvcmRTZWN1cml0eS5nZXRJbnN0YW5jZSgpO1xyXG5cclxuLy8g5a+85Ye65L6/5o235pa55rOVXHJcbmV4cG9ydCBjb25zdCB2YWxpZGF0ZVBhc3N3b3JkID0gZW5oYW5jZWRQYXNzd29yZFNlY3VyaXR5LnZhbGlkYXRlUGFzc3dvcmQuYmluZChlbmhhbmNlZFBhc3N3b3JkU2VjdXJpdHkpO1xyXG5leHBvcnQgY29uc3QgaGFzaFBhc3N3b3JkID0gZW5oYW5jZWRQYXNzd29yZFNlY3VyaXR5Lmhhc2hQYXNzd29yZC5iaW5kKGVuaGFuY2VkUGFzc3dvcmRTZWN1cml0eSk7XHJcbmV4cG9ydCBjb25zdCB2ZXJpZnlQYXNzd29yZCA9IGVuaGFuY2VkUGFzc3dvcmRTZWN1cml0eS52ZXJpZnlQYXNzd29yZC5iaW5kKGVuaGFuY2VkUGFzc3dvcmRTZWN1cml0eSk7XHJcbmV4cG9ydCBjb25zdCBnZW5lcmF0ZVNlY3VyZVBhc3N3b3JkID0gZW5oYW5jZWRQYXNzd29yZFNlY3VyaXR5LmdlbmVyYXRlU2VjdXJlUGFzc3dvcmQuYmluZChlbmhhbmNlZFBhc3N3b3JkU2VjdXJpdHkpO1xyXG5leHBvcnQgY29uc3QgcmVjb3JkTG9naW5BdHRlbXB0ID0gZW5oYW5jZWRQYXNzd29yZFNlY3VyaXR5LnJlY29yZExvZ2luQXR0ZW1wdC5iaW5kKGVuaGFuY2VkUGFzc3dvcmRTZWN1cml0eSk7XHJcbmV4cG9ydCBjb25zdCBpc0FjY291bnRMb2NrZWQgPSBlbmhhbmNlZFBhc3N3b3JkU2VjdXJpdHkuaXNBY2NvdW50TG9ja2VkLmJpbmQoZW5oYW5jZWRQYXNzd29yZFNlY3VyaXR5KTsgIl0sIm5hbWVzIjpbIkVuaGFuY2VkUGFzc3dvcmRTZWN1cml0eSIsIlBhc3N3b3JkU3RyZW5ndGgiLCJlbmhhbmNlZFBhc3N3b3JkU2VjdXJpdHkiLCJnZW5lcmF0ZVNlY3VyZVBhc3N3b3JkIiwiaGFzaFBhc3N3b3JkIiwiaXNBY2NvdW50TG9ja2VkIiwicmVjb3JkTG9naW5BdHRlbXB0IiwidmFsaWRhdGVQYXNzd29yZCIsInZlcmlmeVBhc3N3b3JkIiwibG9nZ2VyIiwiTG9nZ2VyIiwiREVGQVVMVF9DT05GSUciLCJzYWx0Um91bmRzIiwibWluTGVuZ3RoIiwibWF4TGVuZ3RoIiwicmVxdWlyZVVwcGVyY2FzZSIsInJlcXVpcmVMb3dlcmNhc2UiLCJyZXF1aXJlTnVtYmVycyIsInJlcXVpcmVTcGVjaWFsQ2hhcnMiLCJtYXhBdHRlbXB0cyIsImxvY2tvdXREdXJhdGlvbiIsInBhc3N3b3JkSGlzdG9yeSIsImNvbmZpZyIsImxvZ2luQXR0ZW1wdHMiLCJNYXAiLCJsb2NrZWRBY2NvdW50cyIsImNvbW1vblBhc3N3b3JkcyIsIlNldCIsImxvYWRDb21tb25QYXNzd29yZHMiLCJzdGFydENsZWFudXBQcm9jZXNzIiwiZ2V0SW5zdGFuY2UiLCJpbnN0YW5jZSIsImZvckVhY2giLCJwd2QiLCJhZGQiLCJ0b0xvd2VyQ2FzZSIsImluZm8iLCJjb3VudCIsInNpemUiLCJwYXNzd29yZCIsInVzZXJJbmZvIiwiZXJyb3JzIiwid2FybmluZ3MiLCJzdWdnZXN0aW9ucyIsInNjb3JlIiwibGVuZ3RoIiwicHVzaCIsImhhc0xvd2VyY2FzZSIsInRlc3QiLCJoYXNVcHBlcmNhc2UiLCJoYXNOdW1iZXJzIiwiaGFzU3BlY2lhbENoYXJzIiwiaGFzIiwiTWF0aCIsIm1heCIsInBlcnNvbmFsSW5mbyIsImVtYWlsIiwic3BsaXQiLCJuYW1lIiwidXNlcm5hbWUiLCJmaWx0ZXIiLCJCb29sZWFuIiwiaW5jbHVkZXMiLCJyZXBlYXRlZENoYXJzIiwic2VxdWVudGlhbENoYXJzIiwiaGFzU2VxdWVudGlhbENoYXJzIiwidW5pcXVlQ2hhcnMiLCJzdHJlbmd0aCIsImNhbGN1bGF0ZVN0cmVuZ3RoIiwiaXNWYWxpZCIsInNhbHQiLCJiY3J5cHQiLCJnZW5TYWx0IiwiaGFzaCIsImVycm9yIiwibWVzc2FnZSIsIkVycm9yIiwiY29tcGFyZSIsImRlYnVnIiwic3VjY2VzcyIsInVzZXJJZCIsImlwIiwidXNlckFnZW50IiwiYXR0ZW1wdCIsInRpbWVzdGFtcCIsIkRhdGUiLCJub3ciLCJrZXkiLCJhdHRlbXB0cyIsImdldCIsInJlY2VudEF0dGVtcHRzIiwiYSIsInNldCIsImNoZWNrQW5kTG9ja0FjY291bnQiLCJ0b3RhbEF0dGVtcHRzIiwibG9ja1RpbWUiLCJkZWxldGUiLCJnZXRMb2Nrb3V0VGltZVJlbWFpbmluZyIsInJlbWFpbmluZyIsInVubG9ja0FjY291bnQiLCJsb3dlcmNhc2UiLCJ1cHBlcmNhc2UiLCJudW1iZXJzIiwic3ltYm9scyIsImFsbENoYXJzIiwiZ2V0UmFuZG9tQ2hhciIsImkiLCJzb3J0IiwicmFuZG9tIiwiam9pbiIsImlzUGFzc3dvcmRJbkhpc3RvcnkiLCJuZXdQYXNzd29yZEhhc2giLCJvbGRIYXNoIiwic2VxdWVuY2VzIiwic2VxIiwic3Vic2VxIiwic3Vic3RyaW5nIiwicmVjZW50RmFpbGVkQXR0ZW1wdHMiLCJ3YXJuIiwiY2hhcnMiLCJjcnlwdG8iLCJyYW5kb21JbnQiLCJzZXRJbnRlcnZhbCIsImNsZWFudXBFeHBpcmVkRGF0YSIsImNsZWFuZWRBdHRlbXB0cyIsImNsZWFuZWRMb2NrcyIsImVudHJpZXMiLCJ2YWxpZEF0dGVtcHRzIiwiZ2V0U2VjdXJpdHlTdGF0cyIsIkFycmF5IiwiZnJvbSIsInZhbHVlcyIsInJlZHVjZSIsInN1bSIsImJpbmQiXSwibWFwcGluZ3MiOiJBQUFBLGNBQWM7QUFDZDs7Ozs7O0NBTUM7Ozs7Ozs7Ozs7O0lBaUVZQSx3QkFBd0I7ZUFBeEJBOztJQTVCREMs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