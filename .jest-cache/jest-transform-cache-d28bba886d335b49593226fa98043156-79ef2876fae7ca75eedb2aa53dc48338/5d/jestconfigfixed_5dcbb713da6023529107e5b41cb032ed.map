{"version":3,"sources":["E:\\zk-agent\\jest.config.fixed.js"],"sourcesContent":["/**\n * @file jest.config.fixed.js\n * @description Fixed Jest configuration - Resolves infinite loop and dependency issues\n * @author Jest Fix Team\n * @lastUpdate 2024-12-19\n */\n\nconst nextJest = require('next/jest');\nconst path = require('path');\n\n// Create Jest configuration with Next.js integration\nconst createJestConfig = nextJest({\n  // Provide the path to your Next.js app to load next.config.js and .env files\n  dir: './',\n  // Disable SWC for better compatibility\n  experimental: {\n    forceSwcTransforms: false,\n  },\n});\n\n// Add any custom config to be passed to Jest\nconst customJestConfig = {\n  // Use fixed setup file\n  setupFilesAfterEnv: ['<rootDir>/jest.setup.fixed.js'],\n  \n  // TypeScript configuration for Jest\n  preset: undefined, // Let Next.js handle the preset\n  \n  // 测试环境\n  testEnvironment: 'jsdom',\n  \n  // 测试文件匹配模式\n  testMatch: [\n    '**/__tests__/**/*.(test|spec).(js|jsx|ts|tsx)',\n    '**/*.(test|spec).(js|jsx|ts|tsx)',\n  ],\n  \n  // 忽略的测试路径\n  testPathIgnorePatterns: [\n    '<rootDir>/.next/',\n    '<rootDir>/node_modules/',\n    '<rootDir>/dist/',\n    '<rootDir>/build/',\n    '<rootDir>/coverage/',\n    '<rootDir>/.git/',\n    '<rootDir>/public/',\n    '<rootDir>/prisma/migrations/',\n  ],\n  \n  // 覆盖率收集\n  collectCoverage: false, // 默认关闭，避免性能问题\n  collectCoverageFrom: [\n    'app/**/*.{js,jsx,ts,tsx}',\n    'components/**/*.{js,jsx,ts,tsx}',\n    'lib/**/*.{js,jsx,ts,tsx}',\n    'hooks/**/*.{js,jsx,ts,tsx}',\n    '!**/*.d.ts',\n    '!**/node_modules/**',\n    '!**/.next/**',\n    '!**/coverage/**',\n    '!**/dist/**',\n    '!**/build/**',\n  ],\n  \n  // Module name mapping - Enhanced for better path resolution\n  moduleNameMapper: {\n    // Path aliases\n    '^@/(.*)$': '<rootDir>/$1',\n    '^@/components/(.*)$': '<rootDir>/components/$1',\n    '^@/lib/(.*)$': '<rootDir>/lib/$1',\n    '^@/hooks/(.*)$': '<rootDir>/hooks/$1',\n    '^@/app/(.*)$': '<rootDir>/app/$1',\n    '^@/types/(.*)$': '<rootDir>/types/$1',\n    '^@/utils/(.*)$': '<rootDir>/utils/$1',\n    '^@/config/(.*)$': '<rootDir>/config/$1',\n    '^@/prisma/(.*)$': '<rootDir>/prisma/$1',\n    \n    // Next.js specific mappings\n    '^next/router$': '<rootDir>/__mocks__/next/router.js',\n    '^next/navigation$': '<rootDir>/__mocks__/next/navigation.js',\n    '^next/image$': '<rootDir>/__mocks__/next/image.js',\n    \n    // CSS and style mappings\n    '\\\\.(css|less|scss|sass)$': 'identity-obj-proxy',\n    \n    // Static asset mappings\n    '\\\\.(jpg|jpeg|png|gif|eot|otf|webp|svg|ttf|woff|woff2|mp4|webm|wav|mp3|m4a|aac|oga)$': '<rootDir>/__mocks__/fileMock.js',\n  },\n  \n  // Transform configuration - Let Next.js handle transforms\n  // Remove conflicting transform config as Next.js handles this automatically\n  \n  // Transform ignore patterns - Updated for better ES module support\n  transformIgnorePatterns: [\n    '/node_modules/(?!(.*\\.mjs$|@testing-library|msw|uuid|nanoid))',\n  ],\n  \n  // 模块文件扩展名\n  moduleFileExtensions: ['ts', 'tsx', 'js', 'jsx', 'json', 'node'],\n  \n  // 测试超时\n  testTimeout: 30000,\n  \n  // 最大工作进程数\n  maxWorkers: '50%',\n  \n  // 详细输出\n  verbose: false,\n  \n  // 静默模式\n  silent: false,\n  \n  // 错误时停止\n  bail: false,\n  \n  // 强制退出\n  forceExit: true,\n  \n  // 检测打开的句柄\n  detectOpenHandles: true,\n  \n  // 清理模拟\n  clearMocks: true,\n  restoreMocks: true,\n  resetMocks: false,\n  \n  // Global variables - Simplified for Next.js compatibility\n  globals: {\n    // Remove ts-jest globals as Next.js handles TypeScript compilation\n  },\n  \n  // 报告器\n  reporters: [\n    'default',\n    [\n      'jest-junit',\n      {\n        outputDirectory: './test-reports',\n        outputName: 'junit.xml',\n        classNameTemplate: '{classname}',\n        titleTemplate: '{title}',\n        ancestorSeparator: ' › ',\n        usePathForSuiteName: true,\n      },\n    ],\n  ],\n  \n  // 覆盖率报告器\n  coverageReporters: ['text', 'lcov', 'html', 'json-summary'],\n  \n  // 覆盖率目录\n  coverageDirectory: 'coverage',\n  \n  // 覆盖率阈值（宽松设置，避免测试失败）\n  coverageThreshold: {\n    global: {\n      branches: 50,\n      functions: 50,\n      lines: 50,\n      statements: 50,\n    },\n  },\n  \n  // 监视插件（移除不存在的插件）\n  // watchPlugins: [\n  //   'jest-watch-typeahead/filename',\n  //   'jest-watch-typeahead/testname',\n  // ],\n  \n  // 缓存目录\n  cacheDirectory: '<rootDir>/.jest-cache',\n  \n  // 错误时显示堆栈跟踪\n  errorOnDeprecated: false,\n  \n  // Extensions configuration - Let Next.js handle ES modules\n  // Remove conflicting ESM and preset configurations\n  \n  // Additional Jest configuration\n  resolver: undefined, // Let Next.js handle module resolution\n  \n  // Experimental features\n  experimental: {\n    // Enable if needed for specific features\n  },\n};\n\n// createJestConfig is exported this way to ensure that next/jest can load the Next.js config which is async\nmodule.exports = createJestConfig(customJestConfig);"],"names":["nextJest","require","path","createJestConfig","dir","experimental","forceSwcTransforms","customJestConfig","setupFilesAfterEnv","preset","undefined","testEnvironment","testMatch","testPathIgnorePatterns","collectCoverage","collectCoverageFrom","moduleNameMapper","transformIgnorePatterns","moduleFileExtensions","testTimeout","maxWorkers","verbose","silent","bail","forceExit","detectOpenHandles","clearMocks","restoreMocks","resetMocks","globals","reporters","outputDirectory","outputName","classNameTemplate","titleTemplate","ancestorSeparator","usePathForSuiteName","coverageReporters","coverageDirectory","coverageThreshold","global","branches","functions","lines","statements","cacheDirectory","errorOnDeprecated","resolver","module","exports"],"mappings":"AAAA;;;;;CAKC;AAED,MAAMA,WAAWC,QAAQ;AACzB,MAAMC,OAAOD,QAAQ;AAErB,qDAAqD;AACrD,MAAME,mBAAmBH,SAAS;IAChC,6EAA6E;IAC7EI,KAAK;IACL,uCAAuC;IACvCC,cAAc;QACZC,oBAAoB;IACtB;AACF;AAEA,6CAA6C;AAC7C,MAAMC,mBAAmB;IACvB,uBAAuB;IACvBC,oBAAoB;QAAC;KAAgC;IAErD,oCAAoC;IACpCC,QAAQC;IAER,OAAO;IACPC,iBAAiB;IAEjB,WAAW;IACXC,WAAW;QACT;QACA;KACD;IAED,UAAU;IACVC,wBAAwB;QACtB;QACA;QACA;QACA;QACA;QACA;QACA;QACA;KACD;IAED,QAAQ;IACRC,iBAAiB;IACjBC,qBAAqB;QACnB;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;KACD;IAED,4DAA4D;IAC5DC,kBAAkB;QAChB,eAAe;QACf,YAAY;QACZ,uBAAuB;QACvB,gBAAgB;QAChB,kBAAkB;QAClB,gBAAgB;QAChB,kBAAkB;QAClB,kBAAkB;QAClB,mBAAmB;QACnB,mBAAmB;QAEnB,4BAA4B;QAC5B,iBAAiB;QACjB,qBAAqB;QACrB,gBAAgB;QAEhB,yBAAyB;QACzB,4BAA4B;QAE5B,wBAAwB;QACxB,uFAAuF;IACzF;IAEA,0DAA0D;IAC1D,4EAA4E;IAE5E,mEAAmE;IACnEC,yBAAyB;QACvB;KACD;IAED,UAAU;IACVC,sBAAsB;QAAC;QAAM;QAAO;QAAM;QAAO;QAAQ;KAAO;IAEhE,OAAO;IACPC,aAAa;IAEb,UAAU;IACVC,YAAY;IAEZ,OAAO;IACPC,SAAS;IAET,OAAO;IACPC,QAAQ;IAER,QAAQ;IACRC,MAAM;IAEN,OAAO;IACPC,WAAW;IAEX,UAAU;IACVC,mBAAmB;IAEnB,OAAO;IACPC,YAAY;IACZC,cAAc;IACdC,YAAY;IAEZ,0DAA0D;IAC1DC,SAAS;IAET;IAEA,MAAM;IACNC,WAAW;QACT;QACA;YACE;YACA;gBACEC,iBAAiB;gBACjBC,YAAY;gBACZC,mBAAmB;gBACnBC,eAAe;gBACfC,mBAAmB;gBACnBC,qBAAqB;YACvB;SACD;KACF;IAED,SAAS;IACTC,mBAAmB;QAAC;QAAQ;QAAQ;QAAQ;KAAe;IAE3D,QAAQ;IACRC,mBAAmB;IAEnB,qBAAqB;IACrBC,mBAAmB;QACjBC,QAAQ;YACNC,UAAU;YACVC,WAAW;YACXC,OAAO;YACPC,YAAY;QACd;IACF;IAEA,iBAAiB;IACjB,kBAAkB;IAClB,qCAAqC;IACrC,qCAAqC;IACrC,KAAK;IAEL,OAAO;IACPC,gBAAgB;IAEhB,YAAY;IACZC,mBAAmB;IAEnB,2DAA2D;IAC3D,mDAAmD;IAEnD,gCAAgC;IAChCC,UAAUrC;IAEV,wBAAwB;IACxBL,cAAc;IAEd;AACF;AAEA,4GAA4G;AAC5G2C,OAAOC,OAAO,GAAG9C,iBAAiBI"}