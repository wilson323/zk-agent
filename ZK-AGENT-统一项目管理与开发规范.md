# ZK-Agent 统一项目管理与开发规范

## 📋 项目概览

### 基本信息
- **项目名称**: ZK-Agent - AI多智能体协作平台
- **技术栈**: Next.js 14 + TypeScript + PostgreSQL + Prisma + Tailwind CSS
- **架构模式**: 模块化微服务架构 + 智能体协作系统
- **任务管理ID**: req-11 (14个核心任务)

### 核心功能模块
1. **智能体广场** - 多智能体展示与交互平台
2. **CAD分析器** - 3D文件解析与可视化系统
3. **AI海报生成器** - 智能设计与PDF导出
4. **用户管理系统** - 认证授权与权限控制
5. **实时聊天系统** - 多模态对话与流式处理

## 🏗️ 项目架构与技术规范

### 目录结构规范
```
zk-agent/
├── src/
│   ├── app/                 # Next.js App Router
│   ├── components/           # React组件库
│   ├── lib/                  # 核心工具库
│   ├── types/               # TypeScript类型定义
│   ├── utils/               # 工具函数
│   └── hooks/               # 自定义React Hooks
├── prisma/                  # 数据库Schema
├── public/                  # 静态资源
├── docs/                    # 项目文档
├── mddoc/                   # 详细技术文档
├── .cursor/rules/           # 开发规范(MDC)
└── tests/                   # 测试文件
```

### 技术架构特点
- **模块化设计**: 组件化开发，高内聚低耦合
- **智能体系统**: 多Agent协作，任务分发与执行
- **错误处理**: 统一异常处理机制
- **性能优化**: 缓存策略、懒加载、代码分割
- **安全机制**: JWT认证、数据验证、权限控制

## 👥 团队协作规范

### Team A - 前端团队职责
**技术边界**:
- ✅ 允许: React、Next.js路由、Tailwind CSS、状态管理
- ❌ 禁止: 直接集成后端API、数据库、AI服务

**性能要求**:
- Lighthouse评分 ≥ 90
- FCP ≤ 1.5s, LCP ≤ 2.5s
- Bundle大小 ≤ 500KB
- 测试覆盖率 ≥ 80%

**组件开发强制模式**:
```typescript
// 强制使用React.memo和明确类型定义
const ComponentName = React.memo<ComponentProps>(({ prop1, prop2 }) => {
  // 组件实现
});
```

### Team B - 后端团队职责
**技术边界**:
- ✅ 允许: API路由、Prisma ORM、PostgreSQL、AI服务集成
- ❌ 禁止: 前端UI、样式、路由

**性能门禁**:
- 响应时间 ≤ 200ms
- QPS ≥ 1000
- 数据库查询时间 ≤ 50ms
- 错误率 ≤ 0.1%

**API开发强制模式**:
```typescript
// 统一ApiResponse结构
interface ApiResponse<T> {
  success: boolean;
  data?: T;
  error?: string;
  code?: number;
}

// 所有API路由必须认证
export async function POST(request: Request) {
  const user = await authenticateUser(request);
  // API实现
}
```

## 🔒 Zod数据验证标准

### 强制执行规范
1. **导入约定**: 禁止命名空间导入，使用具体导入
2. **命名规范**: PascalCase + Schema后缀
3. **错误信息**: 所有Schema必须包含详细中文错误信息
4. **API验证**: 必须使用`withValidation`中间件

### 示例代码
```typescript
// 正确的Schema定义
import { z } from 'zod';

const UserCreateSchema = z.object({
  email: z.string({
    required_error: "邮箱地址是必填项",
    invalid_type_error: "邮箱地址必须是字符串类型"
  }).email("请输入有效的邮箱地址"),
  password: z.string({
    required_error: "密码是必填项"
  }).min(8, "密码长度至少8位")
});
```

## 📊 任务管理体系

### 当前任务状态 (req-11)
| 任务ID | 任务名称 | 状态 | 优先级 |
|--------|----------|------|--------|
| task-75 | 项目基础设施完善与环境配置 | 🔄 进行中 | P0 |
| task-76 | 数据库架构完善与性能优化 | 🔄 进行中 | P0 |
| task-77 | 智能体系统架构优化 | 🔄 进行中 | P1 |
| task-78 | CAD分析器功能增强 | 🔄 进行中 | P1 |
| task-79 | 海报生成器系统优化 | 🔄 进行中 | P1 |
| task-80 | 聊天系统性能增强 | 🔄 进行中 | P1 |
| task-81 | 前端响应式设计完善 | 🔄 进行中 | P0 |
| task-82 | 后端API架构优化 | 🔄 进行中 | P0 |
| task-83 | Zod数据验证系统标准化 | 🔄 进行中 | P0 |
| task-84 | 安全性加固与性能优化 | 🔄 进行中 | P1 |
| task-85 | 测试覆盖率提升与质量保证 | 🔄 进行中 | P1 |
| task-86 | 文档标准化与开发规范落实 | 🔄 进行中 | P2 |
| task-87 | 生产环境部署与监控 | 🔄 进行中 | P2 |
| task-88 | 项目交付与验收标准 | 🔄 进行中 | P2 |

### 关键里程碑
- **阶段1**: 基础设施完善 (task-75, task-76, task-81, task-82, task-83)
- **阶段2**: 功能增强优化 (task-77, task-78, task-79, task-80)
- **阶段3**: 质量保证 (task-84, task-85, task-86)
- **阶段4**: 生产部署 (task-87, task-88)

## 🔧 开发标准与质量要求

### 代码质量要求
- **内存安全**: 避免内存泄漏，合理使用useEffect清理
- **异常处理**: 统一错误边界，优雅降级
- **性能约束**: 组件渲染时间 ≤ 16ms

### 测试要求
- **单元测试**: 覆盖率 ≥ 80%，每周执行
- **压力测试**: 并发1000用户，每月执行
- **安全测试**: OWASP检查，每季度执行

### 提交规范
```
feat: 新功能
fix: 修复bug
docs: 文档更新
style: 代码格式
refactor: 重构
test: 测试相关
chore: 构建过程或辅助工具变动
```

## 🛡️ 安全与性能标准

### 安全要求
- JWT密钥管理：使用环境变量，定期轮换
- 数据验证：所有输入必须通过Zod验证
- 权限控制：基于角色的访问控制(RBAC)
- 密码安全：bcrypt加密，最小8位复杂度

### 性能指标
- **前端性能**: Core Web Vitals达标
- **后端性能**: API响应时间 ≤ 200ms
- **数据库性能**: 查询优化，索引覆盖
- **缓存策略**: Redis缓存，CDN加速

## 📚 文档标准化要求

### 必需文档
1. **API文档**: OpenAPI 3.0规范
2. **组件文档**: Storybook展示
3. **部署文档**: Docker + K8s配置
4. **用户手册**: 功能使用指南
5. **开发指南**: 环境搭建与开发流程

### 文档维护
- 代码变更必须同步更新文档
- 每月进行文档审查和更新
- 使用Markdown格式，统一模板

## 🚀 实施策略

### 基于现有代码优化原则
1. **代码继承**: 在现有基础上扩展，避免重写
2. **功能渐进增强**: 逐步添加新功能，保持向后兼容
3. **接口向后兼容**: 新版本API兼容旧版本
4. **配置驱动开关**: 通过配置控制新功能启用
5. **零破坏性变更**: 确保现有功能不受影响

### 质量门禁
- 代码审查：至少2人审查通过
- 自动化测试：CI/CD流程集成
- 性能检查：Lighthouse评分监控
- 安全扫描：依赖漏洞检查

## 📈 项目进度跟踪

### 当前状态
- **已完成模块**: 基础设施层、智能体系统、核心业务模块、UI组件系统、API接口层
- **进行中任务**: 14个核心任务并行推进
- **代码质量评分**: 7.7/10 (基于最新代码审查)

### 下一步行动
1. **立即行动**: 修复JWT硬编码、密码安全模块优化
2. **中期优化**: 完善文档、API认证增强
3. **长期规划**: 性能监控、安全审计系统

---

**文档版本**: v1.0  
**最后更新**: 2024年12月  
**维护团队**: ZK-Agent开发团队  
**审查周期**: 每月更新